"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9774],{6298:function(e,t,n){var r,i,o,s,a,h,u,l,c,d,p,f,_,v,y,g=n(83454),m=n(21876).Buffer;Object.defineProperty(t,"__esModule",{value:!0});var C=n(79720),w=n(21876),b=n(17187),E=n(79681),S=n(42474),T=n(11987),k=n(27596),I=n(85456),x=n(72694),P=n(31313),N=n(97582),R=n(97019),O=n(79730);function D(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var A=D(C),L=D(w),M=D(b),q=D(E),F=D(S),U=D(T),B=D(k),H=D(I),W=D(x),j=D(P),z=D(N),V=D(R),K={},Y={exports:{}};!function(e,t){var n=L.default,r=n.Buffer;function i(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return r(e,t,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=n:(i(n,t),t.Buffer=o),o.prototype=Object.create(r.prototype),i(r,o),o.from=function(e,t,n){if("number"==typeof e)throw TypeError("Argument must not be a number");return r(e,t,n)},o.alloc=function(e,t,n){if("number"!=typeof e)throw TypeError("Argument must be a number");var i=r(e);return void 0!==t?"string"==typeof n?i.fill(t,n):i.fill(t):i.fill(0),i},o.allocUnsafe=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return r(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return n.SlowBuffer(e)}}(Y,Y.exports);var Q={},G=q.default.Stream,$=A.default,J=function(e){this.readable=this.writable=!0,this._paused=!1,this._driver=e};$.inherits(J,G),J.prototype.pause=function(){this._paused=!0,this._driver.messages._paused=!0},J.prototype.resume=function(){this._paused=!1,this.emit("drain");var e=this._driver.messages;e._paused=!1,e.emit("drain")},J.prototype.write=function(e){return!!this.writable&&(this._driver.parse(e),!this._paused)},J.prototype.end=function(e){if(this.writable){void 0!==e&&this.write(e),this.writable=!1;var t=this._driver.messages;t.readable&&(t.readable=t.writable=!1,t.emit("end"))}},J.prototype.destroy=function(){this.end()};var Z=function(e){this.readable=this.writable=!0,this._paused=!1,this._driver=e};$.inherits(Z,G),Z.prototype.pause=function(){this._driver.io._paused=!0},Z.prototype.resume=function(){this._driver.io._paused=!1,this._driver.io.emit("drain")},Z.prototype.write=function(e){return!!this.writable&&("string"==typeof e?this._driver.text(e):this._driver.binary(e),!this._paused)},Z.prototype.end=function(e){void 0!==e&&this.write(e)},Z.prototype.destroy=function(){},Q.IO=J,Q.Messages=Z;var X=function(){this.clear()};X.prototype.ALLOWED_DUPLICATES=["set-cookie","set-cookie2","warning","www-authenticate"],X.prototype.clear=function(){this._sent={},this._lines=[]},X.prototype.set=function(e,t){if(void 0!==t){e=this._strip(e),t=this._strip(t);var n=e.toLowerCase();(!this._sent.hasOwnProperty(n)||this.ALLOWED_DUPLICATES.indexOf(n)>=0)&&(this._sent[n]=!0,this._lines.push(e+": "+t+"\r\n"))}},X.prototype.toString=function(){return this._lines.join("")},X.prototype._strip=function(e){return e.toString().replace(/^ */,"").replace(/ *$/,"")};var ee=Y.exports.Buffer,et=function(){this._queue=[],this._queueSize=0,this._offset=0};et.prototype.put=function(e){e&&0!==e.length&&(ee.isBuffer(e)||(e=ee.from(e)),this._queue.push(e),this._queueSize+=e.length)},et.prototype.read=function(e){if(e>this._queueSize)return null;if(0===e)return ee.alloc(0);this._queueSize-=e;var t,n,r=this._queue,i=e,o=r[0];if(o.length>=e)return o.length===e?r.shift():(n=o.slice(0,e),r[0]=o.slice(e),n);for(var s=0,a=r.length;s<a&&!(i<r[s].length);s++)i-=r[s].length;return t=r.splice(0,s),i>0&&r.length>0&&(t.push(r[0].slice(0,i)),r[0]=r[0].slice(i)),ee.concat(t,e)},et.prototype.eachByte=function(e,t){for(var n,r,i;this._queue.length>0;){for(r=(n=this._queue[0]).length;this._offset<r;)i=this._offset,this._offset+=1,e.call(t,n[i]);this._offset=0,this._queue.shift()}};var en=Y.exports.Buffer,er=M.default.EventEmitter,ei=A.default,eo=function(e,t,n){er.call(this),eo.validateOptions(n||{},["maxLength","masking","requireMasking","protocols"]),this._request=e,this._reader=new et,this._options=n||{},this._maxLength=this._options.maxLength||this.MAX_LENGTH,this._headers=new X,this.__queue=[],this.readyState=0,this.url=t,this.io=new Q.IO(this),this.messages=new Q.Messages(this),this._bindEventListeners()};ei.inherits(eo,er),eo.isWebSocket=function(e){var t=e.headers.connection||"",n=e.headers.upgrade||"";return"GET"===e.method&&t.toLowerCase().split(/ *, */).indexOf("upgrade")>=0&&"websocket"===n.toLowerCase()},eo.validateOptions=function(e,t){for(var n in e)if(0>t.indexOf(n))throw Error("Unrecognized option: "+n)};var es={MAX_LENGTH:67108863,STATES:["connecting","open","closing","closed"],_bindEventListeners:function(){var e=this;this.messages.on("error",function(){}),this.on("message",function(t){var n=e.messages;n.readable&&n.emit("data",t.data)}),this.on("error",function(t){var n=e.messages;n.readable&&n.emit("error",t)}),this.on("close",function(){var t=e.messages;t.readable&&(t.readable=t.writable=!1,t.emit("end"))})},getState:function(){return this.STATES[this.readyState]||null},addExtension:function(e){return!1},setHeader:function(e,t){return!(this.readyState>0)&&(this._headers.set(e,t),!0)},start:function(){var e;if(0!==this.readyState)return!1;if(!eo.isWebSocket(this._request))return this._failHandshake(Error("Not a WebSocket request"));try{e=this._handshakeResponse()}catch(e){return this._failHandshake(e)}return this._write(e),-1!==this._stage&&this._open(),!0},_failHandshake:function(e){var t=new X;return t.set("Content-Type","text/plain"),t.set("Content-Length",en.byteLength(e.message,"utf8")),t=["HTTP/1.1 400 Bad Request",t.toString(),e.message],this._write(en.from(t.join("\r\n"),"utf8")),this._fail("protocol_error",e.message),!1},text:function(e){return this.frame(e)},binary:function(e){return!1},ping:function(){return!1},pong:function(){return!1},close:function(e,t){return 1===this.readyState&&(this.readyState=3,this.emit("close",new eo.CloseEvent(null,null)),!0)},_open:function(){this.readyState=1,this.__queue.forEach(function(e){this.frame.apply(this,e)},this),this.__queue=[],this.emit("open",new eo.OpenEvent)},_queue:function(e){return this.__queue.push(e),!0},_write:function(e){var t=this.io;t.readable&&t.emit("data",e)},_fail:function(e,t){this.readyState=2,this.emit("error",Error(t)),this.close()}};for(var ea in es)eo.prototype[ea]=es[ea];eo.ConnectEvent=function(){},eo.OpenEvent=function(){},eo.CloseEvent=function(e,t){this.code=e,this.reason=t},eo.MessageEvent=function(e){this.data=e},eo.PingEvent=function(e){this.data=e},eo.PongEvent=function(e){this.data=e};var eh={},eu=B.default;function el(e){eu.ok(e===el.REQUEST||e===el.RESPONSE||void 0===e),void 0===e||this.initialize(e)}eh.HTTPParser=el,el.prototype.initialize=function(e,t){eu.ok(e===el.REQUEST||e===el.RESPONSE),this.type=e,this.state=e+"_LINE",this.info={headers:[],upgrade:!1},this.trailers=[],this.line="",this.isChunked=!1,this.connection="",this.headerSize=0,this.body_bytes=null,this.isUserCall=!1,this.hadError=!1},el.encoding="ascii",el.maxHeaderSize=81920,el.REQUEST="REQUEST",el.RESPONSE="RESPONSE";var ec=el.kOnHeaders=1,ed=el.kOnHeadersComplete=2,ep=el.kOnBody=3,ef=el.kOnMessageComplete=4;el.prototype[ec]=el.prototype[ed]=el.prototype[ep]=el.prototype[ef]=function(){};var e_=!0;Object.defineProperty(el,"kOnExecute",{get:function(){return e_=!1,99}});var ev=eh.methods=el.methods=["DELETE","GET","HEAD","POST","PUT","CONNECT","OPTIONS","TRACE","COPY","LOCK","MKCOL","MOVE","PROPFIND","PROPPATCH","SEARCH","UNLOCK","BIND","REBIND","UNBIND","ACL","REPORT","MKACTIVITY","CHECKOUT","MERGE","M-SEARCH","NOTIFY","SUBSCRIBE","UNSUBSCRIBE","PATCH","PURGE","MKCALENDAR","LINK","UNLINK"],ey=ev.indexOf("CONNECT");el.prototype.reinitialize=el,el.prototype.close=el.prototype.pause=el.prototype.resume=el.prototype.free=function(){},el.prototype._compatMode0_11=!1,el.prototype.getAsyncId=function(){return 0};var eg={REQUEST_LINE:!0,RESPONSE_LINE:!0,HEADER:!0};el.prototype.execute=function(e,t,n){if(!(this instanceof el))throw TypeError("not a HTTPParser");t=t||0,n="number"==typeof n?n:e.length,this.chunk=e,this.offset=t;var r=this.end=t+n;try{for(;this.offset<r&&!this[this.state](););}catch(e){if(this.isUserCall)throw e;return this.hadError=!0,e}return(this.chunk=null,n=this.offset-t,eg[this.state]&&(this.headerSize+=n,this.headerSize>el.maxHeaderSize))?Error("max header size exceeded"):n};var em={REQUEST_LINE:!0,RESPONSE_LINE:!0,BODY_RAW:!0};el.prototype.finish=function(){if(!this.hadError){if(!em[this.state])return Error("invalid state for EOF");"BODY_RAW"===this.state&&this.userCall()(this[ef]())}},el.prototype.consume=el.prototype.unconsume=el.prototype.getCurrentBuffer=function(){},el.prototype.userCall=function(){this.isUserCall=!0;var e=this;return function(t){return e.isUserCall=!1,t}},el.prototype.nextRequest=function(){this.userCall()(this[ef]()),this.reinitialize(this.type)},el.prototype.consumeLine=function(){for(var e=this.end,t=this.chunk,n=this.offset;n<e;n++)if(10===t[n]){var r=this.line+t.toString(el.encoding,this.offset,n);return"\r"===r.charAt(r.length-1)&&(r=r.substr(0,r.length-1)),this.line="",this.offset=n+1,r}this.line+=t.toString(el.encoding,this.offset,this.end),this.offset=this.end};var eC=/^([^: \t]+):[ \t]*((?:.*[^ \t])|)/,ew=/^[ \t]+(.*[^ \t])/;el.prototype.parseHeader=function(e,t){if(-1!==e.indexOf("\r"))throw eS("HPE_LF_EXPECTED");var n=eC.exec(e),r=n&&n[1];if(r)t.push(r),t.push(n[2]);else{var i=ew.exec(e);i&&t.length&&(t[t.length-1]&&(t[t.length-1]+=" "),t[t.length-1]+=i[1])}};var eb=/^([A-Z-]+) ([^ ]+) HTTP\/(\d)\.(\d)$/;el.prototype.REQUEST_LINE=function(){var e=this.consumeLine();if(e){var t=eb.exec(e);if(null===t)throw eS("HPE_INVALID_CONSTANT");if(this.info.method=this._compatMode0_11?t[1]:ev.indexOf(t[1]),-1===this.info.method)throw Error("invalid request method");this.info.url=t[2],this.info.versionMajor=+t[3],this.info.versionMinor=+t[4],this.body_bytes=0,this.state="HEADER"}};var eE=/^HTTP\/(\d)\.(\d) (\d{3}) ?(.*)$/;function eS(e){var t=Error("Parse Error");return t.code=e,t}el.prototype.RESPONSE_LINE=function(){var e=this.consumeLine();if(e){var t=eE.exec(e);if(null===t)throw eS("HPE_INVALID_CONSTANT");this.info.versionMajor=+t[1],this.info.versionMinor=+t[2];var n=this.info.statusCode=+t[3];this.info.statusMessage=t[4],((n/100|0)==1||204===n||304===n)&&(this.body_bytes=0),this.state="HEADER"}},el.prototype.shouldKeepAlive=function(){if(this.info.versionMajor>0&&this.info.versionMinor>0){if(-1!==this.connection.indexOf("close"))return!1}else if(-1===this.connection.indexOf("keep-alive"))return!1;return null!==this.body_bytes||!!this.isChunked},el.prototype.HEADER=function(){var e=this.consumeLine();if(void 0!==e){var t=this.info;if(e)this.parseHeader(e,t.headers);else{for(var n,r,i=t.headers,o=!1,s=!1,a=0;a<i.length;a+=2)switch(i[a].toLowerCase()){case"transfer-encoding":this.isChunked="chunked"===i[a+1].toLowerCase();break;case"content-length":if(n=+i[a+1],o){if(n!==this.body_bytes)throw eS("HPE_UNEXPECTED_CONTENT_LENGTH")}else o=!0,this.body_bytes=n;break;case"connection":this.connection+=i[a+1].toLowerCase();break;case"upgrade":s=!0}if(this.isChunked&&o&&(o=!1,this.body_bytes=null),s&&-1!=this.connection.indexOf("upgrade")?t.upgrade=this.type===el.REQUEST||101===t.statusCode:t.upgrade=t.method===ey,this.isChunked&&t.upgrade&&(this.isChunked=!1),t.shouldKeepAlive=this.shouldKeepAlive(),2===(r=e_?this.userCall()(this[ed](t)):this.userCall()(this[ed](t.versionMajor,t.versionMinor,t.headers,t.method,t.url,t.statusCode,t.statusMessage,t.upgrade,t.shouldKeepAlive))))return this.nextRequest(),!0;if(this.isChunked&&!r)this.state="BODY_CHUNKHEAD";else{if(r||0===this.body_bytes)return this.nextRequest(),t.upgrade;null===this.body_bytes?this.state="BODY_RAW":this.state="BODY_SIZED"}}}},el.prototype.BODY_CHUNKHEAD=function(){var e=this.consumeLine();void 0!==e&&(this.body_bytes=parseInt(e,16),this.body_bytes?this.state="BODY_CHUNK":this.state="BODY_CHUNKTRAILERS")},el.prototype.BODY_CHUNK=function(){var e=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[ep](this.chunk,this.offset,e)),this.offset+=e,this.body_bytes-=e,this.body_bytes||(this.state="BODY_CHUNKEMPTYLINE")},el.prototype.BODY_CHUNKEMPTYLINE=function(){var e=this.consumeLine();void 0!==e&&(eu.equal(e,""),this.state="BODY_CHUNKHEAD")},el.prototype.BODY_CHUNKTRAILERS=function(){var e=this.consumeLine();void 0!==e&&(e?this.parseHeader(e,this.trailers):(this.trailers.length&&this.userCall()(this[ec](this.trailers,"")),this.nextRequest()))},el.prototype.BODY_RAW=function(){var e=this.end-this.offset;this.userCall()(this[ep](this.chunk,this.offset,e)),this.offset=this.end},el.prototype.BODY_SIZED=function(){var e=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[ep](this.chunk,this.offset,e)),this.offset+=e,this.body_bytes-=e,this.body_bytes||this.nextRequest()},["Headers","HeadersComplete","Body","MessageComplete"].forEach(function(e){var t=el["kOn"+e];Object.defineProperty(el.prototype,"on"+e,{get:function(){return this[t]},set:function(e){return this._compatMode0_11=!0,ey="CONNECT",this[t]=e}})});var eT=eh.HTTPParser,ek=Y.exports.Buffer,eI={request:eT.REQUEST||"request",response:eT.RESPONSE||"response"},ex=function(e){this._type=e,this._parser=new eT(eI[e]),this._complete=!1,this.headers={};var t=null,n=this;this._parser.onHeaderField=function(e,n,r){t=e.toString("utf8",n,n+r).toLowerCase()},this._parser.onHeaderValue=function(e,r,i){var o=e.toString("utf8",r,r+i);n.headers.hasOwnProperty(t)?n.headers[t]+=", "+o:n.headers[t]=o},this._parser.onHeadersComplete=this._parser[eT.kOnHeadersComplete]=function(e,t,r,i,o,s){var a=arguments[0];if("object"==typeof a&&(i=a.method,o=a.url,s=a.statusCode,r=a.headers),n.method="number"==typeof i?ex.METHODS[i]:i,n.statusCode=s,n.url=o,r){for(var h,u,l=0,c=r.length;l<c;l+=2)h=r[l].toLowerCase(),u=r[l+1],n.headers.hasOwnProperty(h)?n.headers[h]+=", "+u:n.headers[h]=u;n._complete=!0}}};ex.METHODS={0:"DELETE",1:"GET",2:"HEAD",3:"POST",4:"PUT",5:"CONNECT",6:"OPTIONS",7:"TRACE",8:"COPY",9:"LOCK",10:"MKCOL",11:"MOVE",12:"PROPFIND",13:"PROPPATCH",14:"SEARCH",15:"UNLOCK",16:"BIND",17:"REBIND",18:"UNBIND",19:"ACL",20:"REPORT",21:"MKACTIVITY",22:"CHECKOUT",23:"MERGE",24:"M-SEARCH",25:"NOTIFY",26:"SUBSCRIBE",27:"UNSUBSCRIBE",28:"PATCH",29:"PURGE",30:"MKCALENDAR",31:"LINK",32:"UNLINK"};var eP=g.version?g.version.match(/[0-9]+/g).map(function(e){return parseInt(e,10)}):[];0===eP[0]&&12===eP[1]&&(ex.METHODS[16]="REPORT",ex.METHODS[17]="MKACTIVITY",ex.METHODS[18]="CHECKOUT",ex.METHODS[19]="MERGE",ex.METHODS[20]="M-SEARCH",ex.METHODS[21]="NOTIFY",ex.METHODS[22]="SUBSCRIBE",ex.METHODS[23]="UNSUBSCRIBE",ex.METHODS[24]="PATCH",ex.METHODS[25]="PURGE"),ex.prototype.isComplete=function(){return this._complete},ex.prototype.parse=function(e){var t=this._parser.execute(e,0,e.length);if("number"!=typeof t){this.error=t,this._complete=!0;return}this._complete&&(this.body=t<e.length?e.slice(t):ek.alloc(0))};var eN=/([!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z]+)/,eR=/([^!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z])/g,eO=RegExp(eN.source+"(?:=(?:"+eN.source+"|"+/"((?:\\[\x00-\x7f]|[^\x00-\x08\x0a-\x1f\x7f"\\])*)"/.source+"))?"),eD=RegExp(eN.source+"(?: *; *"+eO.source+")*","g"),eA=RegExp("^"+eD.source+"(?: *, *"+eD.source+")*$"),eL=/^-?(0|[1-9][0-9]*)(\.[0-9]+)?$/,eM=Object.prototype.hasOwnProperty,eq=function(){this._byName={},this._inOrder=[]};eq.prototype.push=function(e,t){eM.call(this._byName,e)||(this._byName[e]=[]),this._byName[e].push(t),this._inOrder.push({name:e,params:t})},eq.prototype.eachOffer=function(e,t){for(var n=this._inOrder,r=0,i=n.length;r<i;r++)e.call(t,n[r].name,n[r].params)},eq.prototype.byName=function(e){return this._byName[e]||[]},eq.prototype.toArray=function(){return this._inOrder.slice()};var eF=function(e){this._bufferSize=e,this.clear()};eF.prototype.clear=function(){this._buffer=Array(this._bufferSize),this._ringOffset=0,this._ringSize=this._bufferSize,this._head=0,this._tail=0,this.length=0},eF.prototype.push=function(e){var t=!1,n=!1;this._ringSize<this._bufferSize?t=0===this._tail:this._ringOffset===this._ringSize&&(t=!0,n=0===this._tail),t&&(this._tail=this._bufferSize,this._buffer=this._buffer.concat(Array(this._bufferSize)),this._bufferSize=this._buffer.length,n&&(this._ringSize=this._bufferSize)),this._buffer[this._tail]=e,this.length+=1,this._tail<this._ringSize&&(this._ringOffset+=1),this._tail=(this._tail+1)%this._bufferSize},eF.prototype.peek=function(){if(0!==this.length)return this._buffer[this._head]},eF.prototype.shift=function(){if(0!==this.length){var e=this._buffer[this._head];return this._buffer[this._head]=void 0,this.length-=1,this._ringOffset-=1,0===this._ringOffset&&this.length>0?(this._head=this._ringSize,this._ringOffset=this.length,this._ringSize=this._bufferSize):this._head=(this._head+1)%this._ringSize,e}};var eU=function(e,t){this._session=e,this._method=t,this._queue=new eF(eU.QUEUE_SIZE),this._stopped=!1,this.pending=0};eU.QUEUE_SIZE=8,eU.prototype.call=function(e,t,n,r){if(!this._stopped){var i={error:e,message:t,callback:n,context:r,done:!1},o=!1,s=this;if(this._queue.push(i),i.error)return i.done=!0,this._stop(),this._flushQueue();var a=function(e,t){o^(o=!0)&&(e?(s._stop(),i.error=e,i.message=null):i.message=t,i.done=!0,s._flushQueue())};try{this._session[this._method](t,a)}catch(e){a(e)}}},eU.prototype._stop=function(){this.pending=this._queue.length,this._stopped=!0},eU.prototype._flushQueue=function(){for(var e,t=this._queue;t.length>0&&t.peek().done;)(e=t.shift()).error?(this.pending=0,t.clear()):this.pending-=1,e.callback.call(e.context,e.error,e.message)};var eB=function(){this._complete=!1,this._callbacks=new eF(eB.QUEUE_SIZE)};eB.QUEUE_SIZE=4,eB.all=function(e){var t=new eB,n=e.length,r=n;for(0===n&&t.done();r--;)e[r].then(function(){0==(n-=1)&&t.done()});return t},eB.prototype.then=function(e){this._complete?e():this._callbacks.push(e)},eB.prototype.done=function(){this._complete=!0;for(var e,t=this._callbacks;e=t.shift();)e()};var eH=function(e){this._ext=e[0],this._session=e[1],this._functors={incoming:new eU(this._session,"processIncomingMessage"),outgoing:new eU(this._session,"processOutgoingMessage")}};eH.prototype.pending=function(e){var t=this._functors[e];t._stopped||(t.pending+=1)},eH.prototype.incoming=function(e,t,n,r){this._exec("incoming",e,t,n,r)},eH.prototype.outgoing=function(e,t,n,r){this._exec("outgoing",e,t,n,r)},eH.prototype.close=function(){return this._closed=this._closed||new eB,this._doClose(),this._closed},eH.prototype._exec=function(e,t,n,r,i){this._functors[e].call(t,n,function(e,t){e&&(e.message=this._ext.name+": "+e.message),r.call(i,e,t),this._doClose()},this)},eH.prototype._doClose=function(){var e=this._functors.incoming,t=this._functors.outgoing;this._closed&&e.pending+t.pending===0&&(this._session&&this._session.close(),this._session=null,this._closed.done())};var eW=function(e){this._cells=e.map(function(e){return new eH(e)}),this._stopped={incoming:!1,outgoing:!1}};eW.prototype.processIncomingMessage=function(e,t,n){this._stopped.incoming||this._loop("incoming",this._cells.length-1,-1,-1,e,t,n)},eW.prototype.processOutgoingMessage=function(e,t,n){this._stopped.outgoing||this._loop("outgoing",0,this._cells.length,1,e,t,n)},eW.prototype.close=function(e,t){this._stopped={incoming:!0,outgoing:!0};var n=this._cells.map(function(e){return e.close()});e&&eB.all(n).then(function(){e.call(t)})},eW.prototype._loop=function(e,t,n,r,i,o,s){for(var a=this._cells,h=a.length,u=this;h--;)a[h].pending(e);var l=function(t,i,h){if(t===n)return o.call(s,i,h);a[t][e](i,h,function(n,i){n&&(u._stopped[e]=!0),l(t+r,n,i)})};l(t,null,i)};var ej={parseHeader:function(e){var t=new eq;if(""===e||void 0===e)return t;if(!eA.test(e))throw SyntaxError("Invalid Sec-WebSocket-Extensions header: "+e);return e.match(eD).forEach(function(e){var n=e.match(RegExp(eO.source,"g")),r=n.shift(),i={};n.forEach(function(e){var t,n=e.match(eO),r=n[1];t=void 0!==n[2]?n[2]:void 0===n[3]||n[3].replace(/\\/g,""),eL.test(t)&&(t=parseFloat(t)),eM.call(i,r)?(i[r]=[].concat(i[r]),i[r].push(t)):i[r]=t},this),t.push(r,i)},this),t},serializeParams:function(e,t){var n=[],r=function(e,t){t instanceof Array?t.forEach(function(t){r(e,t)}):!0===t?n.push(e):"number"==typeof t?n.push(e+"="+t):eR.test(t)?n.push(e+'="'+t.replace(/"/g,'\\"')+'"'):n.push(e+"="+t)};for(var i in t)r(i,t[i]);return[e].concat(n).join("; ")}},ez=function(){this._rsv1=this._rsv2=this._rsv3=null,this._byName={},this._inOrder=[],this._sessions=[],this._index={}};ez.MESSAGE_OPCODES=[1,2];var eV={add:function(e){if("string"!=typeof e.name)throw TypeError("extension.name must be a string");if("permessage"!==e.type)throw TypeError('extension.type must be "permessage"');if("boolean"!=typeof e.rsv1)throw TypeError("extension.rsv1 must be true or false");if("boolean"!=typeof e.rsv2)throw TypeError("extension.rsv2 must be true or false");if("boolean"!=typeof e.rsv3)throw TypeError("extension.rsv3 must be true or false");if(this._byName.hasOwnProperty(e.name))throw TypeError('An extension with name "'+e.name+'" is already registered');this._byName[e.name]=e,this._inOrder.push(e)},generateOffer:function(){var e=[],t=[],n={};return this._inOrder.forEach(function(r){var i=r.createClientSession();if(i){var o=[r,i];e.push(o),n[r.name]=o;var s=i.generateOffer();(s=s?[].concat(s):[]).forEach(function(e){t.push(ej.serializeParams(r.name,e))},this)}},this),this._sessions=e,this._index=n,t.length>0?t.join(", "):null},activate:function(e){var t=ej.parseHeader(e),n=[];t.eachOffer(function(e,t){var r=this._index[e];if(!r)throw Error('Server sent an extension response for unknown extension "'+e+'"');var i=r[0],o=r[1],s=this._reserved(i);if(s)throw Error("Server sent two extension responses that use the RSV"+s[0]+' bit: "'+s[1]+'" and "'+i.name+'"');if(!0!==o.activate(t))throw Error("Server sent unacceptable extension parameters: "+ej.serializeParams(e,t));this._reserve(i),n.push(r)},this),this._sessions=n,this._pipeline=new eW(n)},generateResponse:function(e){var t=[],n=[],r=ej.parseHeader(e);return this._inOrder.forEach(function(e){var i=r.byName(e.name);if(!(0===i.length||this._reserved(e))){var o=e.createServerSession(i);o&&(this._reserve(e),t.push([e,o]),n.push(ej.serializeParams(e.name,o.generateResponse())))}},this),this._sessions=t,this._pipeline=new eW(t),n.length>0?n.join(", "):null},validFrameRsv:function(e){var t,n={rsv1:!1,rsv2:!1,rsv3:!1};if(ez.MESSAGE_OPCODES.indexOf(e.opcode)>=0)for(var r=0,i=this._sessions.length;r<i;r++)t=this._sessions[r][0],n.rsv1=n.rsv1||t.rsv1,n.rsv2=n.rsv2||t.rsv2,n.rsv3=n.rsv3||t.rsv3;return(n.rsv1||!e.rsv1)&&(n.rsv2||!e.rsv2)&&(n.rsv3||!e.rsv3)},processIncomingMessage:function(e,t,n){this._pipeline.processIncomingMessage(e,t,n)},processOutgoingMessage:function(e,t,n){this._pipeline.processOutgoingMessage(e,t,n)},close:function(e,t){if(!this._pipeline)return e.call(t);this._pipeline.close(e,t)},_reserve:function(e){this._rsv1=this._rsv1||e.rsv1&&e.name,this._rsv2=this._rsv2||e.rsv2&&e.name,this._rsv3=this._rsv3||e.rsv3&&e.name},_reserved:function(e){return this._rsv1&&e.rsv1?[1,this._rsv1]:this._rsv2&&e.rsv2?[2,this._rsv2]:!!this._rsv3&&!!e.rsv3&&[3,this._rsv3]}};for(var eK in eV)ez.prototype[eK]=eV[eK];var eY=function(){},eQ={final:!1,rsv1:!1,rsv2:!1,rsv3:!1,opcode:null,masked:!1,maskingKey:null,lengthBytes:1,length:0,payload:null};for(var eG in eQ)eY.prototype[eG]=eQ[eG];var e$=Y.exports.Buffer,eJ=function(){this.rsv1=!1,this.rsv2=!1,this.rsv3=!1,this.opcode=null,this.length=0,this._chunks=[]},eZ={read:function(){return this.data=this.data||e$.concat(this._chunks,this.length)},pushFrame:function(e){this.rsv1=this.rsv1||e.rsv1,this.rsv2=this.rsv2||e.rsv2,this.rsv3=this.rsv3||e.rsv3,null===this.opcode&&(this.opcode=e.opcode),this._chunks.push(e.payload),this.length+=e.length}};for(var eX in eZ)eJ.prototype[eX]=eZ[eX];var e0=Y.exports.Buffer,e1=F.default,e2=A.default,e3=function(e,t,n){if(eo.apply(this,arguments),this._extensions=new ez,this._stage=0,this._masking=this._options.masking,this._protocols=this._options.protocols||[],this._requireMasking=this._options.requireMasking,this._pingCallbacks={},"string"==typeof this._protocols&&(this._protocols=this._protocols.split(/ *, */)),this._request){var r=this._request.headers["sec-websocket-protocol"],i=this._protocols;void 0!==r&&("string"==typeof r&&(r=r.split(/ *, */)),this.protocol=r.filter(function(e){return i.indexOf(e)>=0})[0]),this.version="hybi-"+e3.VERSION}};e2.inherits(e3,eo),e3.VERSION="13",e3.mask=function(e,t,n){if(!t||0===t.length)return e;n=n||0;for(var r=0,i=e.length-n;r<i;r++)e[n+r]=e[n+r]^t[r%4];return e},e3.generateAccept=function(e){var t=e1.createHash("sha1");return t.update(e+e3.GUID),t.digest("base64")},e3.GUID="258EAFA5-E914-47DA-95CA-C5AB0DC85B11";var e4={FIN:128,MASK:128,RSV1:64,RSV2:32,RSV3:16,OPCODE:15,LENGTH:127,OPCODES:{continuation:0,text:1,binary:2,close:8,ping:9,pong:10},OPCODE_CODES:[0,1,2,8,9,10],MESSAGE_OPCODES:[0,1,2],OPENING_OPCODES:[1,2],ERRORS:{normal_closure:1e3,going_away:1001,protocol_error:1002,unacceptable:1003,encoding_error:1007,policy_violation:1008,too_large:1009,extension_error:1010,unexpected_condition:1011},ERROR_CODES:[1e3,1001,1002,1003,1007,1008,1009,1010,1011],DEFAULT_ERROR_CODE:1e3,MIN_RESERVED_ERROR:3e3,MAX_RESERVED_ERROR:4999,UTF8_MATCH:/^([\x00-\x7F]|[\xC2-\xDF][\x80-\xBF]|\xE0[\xA0-\xBF][\x80-\xBF]|[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}|\xED[\x80-\x9F][\x80-\xBF]|\xF0[\x90-\xBF][\x80-\xBF]{2}|[\xF1-\xF3][\x80-\xBF]{3}|\xF4[\x80-\x8F][\x80-\xBF]{2})*$/,addExtension:function(e){return this._extensions.add(e),!0},parse:function(e){this._reader.put(e);for(var t=!0;t;)switch(this._stage){case 0:(t=this._reader.read(1))&&this._parseOpcode(t[0]);break;case 1:(t=this._reader.read(1))&&this._parseLength(t[0]);break;case 2:(t=this._reader.read(this._frame.lengthBytes))&&this._parseExtendedLength(t);break;case 3:(t=this._reader.read(4))&&(this._stage=4,this._frame.maskingKey=t);break;case 4:(t=this._reader.read(this._frame.length))&&(this._stage=0,this._emitFrame(t));break;default:t=null}},text:function(e){return!(this.readyState>1)&&this.frame(e,"text")},binary:function(e){return!(this.readyState>1)&&this.frame(e,"binary")},ping:function(e,t){return!(this.readyState>1)&&(e=e||"",t&&(this._pingCallbacks[e]=t),this.frame(e,"ping"))},pong:function(e){return!(this.readyState>1)&&(e=e||"",this.frame(e,"pong"))},close:function(e,t){return(e=e||"",t=t||this.ERRORS.normal_closure,this.readyState<=0)?(this.readyState=3,this.emit("close",new eo.CloseEvent(t,e)),!0):1===this.readyState&&(this.readyState=2,this._extensions.close(function(){this.frame(e,"close",t)},this),!0)},frame:function(e,t,n){if(this.readyState<=0)return this._queue([e,t,n]);if(this.readyState>2)return!1;e instanceof Array&&(e=e0.from(e)),"number"==typeof e&&(e=e.toString());var r,i,o=new eJ,s="string"==typeof e;o.rsv1=o.rsv2=o.rsv3=!1,o.opcode=this.OPCODES[t||(s?"text":"binary")],r=s?e0.from(e,"utf8"):e,n&&(i=r,(r=e0.allocUnsafe(2+i.length)).writeUInt16BE(n,0),i.copy(r,2)),o.data=r;var a=function(e){var t=new eY;t.final=!0,t.rsv1=e.rsv1,t.rsv2=e.rsv2,t.rsv3=e.rsv3,t.opcode=e.opcode,t.masked=!!this._masking,t.length=e.data.length,t.payload=e.data,t.masked&&(t.maskingKey=e1.randomBytes(4)),this._sendFrame(t)};return this.MESSAGE_OPCODES.indexOf(o.opcode)>=0?this._extensions.processOutgoingMessage(o,function(e,t){if(e)return this._fail("extension_error",e.message);a.call(this,t)},this):a.call(this,o),!0},_sendFrame:function(e){var t=e.length,n=t<=125?2:t<=65535?4:10,r=n+(e.masked?4:0),i=e0.allocUnsafe(r+t),o=e.masked?this.MASK:0;i[0]=(e.final?this.FIN:0)|(e.rsv1?this.RSV1:0)|(e.rsv2?this.RSV2:0)|(e.rsv3?this.RSV3:0)|e.opcode,t<=125?i[1]=o|t:t<=65535?(i[1]=126|o,i.writeUInt16BE(t,2)):(i[1]=127|o,i.writeUInt32BE(Math.floor(t/4294967296),2),i.writeUInt32BE(t%4294967296,6)),e.payload.copy(i,r),e.masked&&(e.maskingKey.copy(i,n),e3.mask(i,e.maskingKey,r)),this._write(i)},_handshakeResponse:function(){var e=this._request.headers["sec-websocket-key"],t=this._request.headers["sec-websocket-version"];if(t!==e3.VERSION)throw Error("Unsupported WebSocket version: "+t);if("string"!=typeof e)throw Error("Missing handshake request header: Sec-WebSocket-Key");this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Accept",e3.generateAccept(e)),this.protocol&&this._headers.set("Sec-WebSocket-Protocol",this.protocol);var n=this._extensions.generateResponse(this._request.headers["sec-websocket-extensions"]);n&&this._headers.set("Sec-WebSocket-Extensions",n);var r=["HTTP/1.1 101 Switching Protocols",this._headers.toString(),""];return e0.from(r.join("\r\n"),"utf8")},_shutdown:function(e,t,n){delete this._frame,delete this._message,this._stage=5;var r=1===this.readyState;this.readyState=2,this._extensions.close(function(){r&&this.frame(t,"close",e),this.readyState=3,n&&this.emit("error",Error(t)),this.emit("close",new eo.CloseEvent(e,t))},this)},_fail:function(e,t){this.readyState>1||this._shutdown(this.ERRORS[e],t,!0)},_parseOpcode:function(e){var t=[this.RSV1,this.RSV2,this.RSV3].map(function(t){return(e&t)===t}),n=this._frame=new eY;return(n.final=(e&this.FIN)===this.FIN,n.rsv1=t[0],n.rsv2=t[1],n.rsv3=t[2],n.opcode=e&this.OPCODE,this._stage=1,this._extensions.validFrameRsv(n))?0>this.OPCODE_CODES.indexOf(n.opcode)?this._fail("protocol_error","Unrecognized frame opcode: "+n.opcode):0>this.MESSAGE_OPCODES.indexOf(n.opcode)&&!n.final?this._fail("protocol_error","Received fragmented control frame: opcode = "+n.opcode):this._message&&this.OPENING_OPCODES.indexOf(n.opcode)>=0?this._fail("protocol_error","Received new data frame but previous continuous frame is unfinished"):void 0:this._fail("protocol_error","One or more reserved bits are on: reserved1 = "+(n.rsv1?1:0)+", reserved2 = "+(n.rsv2?1:0)+", reserved3 = "+(n.rsv3?1:0))},_parseLength:function(e){var t=this._frame;if(t.masked=(e&this.MASK)===this.MASK,t.length=e&this.LENGTH,t.length>=0&&t.length<=125){if(this._stage=t.masked?3:4,!this._checkFrameLength())return}else this._stage=2,t.lengthBytes=126===t.length?2:8;if(this._requireMasking&&!t.masked)return this._fail("unacceptable","Received unmasked frame but masking is required")},_parseExtendedLength:function(e){var t=this._frame;if(t.length=this._readUInt(e),this._stage=t.masked?3:4,0>this.MESSAGE_OPCODES.indexOf(t.opcode)&&t.length>125)return this._fail("protocol_error","Received control frame having too long payload: "+t.length);if(!this._checkFrameLength())return},_checkFrameLength:function(){return!((this._message?this._message.length:0)+this._frame.length>this._maxLength)||(this._fail("too_large","WebSocket frame length too large"),!1)},_emitFrame:function(e){var t,n,r,i,o,s=this._frame,a=s.payload=e3.mask(e,s.maskingKey),h=s.opcode;if(delete this._frame,h===this.OPCODES.continuation){if(!this._message)return this._fail("protocol_error","Received unexpected continuation frame");this._message.pushFrame(s)}if((h===this.OPCODES.text||h===this.OPCODES.binary)&&(this._message=new eJ,this._message.pushFrame(s)),s.final&&this.MESSAGE_OPCODES.indexOf(h)>=0)return this._emitMessage(this._message);h===this.OPCODES.close&&(n=a.length>=2?a.readUInt16BE(0):null,r=a.length>2?this._encode(a.slice(2)):null,0!==a.length&&!(null!==n&&n>=this.MIN_RESERVED_ERROR&&n<=this.MAX_RESERVED_ERROR)&&0>this.ERROR_CODES.indexOf(n)&&(n=this.ERRORS.protocol_error),(a.length>125||a.length>2&&!r)&&(n=this.ERRORS.protocol_error),this._shutdown(n||this.DEFAULT_ERROR_CODE,r||"")),h===this.OPCODES.ping&&(this.frame(a,"pong"),this.emit("ping",new eo.PingEvent(a.toString()))),h===this.OPCODES.pong&&(o=(i=this._pingCallbacks)[t=this._encode(a)],delete i[t],o&&o(),this.emit("pong",new eo.PongEvent(a.toString())))},_emitMessage:function(e){var e=this._message;e.read(),delete this._message,this._extensions.processIncomingMessage(e,function(e,t){if(e)return this._fail("extension_error",e.message);var n=t.data;if(t.opcode===this.OPCODES.text&&(n=this._encode(n)),null===n)return this._fail("encoding_error","Could not decode a text frame as UTF-8");this.emit("message",new eo.MessageEvent(n))},this)},_encode:function(e){try{var t=e.toString("binary",0,e.length);if(!this.UTF8_MATCH.test(t))return null}catch(e){}return e.toString("utf8",0,e.length)},_readUInt:function(e){return 2===e.length?e.readUInt16BE(0):4294967296*e.readUInt32BE(0)+e.readUInt32BE(4)}};for(var e8 in e4)e3.prototype[e8]=e4[e8];var e5=Y.exports.Buffer,e6=q.default.Stream,e9=U.default,e7=A.default,te={"ws:":80,"wss:":443},tt=function(e,t,n){this._client=e,this._http=new ex("response"),this._origin="object"==typeof e.url?e.url:e9.parse(e.url),this._url="object"==typeof t?t:e9.parse(t),this._options=n||{},this._state=0,this.readable=this.writable=!0,this._paused=!1,this._headers=new X,this._headers.set("Host",this._origin.host),this._headers.set("Connection","keep-alive"),this._headers.set("Proxy-Connection","keep-alive");var r=this._url.auth&&e5.from(this._url.auth,"utf8").toString("base64");r&&this._headers.set("Proxy-Authorization","Basic "+r)};e7.inherits(tt,e6);var tn={setHeader:function(e,t){return 0===this._state&&(this._headers.set(e,t),!0)},start:function(){if(0!==this._state)return!1;this._state=1;var e=this._origin,t=e.port||te[e.protocol],n=["CONNECT "+e.hostname+":"+t+" HTTP/1.1",this._headers.toString(),""];return this.emit("data",e5.from(n.join("\r\n"),"utf8")),!0},pause:function(){this._paused=!0},resume:function(){this._paused=!1,this.emit("drain")},write:function(e){if(!this.writable)return!1;if(this._http.parse(e),!this._http.isComplete())return!this._paused;if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,200===this.statusCode)this.emit("connect",new eo.ConnectEvent);else{var t="Can't establish a connection to the server at "+this._origin.href;this.emit("error",Error(t))}return this.end(),!this._paused},end:function(e){this.writable&&(void 0!==e&&this.write(e),this.readable=this.writable=!1,this.emit("close"),this.emit("end"))},destroy:function(){this.end()}};for(var tr in tn)tt.prototype[tr]=tn[tr];var ti=Y.exports.Buffer,to=F.default,ts=U.default,ta=A.default,th=function(e,t){this.version="hybi-"+e3.VERSION,e3.call(this,null,e,t),this.readyState=-1,this._key=th.generateKey(),this._accept=e3.generateAccept(this._key),this._http=new ex("response");var n=ts.parse(this.url),r=n.auth&&ti.from(n.auth,"utf8").toString("base64");if(0>this.VALID_PROTOCOLS.indexOf(n.protocol))throw Error(this.url+" is not a valid WebSocket URL");this._pathname=(n.pathname||"/")+(n.search||""),this._headers.set("Host",n.host),this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Key",this._key),this._headers.set("Sec-WebSocket-Version",e3.VERSION),this._protocols.length>0&&this._headers.set("Sec-WebSocket-Protocol",this._protocols.join(", ")),r&&this._headers.set("Authorization","Basic "+r)};ta.inherits(th,e3),th.generateKey=function(){return to.randomBytes(16).toString("base64")};var tu={VALID_PROTOCOLS:["ws:","wss:"],proxy:function(e,t){return new tt(this,e,t)},start:function(){return -1===this.readyState&&(this._write(this._handshakeRequest()),this.readyState=0,!0)},parse:function(e){if(3!==this.readyState){if(this.readyState>0)return e3.prototype.parse.call(this,e);this._http.parse(e),this._http.isComplete()&&(this._validateHandshake(),3!==this.readyState&&(this._open(),this.parse(this._http.body)))}},_handshakeRequest:function(){var e=this._extensions.generateOffer();e&&this._headers.set("Sec-WebSocket-Extensions",e);var t=["GET "+this._pathname+" HTTP/1.1",this._headers.toString(),""];return ti.from(t.join("\r\n"),"utf8")},_failHandshake:function(e){e="Error during WebSocket handshake: "+e,this.readyState=3,this.emit("error",Error(e)),this.emit("close",new eo.CloseEvent(this.ERRORS.protocol_error,e))},_validateHandshake:function(){if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,this._http.error)return this._failHandshake(this._http.error.message);if(101!==this._http.statusCode)return this._failHandshake("Unexpected response code: "+this._http.statusCode);var e=this._http.headers,t=e.upgrade||"",n=e.connection||"",r=e["sec-websocket-accept"]||"",i=e["sec-websocket-protocol"]||"";if(""===t)return this._failHandshake("'Upgrade' header is missing");if("websocket"!==t.toLowerCase())return this._failHandshake("'Upgrade' header value is not 'WebSocket'");if(""===n)return this._failHandshake("'Connection' header is missing");if("upgrade"!==n.toLowerCase())return this._failHandshake("'Connection' header value is not 'Upgrade'");if(r!==this._accept)return this._failHandshake("Sec-WebSocket-Accept mismatch");if(this.protocol=null,""!==i){if(0>this._protocols.indexOf(i))return this._failHandshake("Sec-WebSocket-Protocol mismatch");this.protocol=i}try{this._extensions.activate(this.headers["sec-websocket-extensions"])}catch(e){return this._failHandshake(e.message)}}};for(var tl in tu)th.prototype[tl]=tu[tl];var tc=Y.exports.Buffer,td=A.default,tp=function(e,t,n){eo.apply(this,arguments),this._stage=0,this.version="hixie-75",this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("WebSocket-Origin",this._request.headers.origin),this._headers.set("WebSocket-Location",this.url)};td.inherits(tp,eo);var tf={close:function(){return 3!==this.readyState&&(this.readyState=3,this.emit("close",new eo.CloseEvent(null,null)),!0)},parse:function(e){this.readyState>1||(this._reader.put(e),this._reader.eachByte(function(e){var t;switch(this._stage){case -1:this._body.push(e),this._sendHandshakeBody();break;case 0:this._parseLeadingByte(e);break;case 1:if(this._length=(127&e)+128*this._length,this._closing&&0===this._length)return this.close();(128&e)!=128&&(0===this._length?this._stage=0:(this._skipped=0,this._stage=2));break;case 2:if(255===e)this._stage=0,t=tc.from(this._buffer).toString("utf8",0,this._buffer.length),this.emit("message",new eo.MessageEvent(t));else if(this._length)this._skipped+=1,this._skipped===this._length&&(this._stage=0);else if(this._buffer.push(e),this._buffer.length>this._maxLength)return this.close()}},this))},frame:function(e){if(0===this.readyState)return this._queue([e]);if(this.readyState>1)return!1;"string"!=typeof e&&(e=e.toString());var t=tc.byteLength(e),n=tc.allocUnsafe(t+2);return n[0]=0,n.write(e,1),n[n.length-1]=255,this._write(n),!0},_handshakeResponse:function(){var e=["HTTP/1.1 101 Web Socket Protocol Handshake",this._headers.toString(),""];return tc.from(e.join("\r\n"),"utf8")},_parseLeadingByte:function(e){(128&e)==128?(this._length=0,this._stage=1):(delete this._length,delete this._skipped,this._buffer=[],this._stage=2)}};for(var t_ in tf)tp.prototype[t_]=tf[t_];var tv=Y.exports.Buffer,ty=F.default,tg=A.default,tm=function(e){return parseInt((e.match(/[0-9]/g)||[]).join(""),10)},tC=function(e){return(e.match(/ /g)||[]).length},tw=function(e,t,n){tp.apply(this,arguments),this._stage=-1,this._body=[],this.version="hixie-76",this._headers.clear(),this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Origin",this._request.headers.origin),this._headers.set("Sec-WebSocket-Location",this.url)};tg.inherits(tw,tp);var tb={BODY_SIZE:8,start:function(){return!!tp.prototype.start.call(this)&&(this._started=!0,this._sendHandshakeBody(),!0)},close:function(){return 3!==this.readyState&&(1===this.readyState&&this._write(tv.from([255,0])),this.readyState=3,this.emit("close",new eo.CloseEvent(null,null)),!0)},_handshakeResponse:function(){var e=this._request.headers,t=e["sec-websocket-key1"],n=e["sec-websocket-key2"];if(!t)throw Error("Missing required header: Sec-WebSocket-Key1");if(!n)throw Error("Missing required header: Sec-WebSocket-Key2");var r=tm(t),i=tC(t),o=tm(n),s=tC(n);if(r%i!=0||o%s!=0)throw Error("Client sent invalid Sec-WebSocket-Key headers");this._keyValues=[r/i,o/s];var e=["HTTP/1.1 101 WebSocket Protocol Handshake",this._headers.toString(),""];return tv.from(e.join("\r\n"),"binary")},_handshakeSignature:function(){if(this._body.length<this.BODY_SIZE)return null;var e=ty.createHash("md5"),t=tv.allocUnsafe(8+this.BODY_SIZE);return t.writeUInt32BE(this._keyValues[0],0),t.writeUInt32BE(this._keyValues[1],4),tv.from(this._body).copy(t,8,0,this.BODY_SIZE),e.update(t),tv.from(e.digest("binary"),"binary")},_sendHandshakeBody:function(){if(this._started){var e=this._handshakeSignature();e&&(this._write(e),this._stage=0,this._open(),this._body.length>this.BODY_SIZE&&this.parse(this._body.slice(this.BODY_SIZE)))}},_parseLeadingByte:function(e){if(255!==e)return tp.prototype._parseLeadingByte.call(this,e);this._closing=!0,this._length=0,this._stage=1}};for(var tE in tb)tw.prototype[tE]=tb[tE];var tS=A.default,tT=function(e){eo.call(this,null,null,e),this._http=new ex("request")};tS.inherits(tT,eo);var tk={EVENTS:["open","message","error","close","ping","pong"],_bindEventListeners:function(){this.messages.on("error",function(){}),this.on("error",function(){})},parse:function(e){if(this._delegate)return this._delegate.parse(e);if(this._http.parse(e),this._http.isComplete()){this.method=this._http.method,this.url=this._http.url,this.headers=this._http.headers,this.body=this._http.body;var t=this;this._delegate=tT.http(this,this._options),this._delegate.messages=this.messages,this._delegate.io=this.io,this._open(),this.EVENTS.forEach(function(e){this._delegate.on(e,function(n){t.emit(e,n)})},this),this.protocol=this._delegate.protocol,this.version=this._delegate.version,this.parse(this._http.body),this.emit("connect",new eo.ConnectEvent)}},_open:function(){this.__queue.forEach(function(e){this._delegate[e[0]].apply(this._delegate,e[1])},this),this.__queue=[]}};for(var tI in["addExtension","setHeader","start","frame","text","binary","ping","close"].forEach(function(e){tk[e]=function(){return this._delegate?this._delegate[e].apply(this._delegate,arguments):(this.__queue.push([e,arguments]),!0)}}),tk)tT.prototype[tI]=tk[tI];tT.isSecureRequest=function(e){if(e.connection&&void 0!==e.connection.authorized||e.socket&&e.socket.secure)return!0;var t=e.headers;return!!t&&("on"===t.https||"on"===t["x-forwarded-ssl"]||"https"===t["x-forwarded-scheme"]||"https"===t["x-forwarded-proto"])},tT.determineUrl=function(e){return(this.isSecureRequest(e)?"wss:":"ws:")+"//"+e.headers.host+e.url},tT.http=function(e,t){void 0===(t=t||{}).requireMasking&&(t.requireMasking=!0);var n=e.headers,r=n["sec-websocket-version"],i=n["sec-websocket-key"],o=n["sec-websocket-key1"],s=n["sec-websocket-key2"],a=this.determineUrl(e);return r||i?new e3(e,a,t):o||s?new tw(e,a,t):new tp(e,a,t)};var tx={client:function(e,t){return void 0===(t=t||{}).masking&&(t.masking=!0),new th(e,t)},server:function(e){return void 0===(e=e||{}).requireMasking&&(e.requireMasking=!0),new tT(e)},http:function(){return tT.http.apply(tT,arguments)},isSecureRequest:function(e){return tT.isSecureRequest(e)},isWebSocket:function(e){return eo.isWebSocket(e)},validateOptions:function(e,t){eo.validateOptions(e,t)}},tP=function(e,t){for(var n in this.type=e,t)this[n]=t[n]};tP.prototype.initEvent=function(e,t,n){this.type=e,this.bubbles=t,this.cancelable=n},tP.prototype.stopPropagation=function(){},tP.prototype.preventDefault=function(){},tP.CAPTURING_PHASE=1,tP.AT_TARGET=2,tP.BUBBLING_PHASE=3;var tN={onopen:null,onmessage:null,onerror:null,onclose:null,addEventListener:function(e,t,n){this.on(e,t)},removeEventListener:function(e,t,n){this.removeListener(e,t)},dispatchEvent:function(e){e.target=e.currentTarget=this,e.eventPhase=tP.AT_TARGET,this["on"+e.type]&&this["on"+e.type](e),this.emit(e.type,e)}},tR=q.default.Stream,tO=A.default,tD=function(e){e=e||{},tx.validateOptions(e,["headers","extensions","maxLength","ping","proxy","tls","ca"]),this.readable=this.writable=!0;var t=e.headers;if(t)for(var n in t)this._driver.setHeader(n,t[n]);var r=e.extensions;r&&[].concat(r).forEach(this._driver.addExtension,this._driver),this._ping=e.ping,this._pingId=0,this.readyState=tD.CONNECTING,this.bufferedAmount=0,this.protocol="",this.url=this._driver.url,this.version=this._driver.version;var i=this;this._driver.on("open",function(e){i._open()}),this._driver.on("message",function(e){i._receiveMessage(e.data)}),this._driver.on("close",function(e){i._beginClose(e.reason,e.code)}),this._driver.on("error",function(e){i._emitError(e.message)}),this.on("error",function(){}),this._driver.messages.on("drain",function(){i.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){i._pingId+=1,i.ping(i._pingId.toString())},1e3*this._ping)),this._configureStream(),this._proxy||(this._stream.pipe(this._driver.io),this._driver.io.pipe(this._stream))};tO.inherits(tD,tR),tD.CONNECTING=0,tD.OPEN=1,tD.CLOSING=2,tD.CLOSED=3,tD.CLOSE_TIMEOUT=3e4;var tA={write:function(e){return this.send(e)},end:function(e){void 0!==e&&this.send(e),this.close()},pause:function(){return this._driver.messages.pause()},resume:function(){return this._driver.messages.resume()},send:function(e){return!(this.readyState>tD.OPEN)&&(e instanceof m||(e=String(e)),this._driver.messages.write(e))},ping:function(e,t){return!(this.readyState>tD.OPEN)&&this._driver.ping(e,t)},close:function(e,t){if(void 0===e&&(e=1e3),void 0===t&&(t=""),1e3!==e&&(e<3e3||e>4999))throw Error("Failed to execute 'close' on WebSocket: The code must be either 1000, or between 3000 and 4999. "+e+" is neither.");if(this.readyState<tD.CLOSING){var n=this;this._closeTimer=setTimeout(function(){n._beginClose("",1006)},tD.CLOSE_TIMEOUT)}this.readyState!==tD.CLOSED&&(this.readyState=tD.CLOSING),this._driver.close(t,e)},_configureStream:function(){var e=this;this._stream.setTimeout(0),this._stream.setNoDelay(!0),["close","end"].forEach(function(t){this._stream.on(t,function(){e._finalizeClose()})},this),this._stream.on("error",function(t){e._emitError("Network error: "+e.url+": "+t.message),e._finalizeClose()})},_open:function(){if(this.readyState===tD.CONNECTING){this.readyState=tD.OPEN,this.protocol=this._driver.protocol||"";var e=new tP("open");e.initEvent("open",!1,!1),this.dispatchEvent(e)}},_receiveMessage:function(e){if(this.readyState>tD.OPEN)return!1;this.readable&&this.emit("data",e);var t=new tP("message",{data:e});t.initEvent("message",!1,!1),this.dispatchEvent(t)},_emitError:function(e){if(!(this.readyState>=tD.CLOSING)){var t=new tP("error",{message:e});t.initEvent("error",!1,!1),this.dispatchEvent(t)}},_beginClose:function(e,t){this.readyState!==tD.CLOSED&&(this.readyState=tD.CLOSING,this._closeParams=[e,t],this._stream&&(this._stream.destroy(),this._stream.readable||this._finalizeClose()))},_finalizeClose:function(){if(this.readyState!==tD.CLOSED){this.readyState=tD.CLOSED,this._closeTimer&&clearTimeout(this._closeTimer),this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end(),this.readable&&this.emit("end"),this.readable=this.writable=!1;var e=this._closeParams?this._closeParams[0]:"",t=this._closeParams?this._closeParams[1]:1006,n=new tP("close",{code:t,reason:e});n.initEvent("close",!1,!1),this.dispatchEvent(n)}}};for(var tL in tA)tD.prototype[tL]=tA[tL];for(var tM in tN)tD.prototype[tM]=tN[tM];var tq=A.default,tF=H.default,tU=W.default,tB=U.default,tH={"http:":80,"https:":443,"ws:":80,"wss:":443},tW=["https:","wss:"],tj=function(e,t,n){n=n||{},this.url=e,this._driver=tx.client(this.url,{maxLength:n.maxLength,protocols:t}),["open","error"].forEach(function(e){this._driver.on(e,function(){c.headers=c._driver.headers,c.statusCode=c._driver.statusCode})},this);var r=n.proxy||{},i=tB.parse(r.origin||this.url),o=i.port||tH[i.protocol],s=tW.indexOf(i.protocol)>=0,a=function(){c._onConnect()},h=n.net||{},u=n.tls||{},l=r.origin?r.tls||{}:u,c=this;h.host=l.host=i.hostname,h.port=l.port=o,u.ca=u.ca||n.ca,l.servername=l.servername||i.hostname,this._stream=s?tU.connect(l,a):tF.connect(h,a),r.origin&&this._configureProxy(r,u),tD.call(this,n)};tq.inherits(tj,tD),tj.prototype._onConnect=function(){(this._proxy||this._driver).start()},tj.prototype._configureProxy=function(e,t){var n,r=tB.parse(this.url),i=tW.indexOf(r.protocol)>=0,o=this;if(this._proxy=this._driver.proxy(e.origin),e.headers)for(n in e.headers)this._proxy.setHeader(n,e.headers[n]);this._proxy.pipe(this._stream,{end:!1}),this._stream.pipe(this._proxy),this._proxy.on("connect",function(){if(i){var e={socket:o._stream,servername:r.hostname};for(n in t)e[n]=t[n];o._stream=tU.connect(e),o._configureStream()}o._driver.io.pipe(o._stream),o._stream.pipe(o._driver.io),o._driver.start()}),this._proxy.on("error",function(e){o._driver.emit("error",e)})};var tz=q.default.Stream,tV=A.default,tK=function(e,t,n){this.writable=!0,n=n||{},this._stream=t.socket,this._ping=n.ping||this.DEFAULT_PING,this._retry=n.retry||this.DEFAULT_RETRY;var r=tx.isSecureRequest(e)?"https:":"http:";this.url=r+"//"+e.headers.host+e.url,this.lastEventId=e.headers["last-event-id"]||"",this.readyState=tD.CONNECTING;var i=new X,o=this;if(n.headers)for(var s in n.headers)i.set(s,n.headers[s]);if(this._stream&&this._stream.writable){g.nextTick(function(){o._open()}),this._stream.setTimeout(0),this._stream.setNoDelay(!0);var a="HTTP/1.1 200 OK\r\nContent-Type: text/event-stream\r\nCache-Control: no-cache, no-store\r\nConnection: close\r\n"+i.toString()+"\r\nretry: "+Math.floor(1e3*this._retry)+"\r\n\r\n";this._write(a),this._stream.on("drain",function(){o.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){o.ping()},1e3*this._ping)),["error","end"].forEach(function(e){o._stream.on(e,function(){o.close()})})}};tV.inherits(tK,tz),tK.isEventSource=function(e){return"GET"===e.method&&(e.headers.accept||"").split(/\s*,\s*/).indexOf("text/event-stream")>=0};var tY={DEFAULT_PING:10,DEFAULT_RETRY:5,_write:function(e){if(!this.writable)return!1;try{return this._stream.write(e,"utf8")}catch(e){return!1}},_open:function(){if(this.readyState===tD.CONNECTING){this.readyState=tD.OPEN;var e=new tP("open");e.initEvent("open",!1,!1),this.dispatchEvent(e)}},write:function(e){return this.send(e)},end:function(e){void 0!==e&&this.write(e),this.close()},send:function(e,t){if(this.readyState>tD.OPEN)return!1;e=String(e).replace(/(\r\n|\r|\n)/g,"$1data: ");var n="";return(t=t||{}).event&&(n+="event: "+t.event+"\r\n"),t.id&&(n+="id: "+t.id+"\r\n"),n+="data: "+e+"\r\n\r\n",this._write(n)},ping:function(){return this._write(":\r\n\r\n")},close:function(){if(this.readyState>tD.OPEN)return!1;this.readyState=tD.CLOSED,this.writable=!1,this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end();var e=new tP("close");return e.initEvent("close",!1,!1),this.dispatchEvent(e),!0}};for(var tQ in tY)tK.prototype[tQ]=tY[tQ];for(var tG in tN)tK.prototype[tG]=tN[tG];var t$=A.default,tJ=function(e,t,n,r,i){i=i||{},this._stream=t,this._driver=tx.http(e,{maxLength:i.maxLength,protocols:r});var o=this;if(this._stream&&this._stream.writable){if(!this._stream.readable)return this._stream.end();var s=function(){o._stream.removeListener("data",s)};this._stream.on("data",s),tD.call(this,i),g.nextTick(function(){o._driver.start(),o._driver.io.write(n)})}};t$.inherits(tJ,tD),tJ.isWebSocket=function(e){return tx.isWebSocket(e)},tJ.validateOptions=function(e,t){tx.validateOptions(e,t)},tJ.WebSocket=tJ,tJ.Client=tj,tJ.EventSource=tK,Object.defineProperty(K,"__esModule",{value:!0});var tZ=j.default,tX=z.default,t0=V.default,t1=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,t2="websocket",t3="long_polling",t4=function(){function e(e){this.domStorage_=e,this.prefix_="firebase:"}return e.prototype.set=function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),tZ.stringify(t))},e.prototype.get=function(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:tZ.jsonEval(t)},e.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))},e.prototype.prefixedName_=function(e){return this.prefix_+e},e.prototype.toString=function(){return this.domStorage_.toString()},e}(),t8=function(){function e(){this.cache_={},this.isInMemoryStorage=!0}return e.prototype.set=function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t},e.prototype.get=function(e){return tZ.contains(this.cache_,e)?this.cache_[e]:null},e.prototype.remove=function(e){delete this.cache_[e]},e}(),t5=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){var t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new t4(t)}}catch(e){}return new t8},t6=t5("localStorage"),t9=t5("sessionStorage"),t7=new t0.Logger("@firebase/database"),ne=(r=1,function(){return r++}),nt=function(e){var t=tZ.stringToByteArray(e),n=new tZ.Sha1;n.update(t);var r=n.digest();return tZ.base64.encodeByteArray(r)},nn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n="",r=0;r<e.length;r++){var i=e[r];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?n+=nn.apply(null,i):"object"==typeof i?n+=tZ.stringify(i):n+=i,n+=" "}return n},nr=null,ni=!0,no=function(e,t){tZ.assert(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(t7.logLevel=t0.LogLevel.VERBOSE,nr=t7.log.bind(t7),t&&t9.set("logging_enabled",!0)):"function"==typeof e?nr=e:(nr=null,t9.remove("logging_enabled"))},ns=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];!0===ni&&(ni=!1,null===nr&&!0===t9.get("logging_enabled")&&no(!0)),nr&&nr(nn.apply(null,e))},na=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];ns.apply(void 0,tX.__spreadArray([e],tX.__read(t),!1))}},nh=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE INTERNAL ERROR: "+nn.apply(void 0,tX.__spreadArray([],tX.__read(e),!1));t7.error(n)},nu=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE FATAL ERROR: ".concat(nn.apply(void 0,tX.__spreadArray([],tX.__read(e),!1)));throw t7.error(n),Error(n)},nl=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE WARNING: "+nn.apply(void 0,tX.__spreadArray([],tX.__read(e),!1));t7.warn(n)},nc=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&nl("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},nd=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},np=function(e){if(tZ.isNodeSdk()||"complete"===document.readyState)e();else{var t=!1,n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}t||(t=!0,e())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}},nf="[MIN_NAME]",n_="[MAX_NAME]",nv=function(e,t){if(e===t)return 0;if(e===nf||t===n_)return -1;if(t===nf||e===n_)return 1;var n=nS(e),r=nS(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1},ny=function(e,t){return e===t?0:e<t?-1:1},ng=function(e,t){if(t&&e in t)return t[e];throw Error("Missing required key ("+e+") in object: "+tZ.stringify(t))},nm=function(e){if("object"!=typeof e||null===e)return tZ.stringify(e);var t=[];for(var n in e)t.push(n);t.sort();for(var r="{",i=0;i<t.length;i++)0!==i&&(r+=","),r+=tZ.stringify(t[i])+":"+nm(e[t[i]]);return r+"}"},nC=function(e,t){var n=e.length;if(n<=t)return[e];for(var r=[],i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function nw(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}var nb=function(e){tZ.assert(!nd(e),"Invalid JSON number"),0===e?(n=0,r=0,t=1/e==-1/0?1:0):(t=e<0,(e=Math.abs(e))>=22250738585072014e-324?(n=(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,r=Math.round(e*Math.pow(2,52-i)-4503599627370496)):(n=0,r=Math.round(e/5e-324)));var t,n,r,i,o,s=[];for(o=52;o;o-=1)s.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)s.push(n%2?1:0),n=Math.floor(n/2);s.push(t?1:0),s.reverse();var a=s.join(""),h="";for(o=0;o<64;o+=8){var u=parseInt(a.substr(o,8),2).toString(16);1===u.length&&(u="0"+u),h+=u}return h.toLowerCase()},nE=RegExp("^-?(0*)\\d{1,10}$"),nS=function(e){if(nE.test(e)){var t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},nT=function(e){try{e()}catch(e){setTimeout(function(){throw nl("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},nk=function(e,t){var n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n},nI=function(){function e(e,t,n,r,i,o,s,a){void 0===i&&(i=!1),void 0===o&&(o=""),void 0===s&&(s=!1),void 0===a&&(a=!1),this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=s,this.isUsingEmulator=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=t6.get("host:"+e)||this._host}return e.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},e.prototype.isCustomHost=function(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain},Object.defineProperty(e.prototype,"host",{get:function(){return this._host},set:function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&t6.set("host:"+this._host,this.internalHost))},enumerable:!1,configurable:!0}),e.prototype.toString=function(){var e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e},e.prototype.toURLString=function(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?"?ns=".concat(this.namespace):"";return"".concat(e).concat(this.host,"/").concat(t)},e}();function nx(e,t,n){if(tZ.assert("string"==typeof t,"typeof type must == string"),tZ.assert("object"==typeof n,"typeof params must == object"),t===t2)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(t===t3)r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw Error("Unknown connection type: "+t);(e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams)&&(n.ns=e.namespace);var r,i=[];return nw(n,function(e,t){i.push(e+"="+t)}),r+i.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nP=function(){function e(){this.counters_={}}return e.prototype.incrementCounter=function(e,t){void 0===t&&(t=1),tZ.contains(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t},e.prototype.get=function(){return tZ.deepCopy(this.counters_)},e}(),nN={},nR={};function nO(e){var t=e.toString();return nN[t]||(nN[t]=new nP),nN[t]}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nD="",nA=null;"undefined"!=typeof MozWebSocket?nA=MozWebSocket:"undefined"!=typeof WebSocket&&(nA=WebSocket);var nL=function(){function e(t,n,r,i,o,s,a){this.connId=t,this.applicationId=r,this.appCheckToken=i,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=na(this.connId),this.stats_=nO(n),this.connURL=e.connectionURL_(n,s,a,i,r),this.nodeAdmin=n.nodeAdmin}return e.connectionURL_=function(e,t,n,r,i){var o={};return o.v="5",!tZ.isNodeSdk()&&"undefined"!=typeof location&&location.hostname&&t1.test(location.hostname)&&(o.r="f"),t&&(o.s=t),n&&(o.ls=n),r&&(o.ac=r),i&&(o.p=i),nx(e,t2,o)},e.prototype.open=function(e,t){var n=this;this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,t6.set("previous_websocket_failure",!0);try{var r=void 0;if(tZ.isNodeSdk()){var i=this.nodeAdmin?"AdminNode":"Node";r={headers:{"User-Agent":"Firebase/".concat("5","/").concat(nD,"/").concat(g.platform,"/").concat(i),"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(r.headers.Authorization="Bearer ".concat(this.authToken)),this.appCheckToken&&(r.headers["X-Firebase-AppCheck"]=this.appCheckToken);var o=g.env,s=0===this.connURL.indexOf("wss://")?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;s&&(r.proxy={origin:s})}this.mySock=new nA(this.connURL,[],r)}catch(e){this.log_("Error instantiating WebSocket.");var a=e.message||e.data;a&&this.log_(a),this.onClosed_();return}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(e){n.handleIncomingFrame(e)},this.mySock.onerror=function(e){n.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&n.log_(t),n.onClosed_()}},e.prototype.start=function(){},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){var t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&4.4>parseFloat(n[1])&&(t=!0)}return!t&&null!==nA&&!e.forceDisallow_},e.previouslyFailed=function(){return t6.isInMemoryStorage||!0===t6.get("previous_websocket_failure")},e.prototype.markConnectionHealthy=function(){t6.remove("previous_websocket_failure")},e.prototype.appendFrame_=function(e){if(this.frames.push(e),this.frames.length===this.totalFrames){var t=this.frames.join("");this.frames=null;var n=tZ.jsonEval(t);this.onMessage(n)}},e.prototype.handleNewFrameCount_=function(e){this.totalFrames=e,this.frames=[]},e.prototype.extractFrameCount_=function(e){if(tZ.assert(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e},e.prototype.handleIncomingFrame=function(e){if(null!==this.mySock){var t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{var n=this.extractFrameCount_(t);null!==n&&this.appendFrame_(n)}}},e.prototype.send=function(e){this.resetKeepAlive();var t=tZ.stringify(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var n=nC(t,16384);n.length>1&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},e.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},e.prototype.onClosed_=function(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},e.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},e.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){e.mySock&&e.sendString_("0"),e.resetKeepAlive()},Math.floor(45e3))},e.prototype.sendString_=function(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},e.responsesRequiredToBeHealthy=2,e.healthyTimeout=3e4,e}(),nM=function(){function e(e,t){var n=this;this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then(function(e){return n.appCheck=e})}return e.prototype.getToken=function(e){var t=this;return this.appCheck?this.appCheck.getToken(e):new Promise(function(n,r){setTimeout(function(){t.appCheck?t.getToken(e).then(n,r):n(null)},0)})},e.prototype.addTokenChangeListener=function(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(function(t){return t.addTokenListener(e)})},e.prototype.notifyForInvalidToken=function(){nl('Provided AppCheck credentials for the app named "'.concat(this.appName_,'" ')+"are invalid. This usually indicates your app was not initialized correctly.")},e}(),nq=function(){function e(e,t,n){var r=this;this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(function(e){return r.auth_=e})}return e.prototype.getToken=function(e){var t=this;return this.auth_?this.auth_.getToken(e).catch(function(e){return e&&"auth/token-not-initialized"===e.code?(ns("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)}):new Promise(function(n,r){setTimeout(function(){t.auth_?t.getToken(e).then(n,r):n(null)},0)})},e.prototype.addTokenChangeListener=function(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(function(t){return t.addAuthTokenListener(e)})},e.prototype.removeTokenChangeListener=function(e){this.authProvider_.get().then(function(t){return t.removeAuthTokenListener(e)})},e.prototype.notifyForInvalidToken=function(){var e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',nl(e)},e}(),nF=function(){function e(e){this.accessToken=e}return e.prototype.getToken=function(e){return Promise.resolve({accessToken:this.accessToken})},e.prototype.addTokenChangeListener=function(e){e(this.accessToken)},e.prototype.removeTokenChangeListener=function(e){},e.prototype.notifyForInvalidToken=function(){},e.OWNER="owner",e}(),nU=function(){function e(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return e.prototype.closeAfter=function(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},e.prototype.handleResponse=function(e,t){var n=this;this.pendingResponses[e]=t;for(var r=this;this.pendingResponses[this.currentResponseNum]&&"break"!==function(){var e=r.pendingResponses[r.currentResponseNum];delete r.pendingResponses[r.currentResponseNum];for(var t=function(t){e[t]&&nT(function(){n.onMessage_(e[t])})},i=0;i<e.length;++i)t(i);if(r.currentResponseNum===r.closeAfterResponse)return r.onClose&&(r.onClose(),r.onClose=null),"break";r.currentResponseNum++}(););},e}(),nB="start",nH=function(){function e(e,t,n,r,i,o,s){var a=this;this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=o,this.lastSessionId=s,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=na(e),this.stats_=nO(t),this.urlFn=function(e){return a.appCheckToken&&(e.ac=a.appCheckToken),nx(t,t3,e)}}return e.prototype.open=function(e,t){var n=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new nU(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null},Math.floor(3e4)),np(function(){if(!n.isClosed_){n.scriptTagHolder=new nW(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=tX.__read(e,5),i=r[0],o=r[1],s=r[2];if(r[3],r[4],n.incrementIncomingBytes_(e),n.scriptTagHolder){if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,i===nB)n.id=o,n.password=s;else if("close"===i)o?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(o,function(){n.onClosed_()})):n.onClosed_();else throw Error("Unrecognized command received: "+i)}},function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=tX.__read(e,2),i=r[0],o=r[1];n.incrementIncomingBytes_(e),n.myPacketOrderer.handleResponse(i,o)},function(){n.onClosed_()},n.urlFn);var e={};e[nB]="t",e.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=n.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",n.transportSessionId&&(e.s=n.transportSessionId),n.lastSessionId&&(e.ls=n.lastSessionId),n.applicationId&&(e.p=n.applicationId),n.appCheckToken&&(e.ac=n.appCheckToken),"undefined"!=typeof location&&location.hostname&&t1.test(location.hostname)&&(e.r="f");var t=n.urlFn(e);n.log_("Connecting via long-poll to "+t),n.scriptTagHolder.addTag(t,function(){})}})},e.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},e.forceAllow=function(){e.forceAllow_=!0},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){return!tZ.isNodeSdk()&&(!!e.forceAllow_||!e.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"==typeof Windows&&"object"==typeof Windows.UI))},e.prototype.markConnectionHealthy=function(){},e.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},e.prototype.onClosed_=function(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},e.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},e.prototype.send=function(e){var t=tZ.stringify(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);for(var n=nC(tZ.base64Encode(t),1840),r=0;r<n.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[r]),this.curSegmentNum++},e.prototype.addDisconnectPingFrame=function(e,t){if(!tZ.isNodeSdk()){this.myDisconnFrame=document.createElement("iframe");var n={};n.dframe="t",n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},e.prototype.incrementIncomingBytes_=function(e){var t=tZ.stringify(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)},e}(),nW=function(){function e(t,n,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,tZ.isNodeSdk())this.commandCB=t,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=ne(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=e.createIFrame_();var o="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(o='<script>document.domain="'+document.domain+'";</script>');var s="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(s),this.myIFrame.doc.close()}catch(e){ns("frame writing exception"),e.stack&&ns(e.stack),ns(e)}}}return e.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||ns("No IE domain setting required")}catch(n){var t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},e.prototype.close=function(){var e=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)},Math.floor(0)));var t=this.onDisconnect;t&&(this.onDisconnect=null,t())},e.prototype.startLongPoll=function(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););},e.prototype.newRequest_=function(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;this.currentSerial++;var e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;for(var t=this.urlFn(e),n="",r=0;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+30+n.length<=1870){var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}else break;return t+=n,this.addLongPollTag_(t,this.currentSerial),!0},e.prototype.enqueueSegment=function(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()},e.prototype.addLongPollTag_=function(e,t){var n=this;this.outstandingRequests.add(t);var r=function(){n.outstandingRequests.delete(t),n.newRequest_()},i=setTimeout(r,Math.floor(25e3));this.addTag(e,function(){clearTimeout(i),r()})},e.prototype.addTag=function(e,t){var n=this;tZ.isNodeSdk()?this.doNodeLongPoll(e,t):setTimeout(function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){var e=r.readyState;e&&"loaded"!==e&&"complete"!==e||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=function(){ns("Long-poll script failed to load: "+e),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(e){}},Math.floor(1))},e}(),nj=function(){function e(e){this.initTransports_(e)}return Object.defineProperty(e,"ALL_TRANSPORTS",{get:function(){return[nH,nL]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"IS_TRANSPORT_INITIALIZED",{get:function(){return this.globalTransportInitialized_},enumerable:!1,configurable:!0}),e.prototype.initTransports_=function(t){var n,r,i=nL&&nL.isAvailable(),o=i&&!nL.previouslyFailed();if(t.webSocketOnly&&(i||nl("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),o=!0),o)this.transports_=[nL];else{var s=this.transports_=[];try{for(var a=tX.__values(e.ALL_TRANSPORTS),h=a.next();!h.done;h=a.next()){var u=h.value;u&&u.isAvailable()&&s.push(u)}}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}e.globalTransportInitialized_=!0}},e.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")},e.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},e.globalTransportInitialized_=!1,e}(),nz=function(){function e(e,t,n,r,i,o,s,a,h,u){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=o,this.onReady_=s,this.onDisconnect_=a,this.onKill_=h,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=na("c:"+this.id+":"),this.transportManager_=new nj(t),this.log_("Connection created"),this.start_()}return e.prototype.start_=function(){var e=this,t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){e.conn_&&e.conn_.open(n,r)},Math.floor(0));var i=t.healthyTimeout||0;i>0&&(this.healthyTimeout_=nk(function(){e.healthyTimeout_=null,e.isHealthy_||(e.conn_&&e.conn_.bytesReceived>102400?(e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy."),e.isHealthy_=!0,e.conn_.markConnectionHealthy()):e.conn_&&e.conn_.bytesSent>10240?e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive."):(e.log_("Closing unhealthy connection after timeout."),e.close()))},Math.floor(i)))},e.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},e.prototype.disconnReceiver_=function(e){var t=this;return function(n){e===t.conn_?t.onConnectionLost_(n):e===t.secondaryConn_?(t.log_("Secondary connection lost."),t.onSecondaryConnectionLost_()):t.log_("closing an old connection")}},e.prototype.connReceiver_=function(e){var t=this;return function(n){2!==t.state_&&(e===t.rx_?t.onPrimaryMessageReceived_(n):e===t.secondaryConn_?t.onSecondaryMessageReceived_(n):t.log_("message on old connection"))}},e.prototype.sendRequest=function(e){this.sendData_({t:"d",d:e})},e.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},e.prototype.onSecondaryControl_=function(e){if("t"in e){var t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},e.prototype.onSecondaryMessageReceived_=function(e){var t=ng("t",e),n=ng("d",e);if("c"===t)this.onSecondaryControl_(n);else if("d"===t)this.pendingDataMessages.push(n);else throw Error("Unknown protocol layer: "+t)},e.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},e.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},e.prototype.onPrimaryMessageReceived_=function(e){var t=ng("t",e),n=ng("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)},e.prototype.onDataMessage_=function(e){this.onPrimaryResponse_(),this.onMessage_(e)},e.prototype.onPrimaryResponse_=function(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},e.prototype.onControl_=function(e){var t=ng("t",e);if("d"in e){var n=e.d;if("h"===t){var r=tX.__assign({},n);this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?nh("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):nh("Unknown control packet command: "+t)}},e.prototype.onHandshake_=function(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&nl("Protocol version mismatch detected"),this.tryStartUpgrade_())},e.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)},e.prototype.startUpgrade_=function(e){var t=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),nk(function(){t.secondaryConn_&&(t.log_("Timed out trying to upgrade."),t.secondaryConn_.close())},Math.floor(6e4))},e.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())},e.prototype.onConnectionEstablished_=function(e,t){var n=this;this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):nk(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},e.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},e.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()},e.prototype.onConnectionLost_=function(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(t6.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},e.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()},e.prototype.sendData_=function(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)},e.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},e.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},e}(),nV=function(){function e(){}return e.prototype.put=function(e,t,n,r){},e.prototype.merge=function(e,t,n,r){},e.prototype.refreshAuthToken=function(e){},e.prototype.refreshAppCheckToken=function(e){},e.prototype.onDisconnectPut=function(e,t,n){},e.prototype.onDisconnectMerge=function(e,t,n){},e.prototype.onDisconnectCancel=function(e,t){},e.prototype.reportStats=function(e){},e}(),nK=function(){function e(e){this.allowedEvents_=e,this.listeners_={},tZ.assert(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}return e.prototype.trigger=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Array.isArray(this.listeners_[e]))for(var r=tX.__spreadArray([],tX.__read(this.listeners_[e]),!1),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)},e.prototype.on=function(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)},e.prototype.off=function(e,t,n){this.validateEventType_(e);for(var r=this.listeners_[e]||[],i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context)){r.splice(i,1);return}},e.prototype.validateEventType_=function(e){tZ.assert(this.allowedEvents_.find(function(t){return t===e}),"Unknown event: "+e)},e}(),nY=function(e){function t(){var t=e.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||tZ.isMobileCordova()||(window.addEventListener("online",function(){t.online_||(t.online_=!0,t.trigger("online",!0))},!1),window.addEventListener("offline",function(){t.online_&&(t.online_=!1,t.trigger("online",!1))},!1)),t}return tX.__extends(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return tZ.assert("online"===e,"Unknown event type: "+e),[this.online_]},t.prototype.currentlyOnline=function(){return this.online_},t}(nK),nQ=function(){function e(e,t){if(void 0===t){this.pieces_=e.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}return e.prototype.toString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"},e}();function nG(){return new nQ("")}function n$(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function nJ(e){return e.pieces_.length-e.pieceNum_}function nZ(e){var t=e.pieceNum_;return t<e.pieces_.length&&t++,new nQ(e.pieces_,t)}function nX(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function n0(e,t){return void 0===t&&(t=0),e.pieces_.slice(e.pieceNum_+t)}function n1(e){if(e.pieceNum_>=e.pieces_.length)return null;for(var t=[],n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new nQ(t,0)}function n2(e,t){for(var n=[],r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);if(t instanceof nQ)for(var r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else for(var i=t.split("/"),r=0;r<i.length;r++)i[r].length>0&&n.push(i[r]);return new nQ(n,0)}function n3(e){return e.pieceNum_>=e.pieces_.length}function n4(e,t){var n=n$(e),r=n$(t);if(null===n)return t;if(n===r)return n4(nZ(e),nZ(t));throw Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function n8(e,t){for(var n=n0(e,0),r=n0(t,0),i=0;i<n.length&&i<r.length;i++){var o=nv(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1}function n5(e,t){if(nJ(e)!==nJ(t))return!1;for(var n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function n6(e,t){var n=e.pieceNum_,r=t.pieceNum_;if(nJ(e)>nJ(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}var n9=function(e,t){this.errorPrefix_=t,this.parts_=n0(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=tZ.stringLength(this.parts_[n]);n7(this)};function n7(e){if(e.byteLength_>768)throw Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+re(e))}function re(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rt=function(e){function t(){var t,n,r=e.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(n="visibilitychange",t="hidden"):void 0!==document.mozHidden?(n="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(n="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(n="webkitvisibilitychange",t="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,function(){var e=!document[t];e!==r.visible_&&(r.visible_=e,r.trigger("visible",e))},!1),r}return tX.__extends(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return tZ.assert("visible"===e,"Unknown event type: "+e),[this.visible_]},t}(nK),rn=function(e){function t(n,r,i,o,s,a,h,u){var l=e.call(this)||this;if(l.repoInfo_=n,l.applicationId_=r,l.onDataUpdate_=i,l.onConnectStatus_=o,l.onServerInfoUpdate_=s,l.authTokenProvider_=a,l.appCheckTokenProvider_=h,l.authOverride_=u,l.id=t.nextPersistentConnectionId_++,l.log_=na("p:"+l.id+":"),l.interruptReasons_={},l.listens=new Map,l.outstandingPuts_=[],l.outstandingGets_=[],l.outstandingPutCount_=0,l.outstandingGetCount_=0,l.onDisconnectRequestQueue_=[],l.connected_=!1,l.reconnectDelay_=1e3,l.maxReconnectDelay_=3e5,l.securityDebugCallback_=null,l.lastSessionId=null,l.establishConnectionTimer_=null,l.visible_=!1,l.requestCBHash_={},l.requestNumber_=0,l.realtime_=null,l.authToken_=null,l.appCheckToken_=null,l.forceTokenRefresh_=!1,l.invalidAuthTokenCount_=0,l.invalidAppCheckTokenCount_=0,l.firstConnection_=!0,l.lastConnectionAttemptTime_=null,l.lastConnectionEstablishedTime_=null,u&&!tZ.isNodeSdk())throw Error("Auth override specified in options, but not supported on non Node.js platforms");return rt.getInstance().on("visible",l.onVisible_,l),-1===n.host.indexOf("fblocal")&&nY.getInstance().on("online",l.onOnline_,l),l}return tX.__extends(t,e),t.prototype.sendRequest=function(e,t,n){var r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(tZ.stringify(i)),tZ.assert(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},t.prototype.get=function(e){this.initConnection_();var t=new tZ.Deferred,n={p:e._path.toString(),q:e._queryObject};this.outstandingGets_.push({action:"g",request:n,onComplete:function(e){var n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}}),this.outstandingGetCount_++;var r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise},t.prototype.listen=function(e,t,n,r){this.initConnection_();var i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),tZ.assert(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),tZ.assert(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");var s={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(o).set(i,s),this.connected_&&this.sendListen_(s)},t.prototype.sendGet_=function(e){var t=this,n=this.outstandingGets_[e];this.sendRequest("g",n.request,function(r){delete t.outstandingGets_[e],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),n.onComplete&&n.onComplete(r)})},t.prototype.sendListen_=function(e){var n=this,r=e.query,i=r._path.toString(),o=r._queryIdentifier;this.log_("Listen on "+i+" for "+o);var s={p:i};e.tag&&(s.q=r._queryObject,s.t=e.tag),s.h=e.hashFn(),this.sendRequest("q",s,function(s){var a=s.d,h=s.s;t.warnOnListenWarnings_(a,r),(n.listens.get(i)&&n.listens.get(i).get(o))===e&&(n.log_("listen response",s),"ok"!==h&&n.removeListen_(i,o),e.onComplete&&e.onComplete(h,a))})},t.warnOnListenWarnings_=function(e,t){if(e&&"object"==typeof e&&tZ.contains(e,"w")){var n=tZ.safeGet(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();nl("Using an unspecified index. Your data will be downloaded and "+"filtered on the client. Consider adding ".concat(r," at ")+"".concat(i," to your security rules for better performance."))}}},t.prototype.refreshAuthToken=function(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(e)},t.prototype.reduceReconnectDelayIfAdminCredential_=function(e){(e&&40===e.length||tZ.isAdmin(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},t.prototype.refreshAppCheckToken=function(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},function(){})},t.prototype.tryAuth=function(){var e=this;if(this.connected_&&this.authToken_){var t=this.authToken_,n=tZ.isValidFormat(t)?"auth":"gauth",r={cred:t};null===this.authOverride_?r.noauth=!0:"object"==typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(n,r,function(n){var r=n.s,i=n.d||"error";e.authToken_===t&&("ok"===r?e.invalidAuthTokenCount_=0:e.onAuthRevoked_(r,i))})}},t.prototype.tryAppCheck=function(){var e=this;this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},function(t){var n=t.s,r=t.d||"error";"ok"===n?e.invalidAppCheckTokenCount_=0:e.onAppCheckRevoked_(n,r)})},t.prototype.unlisten=function(e,t){var n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),tZ.assert(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)},t.prototype.sendUnlisten_=function(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);var i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},t.prototype.onDisconnectPut=function(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})},t.prototype.onDisconnectMerge=function(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})},t.prototype.onDisconnectCancel=function(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})},t.prototype.sendOnDisconnect_=function(e,t,n,r){var i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,function(e){r&&setTimeout(function(){r(e.s,e.d)},Math.floor(0))})},t.prototype.put=function(e,t,n,r){this.putInternal("p",e,t,n,r)},t.prototype.merge=function(e,t,n,r){this.putInternal("m",e,t,n,r)},t.prototype.putInternal=function(e,t,n,r,i){this.initConnection_();var o={p:t,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;var s=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(s):this.log_("Buffering put: "+t)},t.prototype.sendPut_=function(e){var t=this,n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,function(r){t.log_(n+" response",r),delete t.outstandingPuts_[e],t.outstandingPutCount_--,0===t.outstandingPutCount_&&(t.outstandingPuts_=[]),i&&i(r.s,r.d)})},t.prototype.reportStats=function(e){var t=this;if(this.connected_){var n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,function(e){if("ok"!==e.s){var n=e.d;t.log_("reportStats","Error sending stats: "+n)}})}},t.prototype.onDataMessage_=function(e){if("r"in e){this.log_("from server: "+tZ.stringify(e));var t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else if("error"in e)throw"A server-side error has occurred: "+e.error;else"a"in e&&this.onDataPush_(e.a,e.b)},t.prototype.onDataPush_=function(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):nh("Unrecognized action received from server: "+tZ.stringify(e)+"\nAre you using the latest client?")},t.prototype.onReady_=function(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},t.prototype.scheduleConnect_=function(e){var t=this;tZ.assert(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){t.establishConnectionTimer_=null,t.establishConnection_()},Math.floor(e))},t.prototype.initConnection_=function(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)},t.prototype.onVisible_=function(e){!e||this.visible_||this.reconnectDelay_!==this.maxReconnectDelay_||(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e},t.prototype.onOnline_=function(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},t.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());var e=new Date().getTime()-this.lastConnectionAttemptTime_,t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},t.prototype.establishConnection_=function(){return tX.__awaiter(this,void 0,void 0,function(){var e,n,r,i,o,s,a,h,u,l,c,d,p,f,_=this;return tX.__generator(this,function(v){switch(v.label){case 0:if(!this.shouldReconnect_())return[3,4];this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null,e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+t.nextConnectionId_++,o=this.lastSessionId,s=!1,a=null,h=function(){a?a.close():(s=!0,r())},u=function(e){tZ.assert(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(e)},this.realtime_={close:h,sendRequest:u},l=this.forceTokenRefresh_,this.forceTokenRefresh_=!1,v.label=1;case 1:return v.trys.push([1,3,,4]),[4,Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)])];case 2:return d=(c=tX.__read.apply(void 0,[v.sent(),2]))[0],p=c[1],s?ns("getToken() completed but was canceled"):(ns("getToken() completed. Creating connection."),this.authToken_=d&&d.accessToken,this.appCheckToken_=p&&p.token,a=new nz(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,r,function(e){nl(e+" ("+_.repoInfo_.toString()+")"),_.interrupt("server_kill")},o)),[3,4];case 3:return f=v.sent(),this.log_("Failed to get token: "+f),s||(this.repoInfo_.nodeAdmin&&nl(f),h()),[3,4];case 4:return[2]}})})},t.prototype.interrupt=function(e){ns("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},t.prototype.resume=function(e){ns("Resuming connection for reason: "+e),delete this.interruptReasons_[e],tZ.isEmpty(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},t.prototype.handleTimestamp_=function(e){var t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})},t.prototype.cancelSentTransactions_=function(){for(var e=0;e<this.outstandingPuts_.length;e++){var t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},t.prototype.onListenRevoked_=function(e,t){n=t?t.map(function(e){return nm(e)}).join("$"):"default";var n,r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")},t.prototype.removeListen_=function(e,t){var n,r=new nQ(e).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(t),i.delete(t),0===i.size&&this.listens.delete(r)}else n=void 0;return n},t.prototype.onAuthRevoked_=function(e,t){ns("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},t.prototype.onAppCheckRevoked_=function(e,t){ns("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())},t.prototype.onSecurityDebugPacket_=function(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))},t.prototype.restoreState_=function(){var e,t,n,r;this.tryAuth(),this.tryAppCheck();try{for(var i=tX.__values(this.listens.values()),o=i.next();!o.done;o=i.next()){var s=o.value;try{for(var a=(n=void 0,tX.__values(s.values())),h=a.next();!h.done;h=a.next()){var u=h.value;this.sendListen_(u)}}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}for(var l=0;l<this.outstandingPuts_.length;l++)this.outstandingPuts_[l]&&this.sendPut_(l);for(;this.onDisconnectRequestQueue_.length;){var c=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(c.action,c.pathString,c.data,c.onComplete)}for(var l=0;l<this.outstandingGets_.length;l++)this.outstandingGets_[l]&&this.sendGet_(l)},t.prototype.sendConnectStats_=function(){var e={},t="js";tZ.isNodeSdk()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+nD.replace(/\./g,"-")]=1,tZ.isMobileCordova()?e["framework.cordova"]=1:tZ.isReactNative()&&(e["framework.reactnative"]=1),this.reportStats(e)},t.prototype.shouldReconnect_=function(){var e=nY.getInstance().currentlyOnline();return tZ.isEmpty(this.interruptReasons_)&&e},t.nextPersistentConnectionId_=0,t.nextConnectionId_=0,t}(nV),rr=function(){function e(e,t){this.name=e,this.node=t}return e.Wrap=function(t,n){return new e(t,n)},e}(),ri=function(){function e(){}return e.prototype.getCompare=function(){return this.compare.bind(this)},e.prototype.indexedValueChanged=function(e,t){var n=new rr(nf,e),r=new rr(nf,t);return 0!==this.compare(n,r)},e.prototype.minPost=function(){return rr.MIN},e}(),ro=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return tX.__extends(t,e),Object.defineProperty(t,"__EMPTY_NODE",{get:function(){return a},set:function(e){a=e},enumerable:!1,configurable:!0}),t.prototype.compare=function(e,t){return nv(e.name,t.name)},t.prototype.isDefinedOn=function(e){throw tZ.assertionError("KeyIndex.isDefinedOn not expected to be called.")},t.prototype.indexedValueChanged=function(e,t){return!1},t.prototype.minPost=function(){return rr.MIN},t.prototype.maxPost=function(){return new rr(n_,a)},t.prototype.makePost=function(e,t){return tZ.assert("string"==typeof e,"KeyIndex indexValue must always be a string."),new rr(e,a)},t.prototype.toString=function(){return".key"},t}(ri),rs=new ro,ra=function(){function e(e,t,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!e.isEmpty();)if(o=t?n(e.key,t):1,r&&(o*=-1),o<0)e=this.isReverse_?e.left:e.right;else if(0===o){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}return e.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e},e.prototype.hasNext=function(){return this.nodeStack_.length>0},e.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}},e}(),rh=function(){function e(t,n,r,i,o){this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:rl.EMPTY_NODE,this.right=null!=o?o:rl.EMPTY_NODE}return e.prototype.copy=function(t,n,r,i,o){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},e.prototype.count=function(){return this.left.count()+1+this.right.count()},e.prototype.isEmpty=function(){return!1},e.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},e.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},e.prototype.minKey=function(){return this.min_().key},e.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},e.prototype.insert=function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()},e.prototype.removeMin_=function(){if(this.left.isEmpty())return rl.EMPTY_NODE;var e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()},e.prototype.remove=function(e,t){var n,r;if(n=this,0>t(e,n.key))n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return rl.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()},e.prototype.isRed_=function(){return this.color},e.prototype.fixUp_=function(){var e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e},e.prototype.moveRedLeft_=function(){var e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e},e.prototype.moveRedRight_=function(){var e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e},e.prototype.rotateLeft_=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},e.prototype.rotateRight_=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},e.prototype.colorFlip_=function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},e.prototype.checkMaxDepth_=function(){return Math.pow(2,this.check_())<=this.count()+1},e.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e===this.right.check_())return e+(this.isRed_()?0:1);throw Error("Black depths differ")},e.RED=!0,e.BLACK=!1,e}(),ru=function(){function e(){}return e.prototype.copy=function(e,t,n,r,i){return this},e.prototype.insert=function(e,t,n){return new rh(e,t,null)},e.prototype.remove=function(e,t){return this},e.prototype.count=function(){return 0},e.prototype.isEmpty=function(){return!0},e.prototype.inorderTraversal=function(e){return!1},e.prototype.reverseTraversal=function(e){return!1},e.prototype.minKey=function(){return null},e.prototype.maxKey=function(){return null},e.prototype.check_=function(){return 0},e.prototype.isRed_=function(){return!1},e}(),rl=function(){function e(t,n){void 0===n&&(n=e.EMPTY_NODE),this.comparator_=t,this.root_=n}return e.prototype.insert=function(t,n){return new e(this.comparator_,this.root_.insert(t,n,this.comparator_).copy(null,null,rh.BLACK,null,null))},e.prototype.remove=function(t){return new e(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,rh.BLACK,null,null))},e.prototype.get=function(e){for(var t,n=this.root_;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null},e.prototype.getPredecessorKey=function(e){for(var t,n=this.root_,r=null;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty()){if(r)return r.key;return null}for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},e.prototype.isEmpty=function(){return this.root_.isEmpty()},e.prototype.count=function(){return this.root_.count()},e.prototype.minKey=function(){return this.root_.minKey()},e.prototype.maxKey=function(){return this.root_.maxKey()},e.prototype.inorderTraversal=function(e){return this.root_.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.root_.reverseTraversal(e)},e.prototype.getIterator=function(e){return new ra(this.root_,null,this.comparator_,!1,e)},e.prototype.getIteratorFrom=function(e,t){return new ra(this.root_,e,this.comparator_,!1,t)},e.prototype.getReverseIteratorFrom=function(e,t){return new ra(this.root_,e,this.comparator_,!0,t)},e.prototype.getReverseIterator=function(e){return new ra(this.root_,null,this.comparator_,!0,e)},e.EMPTY_NODE=new ru,e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rc(e,t){return nv(e.name,t.name)}function rd(e,t){return nv(e,t)}var rp=function(e){return"number"==typeof e?"number:"+nb(e):"string:"+e},rf=function(e){if(e.isLeafNode()){var t=e.val();tZ.assert("string"==typeof t||"number"==typeof t||"object"==typeof t&&tZ.contains(t,".sv"),"Priority must be a string or number.")}else tZ.assert(e===h||e.isEmpty(),"priority of unexpected type.");tZ.assert(e===h||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},r_=function(){function e(t,n){void 0===n&&(n=e.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=n,this.lazyHash_=null,tZ.assert(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),rf(this.priorityNode_)}return Object.defineProperty(e,"__childrenNodeConstructor",{get:function(){return u},set:function(e){u=e},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!0},e.prototype.getPriority=function(){return this.priorityNode_},e.prototype.updatePriority=function(t){return new e(this.value_,t)},e.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.getChild=function(t){return n3(t)?this:".priority"===n$(t)?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.hasChild=function(){return!1},e.prototype.getPredecessorChildName=function(e,t){return null},e.prototype.updateImmediateChild=function(t,n){return".priority"===t?this.updatePriority(n):n.isEmpty()&&".priority"!==t?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)},e.prototype.updateChild=function(t,n){var r=n$(t);return null===r?n:n.isEmpty()&&".priority"!==r?this:(tZ.assert(".priority"!==r||1===nJ(t),".priority must be the last token in a path"),this.updateImmediateChild(r,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(nZ(t),n)))},e.prototype.isEmpty=function(){return!1},e.prototype.numChildren=function(){return 0},e.prototype.forEachChild=function(e,t){return!1},e.prototype.val=function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.priorityNode_.isEmpty()||(e+="priority:"+rp(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":","number"===t?e+=nb(this.value_):e+=this.value_,this.lazyHash_=nt(e)}return this.lazyHash_},e.prototype.getValue=function(){return this.value_},e.prototype.compareTo=function(t){return t===e.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof e.__childrenNodeConstructor?-1:(tZ.assert(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},e.prototype.compareToLeafNode_=function(t){var n=typeof t.value_,r=typeof this.value_,i=e.VALUE_TYPE_ORDER.indexOf(n),o=e.VALUE_TYPE_ORDER.indexOf(r);return(tZ.assert(i>=0,"Unknown leaf type: "+n),tZ.assert(o>=0,"Unknown leaf type: "+r),i!==o)?o-i:"object"===r?0:this.value_<t.value_?-1:this.value_===t.value_?0:1},e.prototype.withIndex=function(){return this},e.prototype.isIndexed=function(){return!0},e.prototype.equals=function(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)},e.VALUE_TYPE_ORDER=["object","boolean","number","string"],e}(),rv=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return tX.__extends(t,e),t.prototype.compare=function(e,t){var n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?nv(e.name,t.name):i},t.prototype.isDefinedOn=function(e){return!e.getPriority().isEmpty()},t.prototype.indexedValueChanged=function(e,t){return!e.getPriority().equals(t.getPriority())},t.prototype.minPost=function(){return rr.MIN},t.prototype.maxPost=function(){return new rr(n_,new r_("[PRIORITY-POST]",c))},t.prototype.makePost=function(e,t){var n=l(e);return new rr(t,new r_("[PRIORITY-POST]",n))},t.prototype.toString=function(){return".priority"},t}(ri)),ry=Math.log(2),rg=function(){function e(e){this.count=parseInt(Math.log(e+1)/ry,10),this.current_=this.count-1;var t=parseInt(Array(this.count+1).join("1"),2);this.bits_=e+1&t}return e.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e},e}(),rm=function(e,t,n,r){e.sort(t);var i=function(t,r){var o,s,a=r-t;if(0===a)return null;if(1===a)return o=e[t],s=n?n(o):o,new rh(s,o.node,rh.BLACK,null,null);var h=parseInt(a/2,10)+t,u=i(t,h),l=i(h+1,r);return o=e[h],s=n?n(o):o,new rh(s,o.node,rh.BLACK,u,l)},o=function(t){for(var r=null,o=null,s=e.length,a=function(t,r){var o=s-t,a=s;s-=t;var u=i(o+1,a),l=e[o],c=n?n(l):l;h(new rh(c,l.node,r,null,u))},h=function(e){r?(r.left=e,r=e):(o=e,r=e)},u=0;u<t.count;++u){var l=t.nextBitIsOne(),c=Math.pow(2,t.count-(u+1));l?a(c,rh.BLACK):(a(c,rh.BLACK),a(c,rh.RED))}return o}(new rg(e.length));return new rl(r||t,o)},rC={},rw=function(){function e(e,t){this.indexes_=e,this.indexSet_=t}return Object.defineProperty(e,"Default",{get:function(){return tZ.assert(rC&&rv,"ChildrenNode.ts has not been loaded"),d=d||new e({".priority":rC},{".priority":rv})},enumerable:!1,configurable:!0}),e.prototype.get=function(e){var t=tZ.safeGet(this.indexes_,e);if(!t)throw Error("No index defined for "+e);return t instanceof rl?t:null},e.prototype.hasIndex=function(e){return tZ.contains(this.indexSet_,e.toString())},e.prototype.addIndex=function(t,n){tZ.assert(t!==rs,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var r,i=[],o=!1,s=n.getIterator(rr.Wrap),a=s.getNext();a;)o=o||t.isDefinedOn(a.node),i.push(a),a=s.getNext();r=o?rm(i,t.getCompare()):rC;var h=t.toString(),u=tX.__assign({},this.indexSet_);u[h]=t;var l=tX.__assign({},this.indexes_);return l[h]=r,new e(l,u)},e.prototype.addToIndexes=function(t,n){var r=this,i=tZ.map(this.indexes_,function(e,i){var o=tZ.safeGet(r.indexSet_,i);if(tZ.assert(o,"Missing index implementation for "+i),e===rC){if(!o.isDefinedOn(t.node))return rC;for(var s=[],a=n.getIterator(rr.Wrap),h=a.getNext();h;)h.name!==t.name&&s.push(h),h=a.getNext();return s.push(t),rm(s,o.getCompare())}var u=n.get(t.name),l=e;return u&&(l=l.remove(new rr(t.name,u))),l.insert(t,t.node)});return new e(i,this.indexSet_)},e.prototype.removeFromIndexes=function(t,n){var r=tZ.map(this.indexes_,function(e){if(e===rC)return e;var r=n.get(t.name);return r?e.remove(new rr(t.name,r)):e});return new e(r,this.indexSet_)},e}(),rb=function(){function e(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&rf(this.priorityNode_),this.children_.isEmpty()&&tZ.assert(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(e,"EMPTY_NODE",{get:function(){return p||(p=new e(new rl(rd),null,rw.Default))},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!1},e.prototype.getPriority=function(){return this.priorityNode_||p},e.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new e(this.children_,t,this.indexMap_)},e.prototype.getImmediateChild=function(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?p:t},e.prototype.getChild=function(e){var t=n$(e);return null===t?this:this.getImmediateChild(t).getChild(nZ(e))},e.prototype.hasChild=function(e){return null!==this.children_.get(e)},e.prototype.updateImmediateChild=function(t,n){if(tZ.assert(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);var r=new rr(t,n),i=void 0,o=void 0;n.isEmpty()?(i=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(t,n),o=this.indexMap_.addToIndexes(r,this.children_));var s=i.isEmpty()?p:this.priorityNode_;return new e(i,s,o)},e.prototype.updateChild=function(e,t){var n=n$(e);if(null===n)return t;tZ.assert(".priority"!==n$(e)||1===nJ(e),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(nZ(e),t);return this.updateImmediateChild(n,r)},e.prototype.isEmpty=function(){return this.children_.isEmpty()},e.prototype.numChildren=function(){return this.children_.count()},e.prototype.val=function(t){if(this.isEmpty())return null;var n={},r=0,i=0,o=!0;if(this.forEachChild(rv,function(s,a){n[s]=a.val(t),r++,o&&e.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):o=!1}),t||!o||!(i<2*r))return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n;var s=[];for(var a in n)s[a]=n[a];return s},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.getPriority().isEmpty()||(e+="priority:"+rp(this.getPriority().val())+":"),this.forEachChild(rv,function(t,n){var r=n.hash();""!==r&&(e+=":"+t+":"+r)}),this.lazyHash_=""===e?"":nt(e)}return this.lazyHash_},e.prototype.getPredecessorChildName=function(e,t,n){var r=this.resolveIndex_(n);if(!r)return this.children_.getPredecessorKey(e);var i=r.getPredecessorKey(new rr(e,t));return i?i.name:null},e.prototype.getFirstChildName=function(e){var t=this.resolveIndex_(e);if(!t)return this.children_.minKey();var n=t.minKey();return n&&n.name},e.prototype.getFirstChild=function(e){var t=this.getFirstChildName(e);return t?new rr(t,this.children_.get(t)):null},e.prototype.getLastChildName=function(e){var t=this.resolveIndex_(e);if(!t)return this.children_.maxKey();var n=t.maxKey();return n&&n.name},e.prototype.getLastChild=function(e){var t=this.getLastChildName(e);return t?new rr(t,this.children_.get(t)):null},e.prototype.forEachChild=function(e,t){var n=this.resolveIndex_(e);return n?n.inorderTraversal(function(e){return t(e.name,e.node)}):this.children_.inorderTraversal(t)},e.prototype.getIterator=function(e){return this.getIteratorFrom(e.minPost(),e)},e.prototype.getIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,function(e){return e});for(var r=this.children_.getIteratorFrom(e.name,rr.Wrap),i=r.peek();null!=i&&0>t.compare(i,e);)r.getNext(),i=r.peek();return r},e.prototype.getReverseIterator=function(e){return this.getReverseIteratorFrom(e.maxPost(),e)},e.prototype.getReverseIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,function(e){return e});for(var r=this.children_.getReverseIteratorFrom(e.name,rr.Wrap),i=r.peek();null!=i&&t.compare(i,e)>0;)r.getNext(),i=r.peek();return r},e.prototype.compareTo=function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===rE?-1:0},e.prototype.withIndex=function(t){if(t===rs||this.indexMap_.hasIndex(t))return this;var n=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,n)},e.prototype.isIndexed=function(e){return e===rs||this.indexMap_.hasIndex(e)},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode()||!this.getPriority().equals(e.getPriority())||this.children_.count()!==e.children_.count())return!1;for(var t=this.getIterator(rv),n=e.getIterator(rv),r=t.getNext(),i=n.getNext();r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=t.getNext(),i=n.getNext()}return null===r&&null===i},e.prototype.resolveIndex_=function(e){return e===rs?null:this.indexMap_.get(e.toString())},e.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,e}(),rE=new(function(e){function t(){return e.call(this,new rl(rd),rb.EMPTY_NODE,rw.Default)||this}return tX.__extends(t,e),t.prototype.compareTo=function(e){return e===this?0:1},t.prototype.equals=function(e){return e===this},t.prototype.getPriority=function(){return this},t.prototype.getImmediateChild=function(e){return rb.EMPTY_NODE},t.prototype.isEmpty=function(){return!1},t}(rb));function rS(e,t){if(void 0===t&&(t=null),null===e)return rb.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),tZ.assert(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e){var n=e;return new r_(n,rS(t))}if(e instanceof Array){var r=rb.EMPTY_NODE;return nw(e,function(t,n){if(tZ.contains(e,t)&&"."!==t.substring(0,1)){var i=rS(n);(i.isLeafNode()||!i.isEmpty())&&(r=r.updateImmediateChild(t,i))}}),r.updatePriority(rS(t))}var i=[],o=!1;if(nw(e,function(e,t){if("."!==e.substring(0,1)){var n=rS(t);n.isEmpty()||(o=o||!n.getPriority().isEmpty(),i.push(new rr(e,n)))}}),0===i.length)return rb.EMPTY_NODE;var s=rm(i,rc,function(e){return e.name},rd);if(!o)return new rb(s,rS(t),rw.Default);var a=rm(i,rv.getCompare());return new rb(s,rS(t),new rw({".priority":a},{".priority":rv}))}Object.defineProperties(rr,{MIN:{value:new rr(nf,rb.EMPTY_NODE)},MAX:{value:new rr(n_,rE)}}),ro.__EMPTY_NODE=rb.EMPTY_NODE,r_.__childrenNodeConstructor=rb,h=rE,c=rE,l=rS;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rT=function(e){function t(t){var n=e.call(this)||this;return n.indexPath_=t,tZ.assert(!n3(t)&&".priority"!==n$(t),"Can't create PathIndex with empty path or .priority key"),n}return tX.__extends(t,e),t.prototype.extractChild=function(e){return e.getChild(this.indexPath_)},t.prototype.isDefinedOn=function(e){return!e.getChild(this.indexPath_).isEmpty()},t.prototype.compare=function(e,t){var n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?nv(e.name,t.name):i},t.prototype.makePost=function(e,t){var n=rS(e),r=rb.EMPTY_NODE.updateChild(this.indexPath_,n);return new rr(t,r)},t.prototype.maxPost=function(){var e=rb.EMPTY_NODE.updateChild(this.indexPath_,rE);return new rr(n_,e)},t.prototype.toString=function(){return n0(this.indexPath_,0).join("/")},t}(ri),rk=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return tX.__extends(t,e),t.prototype.compare=function(e,t){var n=e.node.compareTo(t.node);return 0===n?nv(e.name,t.name):n},t.prototype.isDefinedOn=function(e){return!0},t.prototype.indexedValueChanged=function(e,t){return!e.equals(t)},t.prototype.minPost=function(){return rr.MIN},t.prototype.maxPost=function(){return rr.MAX},t.prototype.makePost=function(e,t){var n=rS(e);return new rr(t,n)},t.prototype.toString=function(){return".value"},t}(ri));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rI(e){return{type:"value",snapshotNode:e}}function rx(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function rP(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function rN(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rR=function(){function e(e){this.index_=e}return e.prototype.updateChild=function(e,t,n,r,i,o){tZ.assert(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var s=e.getImmediateChild(t);return s.getChild(r).equals(n.getChild(r))&&s.isEmpty()===n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(rP(t,s)):tZ.assert(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):s.isEmpty()?o.trackChildChange(rx(t,n)):o.trackChildChange(rN(t,n,s))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)},e.prototype.updateFullNode=function(e,t,n){return null==n||(e.isLeafNode()||e.forEachChild(rv,function(e,r){t.hasChild(e)||n.trackChildChange(rP(e,r))}),t.isLeafNode()||t.forEachChild(rv,function(t,r){if(e.hasChild(t)){var i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(rN(t,r,i))}else n.trackChildChange(rx(t,r))})),t.withIndex(this.index_)},e.prototype.updatePriority=function(e,t){return e.isEmpty()?rb.EMPTY_NODE:e.updatePriority(t)},e.prototype.filtersNodes=function(){return!1},e.prototype.getIndexedFilter=function(){return this},e.prototype.getIndex=function(){return this.index_},e}(),rO=function(){function e(t){this.indexedFilter_=new rR(t.getIndex()),this.index_=t.getIndex(),this.startPost_=e.getStartPost_(t),this.endPost_=e.getEndPost_(t),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}return e.prototype.getStartPost=function(){return this.startPost_},e.prototype.getEndPost=function(){return this.endPost_},e.prototype.matches=function(e){var t=this.startIsInclusive_?0>=this.index_.compare(this.getStartPost(),e):0>this.index_.compare(this.getStartPost(),e),n=this.endIsInclusive_?0>=this.index_.compare(e,this.getEndPost()):0>this.index_.compare(e,this.getEndPost());return t&&n},e.prototype.updateChild=function(e,t,n,r,i,o){return this.matches(new rr(t,n))||(n=rb.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,o)},e.prototype.updateFullNode=function(e,t,n){t.isLeafNode()&&(t=rb.EMPTY_NODE);var r=t.withIndex(this.index_);r=r.updatePriority(rb.EMPTY_NODE);var i=this;return t.forEachChild(rv,function(e,t){i.matches(new rr(e,t))||(r=r.updateImmediateChild(e,rb.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.indexedFilter_},e.prototype.getIndex=function(){return this.index_},e.getStartPost_=function(e){if(!e.hasStart())return e.getIndex().minPost();var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)},e.getEndPost_=function(e){if(!e.hasEnd())return e.getIndex().maxPost();var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)},e}(),rD=function(){function e(e){var t=this;this.withinDirectionalStart=function(e){return t.reverse_?t.withinEndPost(e):t.withinStartPost(e)},this.withinDirectionalEnd=function(e){return t.reverse_?t.withinStartPost(e):t.withinEndPost(e)},this.withinStartPost=function(e){var n=t.index_.compare(t.rangedFilter_.getStartPost(),e);return t.startIsInclusive_?n<=0:n<0},this.withinEndPost=function(e){var n=t.index_.compare(e,t.rangedFilter_.getEndPost());return t.endIsInclusive_?n<=0:n<0},this.rangedFilter_=new rO(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}return e.prototype.updateChild=function(e,t,n,r,i,o){return(this.rangedFilter_.matches(new rr(t,n))||(n=rb.EMPTY_NODE),e.getImmediateChild(t).equals(n))?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,o):this.fullLimitUpdateChild_(e,t,n,i,o)},e.prototype.updateFullNode=function(e,t,n){var r;if(t.isLeafNode()||t.isEmpty())r=rb.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){r=rb.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var s=i.getNext();if(this.withinDirectionalStart(s)){if(this.withinDirectionalEnd(s))r=r.updateImmediateChild(s.name,s.node),o++;else break}}}else{r=(r=t.withIndex(this.index_)).updatePriority(rb.EMPTY_NODE);var i=void 0;i=this.reverse_?r.getReverseIterator(this.index_):r.getIterator(this.index_);for(var o=0;i.hasNext();){var s=i.getNext();o<this.limit_&&this.withinDirectionalStart(s)&&this.withinDirectionalEnd(s)?o++:r=r.updateImmediateChild(s.name,rb.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},e.prototype.getIndex=function(){return this.index_},e.prototype.fullLimitUpdateChild_=function(e,t,n,r,i){if(this.reverse_){var o,s=this.index_.getCompare();o=function(e,t){return s(t,e)}}else o=this.index_.getCompare();tZ.assert(e.numChildren()===this.limit_,"");var a=new rr(t,n),h=this.reverse_?e.getFirstChild(this.index_):e.getLastChild(this.index_),u=this.rangedFilter_.matches(a);if(e.hasChild(t)){for(var l=e.getImmediateChild(t),c=r.getChildAfterChild(this.index_,h,this.reverse_);null!=c&&(c.name===t||e.hasChild(c.name));)c=r.getChildAfterChild(this.index_,c,this.reverse_);var d=null==c?1:o(c,a);if(u&&!n.isEmpty()&&d>=0)return null!=i&&i.trackChildChange(rN(t,n,l)),e.updateImmediateChild(t,n);null!=i&&i.trackChildChange(rP(t,l));var p=e.updateImmediateChild(t,rb.EMPTY_NODE);return null!=c&&this.rangedFilter_.matches(c)?(null!=i&&i.trackChildChange(rx(c.name,c.node)),p.updateImmediateChild(c.name,c.node)):p}return n.isEmpty()?e:u&&o(h,a)>=0?(null!=i&&(i.trackChildChange(rP(h.name,h.node)),i.trackChildChange(rx(t,n))),e.updateImmediateChild(t,n).updateImmediateChild(h.name,rb.EMPTY_NODE)):e},e}(),rA=function(){function e(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=rv}return e.prototype.hasStart=function(){return this.startSet_},e.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_},e.prototype.getIndexStartValue=function(){return tZ.assert(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},e.prototype.getIndexStartName=function(){return(tZ.assert(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:nf},e.prototype.hasEnd=function(){return this.endSet_},e.prototype.getIndexEndValue=function(){return tZ.assert(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},e.prototype.getIndexEndName=function(){return(tZ.assert(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:n_},e.prototype.hasLimit=function(){return this.limitSet_},e.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},e.prototype.getLimit=function(){return tZ.assert(this.limitSet_,"Only valid if limit has been set"),this.limit_},e.prototype.getIndex=function(){return this.index_},e.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},e.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===rv},e.prototype.copy=function(){var t=new e;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},e}();function rL(e,t,n){var r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function rM(e,t,n){var r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function rq(e,t){var n=e.copy();return n.index_=t,n}function rF(e){var t,n={};if(e.isDefault())return n;if(e.index_===rv?t="$priority":e.index_===rk?t="$value":e.index_===rs?t="$key":(tZ.assert(e.index_ instanceof rT,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=tZ.stringify(t),e.startSet_){var r=e.startAfterSet_?"startAfter":"startAt";n[r]=tZ.stringify(e.indexStartValue_),e.startNameSet_&&(n[r]+=","+tZ.stringify(e.indexStartName_))}if(e.endSet_){var i=e.endBeforeSet_?"endBefore":"endAt";n[i]=tZ.stringify(e.indexEndValue_),e.endNameSet_&&(n[i]+=","+tZ.stringify(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_),n}function rU(e){var t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;var n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==rv&&(t.i=e.index_.toString()),t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rB=function(e){function t(t,n,r,i){var o=e.call(this)||this;return o.repoInfo_=t,o.onDataUpdate_=n,o.authTokenProvider_=r,o.appCheckTokenProvider_=i,o.log_=na("p:rest:"),o.listens_={},o}return tX.__extends(t,e),t.prototype.reportStats=function(e){throw Error("Method not implemented.")},t.getListenId_=function(e,t){return void 0!==t?"tag$"+t:(tZ.assert(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())},t.prototype.listen=function(e,n,r,i){var o=this,s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);var a=t.getListenId_(e,r),h={};this.listens_[a]=h;var u=rF(e._queryParams);this.restRequest_(s+".json",u,function(e,t){var n=t;404===e&&(n=null,e=null),null===e&&o.onDataUpdate_(s,n,!1,r),tZ.safeGet(o.listens_,a)===h&&i(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)})},t.prototype.unlisten=function(e,n){var r=t.getListenId_(e,n);delete this.listens_[r]},t.prototype.get=function(e){var t=this,n=rF(e._queryParams),r=e._path.toString(),i=new tZ.Deferred;return this.restRequest_(r+".json",n,function(e,n){var o=n;404===e&&(o=null,e=null),null===e?(t.onDataUpdate_(r,o,!1,null),i.resolve(o)):i.reject(Error(o))}),i.promise},t.prototype.refreshAuthToken=function(e){},t.prototype.restRequest_=function(e,t,n){var r=this;return void 0===t&&(t={}),t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(function(i){var o=tX.__read(i,2),s=o[0],a=o[1];s&&s.accessToken&&(t.auth=s.accessToken),a&&a.token&&(t.ac=a.token);var h=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+e+"?ns="+r.repoInfo_.namespace+tZ.querystring(t);r.log_("Sending REST request for "+h);var u=new XMLHttpRequest;u.onreadystatechange=function(){if(n&&4===u.readyState){r.log_("REST Response for "+h+" received. status:",u.status,"response:",u.responseText);var e=null;if(u.status>=200&&u.status<300){try{e=tZ.jsonEval(u.responseText)}catch(e){nl("Failed to parse JSON response for "+h+": "+u.responseText)}n(null,e)}else 401!==u.status&&404!==u.status&&nl("Got unsuccessful REST response for "+h+" Status: "+u.status),n(u.status);n=null}},u.open("GET",h,!0),u.send()})},t}(nV),rH=function(){function e(){this.rootNode_=rb.EMPTY_NODE}return e.prototype.getNode=function(e){return this.rootNode_.getChild(e)},e.prototype.updateSnapshot=function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)},e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rW(){return{value:null,children:new Map}}function rj(e,t,n){if(n3(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{var r=n$(t);e.children.has(r)||e.children.set(r,rW()),rj(e.children.get(r),t=nZ(t),n)}}function rz(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach(function(e,n){t(n,e)})}(e,function(e,r){rz(r,new nQ(t.toString()+"/"+e),n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rV=function(){function e(e){this.collection_=e,this.last_=null}return e.prototype.get=function(){var e=this.collection_.get(),t=tX.__assign({},e);return this.last_&&nw(this.last_,function(e,n){t[e]=t[e]-n}),this.last_=e,t},e}(),rK=function(){function e(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new rV(e),nk(this.reportStats_.bind(this),Math.floor(1e4+2e4*Math.random()))}return e.prototype.reportStats_=function(){var e=this,t=this.statsListener_.get(),n={},r=!1;nw(t,function(t,i){i>0&&tZ.contains(e.statsToReport_,t)&&(n[t]=i,r=!0)}),r&&this.server_.reportStats(n),nk(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},e}();function rY(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function rQ(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function rG(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(i=f||(f={}))[i.OVERWRITE=0]="OVERWRITE",i[i.MERGE=1]="MERGE",i[i.ACK_USER_WRITE=2]="ACK_USER_WRITE",i[i.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var r$=function(){function e(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=f.ACK_USER_WRITE,this.source=rY()}return e.prototype.operationForChild=function(t){if(!n3(this.path))return tZ.assert(n$(this.path)===t,"operationForChild called for unrelated child."),new e(nZ(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return tZ.assert(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new nQ(t));return new e(nG(),n,this.revert)},e}(),rJ=function(){function e(e,t){this.source=e,this.path=t,this.type=f.LISTEN_COMPLETE}return e.prototype.operationForChild=function(t){return n3(this.path)?new e(this.source,nG()):new e(this.source,nZ(this.path))},e}(),rZ=function(){function e(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=f.OVERWRITE}return e.prototype.operationForChild=function(t){return n3(this.path)?new e(this.source,nG(),this.snap.getImmediateChild(t)):new e(this.source,nZ(this.path),this.snap)},e}(),rX=function(){function e(e,t,n){this.source=e,this.path=t,this.children=n,this.type=f.MERGE}return e.prototype.operationForChild=function(t){if(!n3(this.path))return tZ.assert(n$(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new e(this.source,nZ(this.path),this.children);var n=this.children.subtree(new nQ(t));return n.isEmpty()?null:n.value?new rZ(this.source,nG(),n.value):new e(this.source,nG(),n)},e.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},e}(),r0=function(){function e(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}return e.prototype.isFullyInitialized=function(){return this.fullyInitialized_},e.prototype.isFiltered=function(){return this.filtered_},e.prototype.isCompleteForPath=function(e){if(n3(e))return this.isFullyInitialized()&&!this.filtered_;var t=n$(e);return this.isCompleteForChild(t)},e.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)},e.prototype.getNode=function(){return this.node_},e}(),r1=function(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()};function r2(e,t,n,r,i,o){var s=r.filter(function(e){return e.type===n});s.sort(function(t,n){return function(e,t,n){if(null==t.childName||null==n.childName)throw tZ.assertionError("Should only compare child_ events.");var r=new rr(t.childName,t.snapshotNode),i=new rr(n.childName,n.snapshotNode);return e.index_.compare(r,i)}(e,t,n)}),s.forEach(function(n){var r=("value"===n.type||"child_removed"===n.type||(n.prevName=o.getPredecessorChildName(n.childName,n.snapshotNode,e.index_)),n);i.forEach(function(i){i.respondsTo(n.type)&&t.push(i.createEvent(r,e.query_))})})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r3(e,t){return{eventCache:e,serverCache:t}}function r4(e,t,n,r){return r3(new r0(t,n,r),e.serverCache)}function r8(e,t,n,r){return r3(e.eventCache,new r0(t,n,r))}function r5(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function r6(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}var r9=function(){function e(e,t){void 0===t&&(_||(_=new rl(ny)),t=_),this.value=e,this.children=t}return e.fromObject=function(t){var n=new e(null);return nw(t,function(e,t){n=n.set(new nQ(e),t)}),n},e.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},e.prototype.findRootMostMatchingPathAndValue=function(e,t){if(null!=this.value&&t(this.value))return{path:nG(),value:this.value};if(n3(e))return null;var n=n$(e),r=this.children.get(n);if(null===r)return null;var i=r.findRootMostMatchingPathAndValue(nZ(e),t);return null!=i?{path:n2(new nQ(n),i.path),value:i.value}:null},e.prototype.findRootMostValueAndPath=function(e){return this.findRootMostMatchingPathAndValue(e,function(){return!0})},e.prototype.subtree=function(t){if(n3(t))return this;var n=n$(t),r=this.children.get(n);return null!==r?r.subtree(nZ(t)):new e(null)},e.prototype.set=function(t,n){if(n3(t))return new e(n,this.children);var r=n$(t),i=(this.children.get(r)||new e(null)).set(nZ(t),n),o=this.children.insert(r,i);return new e(this.value,o)},e.prototype.remove=function(t){if(n3(t))return this.children.isEmpty()?new e(null):new e(null,this.children);var n=n$(t),r=this.children.get(n);if(!r)return this;var i=r.remove(nZ(t)),o=void 0;return(o=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&o.isEmpty())?new e(null):new e(this.value,o)},e.prototype.get=function(e){if(n3(e))return this.value;var t=n$(e),n=this.children.get(t);return n?n.get(nZ(e)):null},e.prototype.setTree=function(t,n){if(n3(t))return n;var r=n$(t),i=(this.children.get(r)||new e(null)).setTree(nZ(t),n),o=void 0;return o=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new e(this.value,o)},e.prototype.fold=function(e){return this.fold_(nG(),e)},e.prototype.fold_=function(e,t){var n={};return this.children.inorderTraversal(function(r,i){n[r]=i.fold_(n2(e,r),t)}),t(e,this.value,n)},e.prototype.findOnPath=function(e,t){return this.findOnPath_(e,nG(),t)},e.prototype.findOnPath_=function(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(n3(e))return null;var i=n$(e),o=this.children.get(i);return o?o.findOnPath_(nZ(e),n2(t,i),n):null},e.prototype.foreachOnPath=function(e,t){return this.foreachOnPath_(e,nG(),t)},e.prototype.foreachOnPath_=function(t,n,r){if(n3(t))return this;this.value&&r(n,this.value);var i=n$(t),o=this.children.get(i);return o?o.foreachOnPath_(nZ(t),n2(n,i),r):new e(null)},e.prototype.foreach=function(e){this.foreach_(nG(),e)},e.prototype.foreach_=function(e,t){this.children.inorderTraversal(function(n,r){r.foreach_(n2(e,n),t)}),this.value&&t(e,this.value)},e.prototype.foreachChild=function(e){this.children.inorderTraversal(function(t,n){n.value&&e(t,n.value)})},e}(),r7=function(){function e(e){this.writeTree_=e}return e.empty=function(){return new e(new r9(null))},e}();function ie(e,t,n){if(n3(t))return new r7(new r9(n));var r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){var i=r.path,o=r.value,s=n4(i,t);return o=o.updateChild(s,n),new r7(e.writeTree_.set(i,o))}var a=new r9(n),h=e.writeTree_.setTree(t,a);return new r7(h)}function it(e,t,n){var r=e;return nw(n,function(e,n){r=ie(r,n2(t,e),n)}),r}function ir(e,t){if(n3(t))return r7.empty();var n=e.writeTree_.setTree(t,new r9(null));return new r7(n)}function ii(e,t){return null!=io(e,t)}function io(e,t){var n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(n4(n.path,t)):null}function is(e){var t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(rv,function(e,n){t.push(new rr(e,n))}):e.writeTree_.children.inorderTraversal(function(e,n){null!=n.value&&t.push(new rr(e,n.value))}),t}function ia(e,t){if(n3(t))return e;var n=io(e,t);return new r7(null!=n?new r9(n):e.writeTree_.subtree(t))}function ih(e){return e.writeTree_.isEmpty()}function iu(e,t){return function e(t,n,r){if(null!=n.value)return r.updateChild(t,n.value);var i=null;return n.children.inorderTraversal(function(n,o){".priority"===n?(tZ.assert(null!==o.value,"Priority writes must always be leaf nodes"),i=o.value):r=e(n2(t,n),o,r)}),r.getChild(t).isEmpty()||null===i||(r=r.updateChild(n2(t,".priority"),i)),r}(nG(),e.writeTree_,t)}function il(e){return e.visible}function ic(e,t,n){for(var r=r7.empty(),i=0;i<e.length;++i){var o=e[i];if(t(o)){var s=o.path,a=void 0;if(o.snap)n6(n,s)?r=ie(r,a=n4(n,s),o.snap):n6(s,n)&&(a=n4(s,n),r=ie(r,nG(),o.snap.getChild(a)));else if(o.children){if(n6(n,s))r=it(r,a=n4(n,s),o.children);else if(n6(s,n)){if(n3(a=n4(s,n)))r=it(r,nG(),o.children);else{var h=tZ.safeGet(o.children,n$(a));if(h){var u=h.getChild(nZ(a));r=ie(r,nG(),u)}}}}else throw tZ.assertionError("WriteRecord should have .snap or .children")}}return r}function id(e,t,n,r,i){if(r||i){var o=ia(e.visibleWrites,t);if(!i&&ih(o))return n;if(!i&&null==n&&!ii(o,nG()))return null;var s=ic(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(n6(e.path,t)||n6(t,e.path))},t),a=n||rb.EMPTY_NODE;return iu(s,a)}var h=io(e.visibleWrites,t);if(null!=h)return h;var u=ia(e.visibleWrites,t);if(ih(u))return n;if(null==n&&!ii(u,nG()))return null;var a=n||rb.EMPTY_NODE;return iu(u,a)}function ip(e,t,n,r){return id(e.writeTree,e.treePath,t,n,r)}function i_(e,t){return function(e,t,n){var r=rb.EMPTY_NODE,i=io(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(rv,function(e,t){r=r.updateImmediateChild(e,t)}),r;if(!n)return is(ia(e.visibleWrites,t)).forEach(function(e){r=r.updateImmediateChild(e.name,e.node)}),r;var o=ia(e.visibleWrites,t);return n.forEachChild(rv,function(e,t){var n=iu(ia(o,new nQ(e)),t);r=r.updateImmediateChild(e,n)}),is(o).forEach(function(e){r=r.updateImmediateChild(e.name,e.node)}),r}(e.writeTree,e.treePath,t)}function iv(e,t,n,r){return function(e,t,n,r,i){tZ.assert(r||i,"Either existingEventSnap or existingServerSnap must exist");var o=n2(t,n);if(ii(e.visibleWrites,o))return null;var s=ia(e.visibleWrites,o);return ih(s)?i.getChild(n):iu(s,i.getChild(n))}(e.writeTree,e.treePath,t,n,r)}function iy(e,t){var n,r;return n=e.writeTree,r=n2(e.treePath,t),io(n.visibleWrites,r)}function ig(e,t,n){var r,i,o;return r=e.writeTree,i=n2(e.treePath,t),null!=(o=io(r.visibleWrites,i))?o:n.isCompleteForChild(t)?iu(ia(r.visibleWrites,i),n.getNode().getImmediateChild(t)):null}function im(e,t){return iC(n2(e.treePath,t),e.writeTree)}function iC(e,t){return{treePath:e,writeTree:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var iw=function(){function e(){this.changeMap=new Map}return e.prototype.trackChildChange=function(e){var t=e.type,n=e.childName;tZ.assert("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),tZ.assert(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,rN(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,rP(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,rx(n,e.snapshotNode));else if("child_changed"===t&&"child_changed"===i)this.changeMap.set(n,rN(n,e.snapshotNode,r.oldSnap));else throw tZ.assertionError("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(n,e)},e.prototype.getChanges=function(){return Array.from(this.changeMap.values())},e}(),ib=new(function(){function e(){}return e.prototype.getCompleteChild=function(e){return null},e.prototype.getChildAfterChild=function(e,t,n){return null},e}()),iE=function(){function e(e,t,n){void 0===n&&(n=null),this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}return e.prototype.getCompleteChild=function(e){var t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new r0(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return ig(this.writes_,e,n)},e.prototype.getChildAfterChild=function(e,t,n){var r,i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:r6(this.viewCache_),o=function(e,t,n,r,i,o,s){var a,h=ia(e.visibleWrites,t),u=io(h,nG());if(null!=u)a=u;else{if(null==n)return[];a=iu(h,n)}if((a=a.withIndex(s)).isEmpty()||a.isLeafNode())return[];for(var l=[],c=s.getCompare(),d=o?a.getReverseIteratorFrom(r,s):a.getIteratorFrom(r,s),p=d.getNext();p&&l.length<1;)0!==c(p,r)&&l.push(p),p=d.getNext();return l}((r=this.writes_).writeTree,r.treePath,i,t,0,n,e);return 0===o.length?null:o[0]},e}();function iS(e,t,n,r,i,o){var s=t.eventCache;if(null!=iy(r,n))return t;var a=void 0,h=void 0;if(n3(n)){if(tZ.assert(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){var u=r6(t),l=i_(r,u instanceof rb?u:rb.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),l,o)}else{var c=ip(r,r6(t));a=e.filter.updateFullNode(t.eventCache.getNode(),c,o)}}else{var d=n$(n);if(".priority"===d){tZ.assert(1===nJ(n),"Can't have a priority with additional path components");var p=s.getNode(),f=iv(r,n,p,h=t.serverCache.getNode());a=null!=f?e.filter.updatePriority(p,f):s.getNode()}else{var _=nZ(n),v=void 0;if(s.isCompleteForChild(d)){h=t.serverCache.getNode();var y=iv(r,n,s.getNode(),h);v=null!=y?s.getNode().getImmediateChild(d).updateChild(_,y):s.getNode().getImmediateChild(d)}else v=ig(r,d,t.serverCache);a=null!=v?e.filter.updateChild(s.getNode(),d,v,_,i,o):s.getNode()}}return r4(t,a,s.isFullyInitialized()||n3(n),e.filter.filtersNodes())}function iT(e,t,n,r,i,o,s,a){var h,u=t.serverCache,l=s?e.filter:e.filter.getIndexedFilter();if(n3(n))h=l.updateFullNode(u.getNode(),r,null);else if(l.filtersNodes()&&!u.isFiltered()){var c=u.getNode().updateChild(n,r);h=l.updateFullNode(u.getNode(),c,null)}else{var d=n$(n);if(!u.isCompleteForPath(n)&&nJ(n)>1)return t;var p=nZ(n),f=u.getNode().getImmediateChild(d).updateChild(p,r);h=".priority"===d?l.updatePriority(u.getNode(),f):l.updateChild(u.getNode(),d,f,p,ib,null)}var _=r8(t,h,u.isFullyInitialized()||n3(n),l.filtersNodes()),v=new iE(i,_,o);return iS(e,_,n,i,v,a)}function ik(e,t,n,r,i,o,s){var a,h,u=t.eventCache,l=new iE(i,t,o);if(n3(n))h=e.filter.updateFullNode(t.eventCache.getNode(),r,s),a=r4(t,h,!0,e.filter.filtersNodes());else{var c=n$(n);if(".priority"===c)h=e.filter.updatePriority(t.eventCache.getNode(),r),a=r4(t,h,u.isFullyInitialized(),u.isFiltered());else{var d=nZ(n),p=u.getNode().getImmediateChild(c),f=void 0;if(n3(d))f=r;else{var _=l.getCompleteChild(c);f=null!=_?".priority"===nX(d)&&_.getChild(n1(d)).isEmpty()?_:_.updateChild(d,r):rb.EMPTY_NODE}if(p.equals(f))a=t;else{var v=e.filter.updateChild(u.getNode(),c,f,d,l,s);a=r4(t,v,u.isFullyInitialized(),e.filter.filtersNodes())}}}return a}function iI(e,t){return e.eventCache.isCompleteForChild(t)}function ix(e,t,n){return n.foreach(function(e,n){t=t.updateChild(e,n)}),t}function iP(e,t,n,r,i,o,s,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;var h,u=t;h=n3(n)?r:new r9(null).setTree(n,r);var l=t.serverCache.getNode();return h.children.inorderTraversal(function(n,r){if(l.hasChild(n)){var h=ix(e,t.serverCache.getNode().getImmediateChild(n),r);u=iT(e,u,new nQ(n),h,i,o,s,a)}}),h.children.inorderTraversal(function(n,r){var h=!t.serverCache.isCompleteForChild(n)&&null===r.value;if(!l.hasChild(n)&&!h){var c=ix(e,t.serverCache.getNode().getImmediateChild(n),r);u=iT(e,u,new nQ(n),c,i,o,s,a)}}),u}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var iN=function(){function e(e,t){this.query_=e,this.eventRegistrations_=[];var n=this.query_._queryParams,r=new rR(n.getIndex()),i=n.loadsAllData()?new rR(n.getIndex()):n.hasLimit()?new rD(n):new rO(n);this.processor_={filter:i};var o=t.serverCache,s=t.eventCache,a=r.updateFullNode(rb.EMPTY_NODE,o.getNode(),null),h=i.updateFullNode(rb.EMPTY_NODE,s.getNode(),null),u=new r0(a,o.isFullyInitialized(),r.filtersNodes()),l=new r0(h,s.isFullyInitialized(),i.filtersNodes());this.viewCache_=r3(l,u),this.eventGenerator_=new r1(this.query_)}return Object.defineProperty(e.prototype,"query",{get:function(){return this.query_},enumerable:!1,configurable:!0}),e}();function iR(e){return 0===e.eventRegistrations_.length}function iO(e,t,n){var r=[];if(n){tZ.assert(null==t,"A cancel should cancel all event registrations.");var i=e.query._path;e.eventRegistrations_.forEach(function(e){var t=e.createCancelEvent(n,i);t&&r.push(t)})}if(t){for(var o=[],s=0;s<e.eventRegistrations_.length;++s){var a=e.eventRegistrations_[s];if(a.matches(t)){if(t.hasAnyCallback()){o=o.concat(e.eventRegistrations_.slice(s+1));break}}else o.push(a)}e.eventRegistrations_=o}else e.eventRegistrations_=[];return r}function iD(e,t,n,r){t.type===f.MERGE&&null!==t.source.queryId&&(tZ.assert(r6(e.viewCache_),"We should always have a full cache before handling merges"),tZ.assert(r5(e.viewCache_),"Missing event cache, even though we have a server cache"));var i,o,s=e.viewCache_,a=function(e,t,n,r,i){var o,s,a,h,u,l,c,d=new iw;if(n.type===f.OVERWRITE)n.source.fromUser?l=ik(e,t,n.path,n.snap,r,i,d):(tZ.assert(n.source.fromServer,"Unknown source."),c=n.source.tagged||t.serverCache.isFiltered()&&!n3(n.path),l=iT(e,t,n.path,n.snap,r,i,c,d));else if(n.type===f.MERGE)n.source.fromUser?(o=n.path,s=n.children,a=t,s.foreach(function(n,s){var h=n2(o,n);iI(t,n$(h))&&(a=ik(e,a,h,s,r,i,d))}),s.foreach(function(n,s){var h=n2(o,n);iI(t,n$(h))||(a=ik(e,a,h,s,r,i,d))}),l=a):(tZ.assert(n.source.fromServer,"Unknown source."),c=n.source.tagged||t.serverCache.isFiltered(),l=iP(e,t,n.path,n.children,r,i,c,d));else if(n.type===f.ACK_USER_WRITE)l=n.revert?function(e,t,n,r,i,o){if(null!=iy(r,n))return t;var s,a=new iE(r,t,i),h=t.eventCache.getNode(),u=void 0;if(n3(n)||".priority"===n$(n)){var l=void 0;if(t.serverCache.isFullyInitialized())l=ip(r,r6(t));else{var c=t.serverCache.getNode();tZ.assert(c instanceof rb,"serverChildren would be complete if leaf node"),l=i_(r,c)}u=e.filter.updateFullNode(h,l,o)}else{var d=n$(n),p=ig(r,d,t.serverCache);null==p&&t.serverCache.isCompleteForChild(d)&&(p=h.getImmediateChild(d)),(u=null!=p?e.filter.updateChild(h,d,p,nZ(n),a,o):t.eventCache.getNode().hasChild(d)?e.filter.updateChild(h,d,rb.EMPTY_NODE,nZ(n),a,o):h).isEmpty()&&t.serverCache.isFullyInitialized()&&(s=ip(r,r6(t))).isLeafNode()&&(u=e.filter.updateFullNode(u,s,o))}return s=t.serverCache.isFullyInitialized()||null!=iy(r,nG()),r4(t,u,s,e.filter.filtersNodes())}(e,t,n.path,r,i,d):function(e,t,n,r,i,o,s){if(null!=iy(i,n))return t;var a=t.serverCache.isFiltered(),h=t.serverCache;if(null!=r.value){if(n3(n)&&h.isFullyInitialized()||h.isCompleteForPath(n))return iT(e,t,n,h.getNode().getChild(n),i,o,a,s);if(!n3(n))return t;var u=new r9(null);return h.getNode().forEachChild(rs,function(e,t){u=u.set(new nQ(e),t)}),iP(e,t,n,u,i,o,a,s)}var l=new r9(null);return r.foreach(function(e,t){var r=n2(n,e);h.isCompleteForPath(r)&&(l=l.set(e,h.getNode().getChild(r)))}),iP(e,t,n,l,i,o,a,s)}(e,t,n.path,n.affectedTree,r,i,d);else if(n.type===f.LISTEN_COMPLETE)h=n.path,u=t.serverCache,l=iS(e,r8(t,u.getNode(),u.isFullyInitialized()||n3(h),u.isFiltered()),h,r,ib,d);else throw tZ.assertionError("Unknown operation type: "+n.type);var p=d.getChanges();return function(e,t,n){var r=t.eventCache;if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=r5(e);!(n.length>0)&&e.eventCache.isFullyInitialized()&&(!i||r.getNode().equals(o))&&r.getNode().getPriority().equals(o.getPriority())||n.push(rI(r5(t)))}}(t,l,p),{viewCache:l,changes:p}}(e.processor_,s,t,n,r);return i=e.processor_,o=a.viewCache,tZ.assert(o.eventCache.getNode().isIndexed(i.filter.getIndex()),"Event snap not indexed"),tZ.assert(o.serverCache.getNode().isIndexed(i.filter.getIndex()),"Server snap not indexed"),tZ.assert(a.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,iA(e,a.changes,a.viewCache.eventCache.getNode(),null)}function iA(e,t,n,r){var i,o,s,a=r?[r]:e.eventRegistrations_;return i=e.eventGenerator_,o=[],s=[],t.forEach(function(e){if("child_changed"===e.type&&i.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)){var t;s.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}}),r2(i,o,"child_removed",t,a,n),r2(i,o,"child_added",t,a,n),r2(i,o,"child_moved",s,a,n),r2(i,o,"child_changed",t,a,n),r2(i,o,"value",t,a,n),o}var iL=function(){this.views=new Map};function iM(e,t,n,r){var i,o,s=t.source.queryId;if(null!==s){var a=e.views.get(s);return tZ.assert(null!=a,"SyncTree gave us an op for an invalid query."),iD(a,t,n,r)}var h=[];try{for(var u=tX.__values(e.views.values()),l=u.next();!l.done;l=u.next()){var a=l.value;h=h.concat(iD(a,t,n,r))}}catch(e){i={error:e}}finally{try{l&&!l.done&&(o=u.return)&&o.call(u)}finally{if(i)throw i.error}}return h}function iq(e,t,n,r,i){var o=t._queryIdentifier,s=e.views.get(o);if(!s){var a=ip(n,i?r:null),h=!1;a?h=!0:r instanceof rb?(a=i_(n,r),h=!1):(a=rb.EMPTY_NODE,h=!1);var u=r3(new r0(a,h,!1),new r0(r,i,!1));return new iN(t,u)}return s}function iF(e){var t,n,r=[];try{for(var i=tX.__values(e.views.values()),o=i.next();!o.done;o=i.next()){var s=o.value;s.query._queryParams.loadsAllData()||r.push(s)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}function iU(e,t){var n,r,i=null;try{for(var o=tX.__values(e.views.values()),s=o.next();!s.done;s=o.next()){var a=s.value;i=i||function(e,t){var n=r6(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!n3(t)&&!n.getImmediateChild(n$(t)).isEmpty())?n.getChild(t):null}(a,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return i}function iB(e,t){if(t._queryParams.loadsAllData())return iW(e);var n=t._queryIdentifier;return e.views.get(n)}function iH(e){return null!=iW(e)}function iW(e){var t,n;try{for(var r=tX.__values(e.views.values()),i=r.next();!i.done;i=r.next()){var o=i.value;if(o.query._queryParams.loadsAllData())return o}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return null}var ij=1,iz=function(e){this.listenProvider_=e,this.syncPointTree_=new r9(null),this.pendingWriteTree_={visibleWrites:r7.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map};function iV(e,t,n,r,i){var o,s;return(o=e.pendingWriteTree_,s=i,tZ.assert(r>o.lastWriteId,"Stacking an older write on top of newer ones"),void 0===s&&(s=!0),o.allWrites.push({path:t,snap:n,writeId:r,visible:s}),s&&(o.visibleWrites=ie(o.visibleWrites,t,n)),o.lastWriteId=r,i)?iZ(e,new rZ(rY(),t,n)):[]}function iK(e,t,n){void 0===n&&(n=!1);var r=function(e,t){for(var n=0;n<e.allWrites.length;n++){var r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(!function(e,t){var n=e.allWrites.findIndex(function(e){return e.writeId===t});tZ.assert(n>=0,"removeWrite called with nonexistent writeId.");var r=e.allWrites[n];e.allWrites.splice(n,1);for(var i=r.visible,o=!1,s=e.allWrites.length-1;i&&s>=0;){var a=e.allWrites[s];a.visible&&(s>=n&&function(e,t){if(e.snap)return n6(e.path,t);for(var n in e.children)if(e.children.hasOwnProperty(n)&&n6(n2(e.path,n),t))return!0;return!1}(a,r.path)?i=!1:n6(r.path,a.path)&&(o=!0)),s--}return!!i&&(o?(e.visibleWrites=ic(e.allWrites,il,nG()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1,!0):(r.snap?e.visibleWrites=ir(e.visibleWrites,r.path):nw(r.children,function(t){e.visibleWrites=ir(e.visibleWrites,n2(r.path,t))}),!0))}(e.pendingWriteTree_,t))return[];var i=new r9(null);return null!=r.snap?i=i.set(nG(),!0):nw(r.children,function(e){i=i.set(new nQ(e),!0)}),iZ(e,new r$(r.path,i,n))}function iY(e,t,n){return iZ(e,new rZ(rQ(),t,n))}function iQ(e,t,n,r,i){void 0===i&&(i=!1);var o=t._path,s=e.syncPointTree_.get(o),a=[];if(s&&("default"===t._queryIdentifier||null!=iB(s,t))){var h=function(e,t,n,r){var i,o,s=t._queryIdentifier,a=[],h=[],u=iH(e);if("default"===s)try{for(var l=tX.__values(e.views.entries()),c=l.next();!c.done;c=l.next()){var d=tX.__read(c.value,2),p=d[0],f=d[1];h=h.concat(iO(f,n,r)),iR(f)&&(e.views.delete(p),f.query._queryParams.loadsAllData()||a.push(f.query))}}catch(e){i={error:e}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}else{var f=e.views.get(s);f&&(h=h.concat(iO(f,n,r)),iR(f)&&(e.views.delete(s),f.query._queryParams.loadsAllData()||a.push(f.query)))}return u&&!iH(e)&&a.push(new(tZ.assert(v,"Reference.ts has not been loaded"),v)(t._repo,t._path)),{removed:a,events:h}}(s,t,n,r);0===s.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(o));var u=h.removed;if(a=h.events,!i){var l=-1!==u.findIndex(function(e){return e._queryParams.loadsAllData()}),c=e.syncPointTree_.findOnPath(o,function(e,t){return iH(t)});if(l&&!c){var d=e.syncPointTree_.subtree(o);if(!d.isEmpty())for(var p=d.fold(function(e,t,n){if(t&&iH(t))return[iW(t)];var r=[];return t&&(r=iF(t)),nw(n,function(e,t){r=r.concat(t)}),r}),f=0;f<p.length;++f){var _=p[f],y=_.query,g=iX(e,_);e.listenProvider_.startListening(i8(y),i0(e,y),g.hashFn,g.onComplete)}}c||!(u.length>0)||r||(l?e.listenProvider_.stopListening(i8(t),null):u.forEach(function(t){var n=e.queryToTagMap.get(i1(t));e.listenProvider_.stopListening(i8(t),n)}))}!function(e,t){for(var n=0;n<t.length;++n){var r=t[n];if(!r._queryParams.loadsAllData()){var i=i1(r),o=e.queryToTagMap.get(i);e.queryToTagMap.delete(i),e.tagToQueryMap.delete(o)}}}(e,u)}return a}function iG(e,t,n,r){var i=i2(e,r);if(null==i)return[];var o=i3(i),s=o.path,a=o.queryId,h=n4(s,t),u=new rZ(rG(a),h,n);return i4(e,s,u)}function i$(e,t,n,r){void 0===r&&(r=!1);var i,o,s,a,h,u,l=t._path,c=null,d=!1;e.syncPointTree_.foreachOnPath(l,function(e,t){var n=n4(e,l);c=c||iU(t,n),d=d||iH(t)});var p=e.syncPointTree_.get(l);p?(d=d||iH(p),c=c||iU(p,nG())):(p=new iL,e.syncPointTree_=e.syncPointTree_.set(l,p)),null!=c?u=!0:(u=!1,c=rb.EMPTY_NODE,e.syncPointTree_.subtree(l).foreachChild(function(e,t){var n=iU(t,nG());n&&(c=c.updateImmediateChild(e,n))}));var f=null!=iB(p,t);if(!f&&!t._queryParams.loadsAllData()){var _=i1(t);tZ.assert(!e.queryToTagMap.has(_),"View does not exist, but we have a tag");var v=ij++;e.queryToTagMap.set(_,v),e.tagToQueryMap.set(v,_)}var y=(i=e.pendingWriteTree_,iC(l,i)),g=(s=iq(o=p,t,y,c,u),o.views.has(t._queryIdentifier)||o.views.set(t._queryIdentifier,s),!function(e,t){e.eventRegistrations_.push(t)}(s,n),a=s.viewCache_.eventCache,h=[],a.getNode().isLeafNode()||a.getNode().forEachChild(rv,function(e,t){h.push(rx(e,t))}),a.isFullyInitialized()&&h.push(rI(a.getNode())),iA(s,h,a.getNode(),n));if(!f&&!d&&!r){var m=iB(p,t);g=g.concat(function(e,t,n){var r=t._path,i=i0(e,t),o=iX(e,n),s=e.listenProvider_.startListening(i8(t),i,o.hashFn,o.onComplete),a=e.syncPointTree_.subtree(r);if(i)tZ.assert(!iH(a.value),"If we're adding a query, it shouldn't be shadowed");else for(var h=a.fold(function(e,t,n){if(!n3(e)&&t&&iH(t))return[iW(t).query];var r=[];return t&&(r=r.concat(iF(t).map(function(e){return e.query}))),nw(n,function(e,t){r=r.concat(t)}),r}),u=0;u<h.length;++u){var l=h[u];e.listenProvider_.stopListening(i8(l),i0(e,l))}return s}(e,t,m))}return g}function iJ(e,t,n){var r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,function(e,n){var r=iU(n,n4(e,t));if(r)return r});return id(r,t,i,n,!0)}function iZ(e,t){var n;return function e(t,n,r,i){if(n3(t.path))return function e(t,n,r,i){var o=n.get(nG());null==r&&null!=o&&(r=iU(o,nG()));var s=[];return n.children.inorderTraversal(function(n,o){var a=r?r.getImmediateChild(n):null,h=im(i,n),u=t.operationForChild(n);u&&(s=s.concat(e(u,o,a,h)))}),o&&(s=s.concat(iM(o,t,i,r))),s}(t,n,r,i);var o=n.get(nG());null==r&&null!=o&&(r=iU(o,nG()));var s=[],a=n$(t.path),h=t.operationForChild(a),u=n.children.get(a);if(u&&h){var l=r?r.getImmediateChild(a):null,c=im(i,a);s=s.concat(e(h,u,l,c))}return o&&(s=s.concat(iM(o,t,i,r))),s}(t,e.syncPointTree_,null,(n=e.pendingWriteTree_,iC(nG(),n)))}function iX(e,t){var n=t.query,r=i0(e,n);return{hashFn:function(){return(t.viewCache_.serverCache.getNode()||rb.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return r?function(e,t,n){var r=i2(e,n);if(!r)return[];var i=i3(r),o=i.path,s=i.queryId,a=n4(o,t),h=new rJ(rG(s),a);return i4(e,o,h)}(e,n._path,r):(i=n._path,iZ(e,new rJ(rQ(),i)));var i,o,s,a=(o="Unknown Error","too_big"===t?o="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?o="Client doesn't have permission to access the desired data.":"unavailable"===t&&(o="The service is unavailable"),(s=Error(t+" at "+n._path.toString()+": "+o)).code=t.toUpperCase(),s);return iQ(e,n,null,a)}}}function i0(e,t){var n=i1(t);return e.queryToTagMap.get(n)}function i1(e){return e._path.toString()+"$"+e._queryIdentifier}function i2(e,t){return e.tagToQueryMap.get(t)}function i3(e){var t=e.indexOf("$");return tZ.assert(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new nQ(e.substr(0,t))}}function i4(e,t,n){var r=e.syncPointTree_.get(t);return tZ.assert(r,"Missing sync point for query tag that we're tracking"),iM(r,n,iC(t,e.pendingWriteTree_),null)}function i8(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(tZ.assert(y,"Reference.ts has not been loaded"),y)(e._repo,e._path):e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var i5=function(){function e(e){this.node_=e}return e.prototype.getImmediateChild=function(t){var n=this.node_.getImmediateChild(t);return new e(n)},e.prototype.node=function(){return this.node_},e}(),i6=function(){function e(e,t){this.syncTree_=e,this.path_=t}return e.prototype.getImmediateChild=function(t){var n=n2(this.path_,t);return new e(this.syncTree_,n)},e.prototype.node=function(){return iJ(this.syncTree_,this.path_)},e}(),i9=function(e,t,n){return e&&"object"==typeof e?(tZ.assert(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"])?i7(e[".sv"],t,n):"object"==typeof e[".sv"]?oe(e[".sv"],t):void tZ.assert(!1,"Unexpected server value: "+JSON.stringify(e,null,2)):e},i7=function(e,t,n){if("timestamp"===e)return n.timestamp;tZ.assert(!1,"Unexpected server value: "+e)},oe=function(e,t,n){e.hasOwnProperty("increment")||tZ.assert(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var r=e.increment;"number"!=typeof r&&tZ.assert(!1,"Unexpected increment value: "+r);var i=t.node();if(tZ.assert(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;var o=i.getValue();return"number"!=typeof o?r:o+r},ot=function(e,t,n,r){return or(t,new i6(n,e),r)},on=function(e,t,n){return or(e,new i5(t),n)};function or(e,t,n){var r,i=i9(e.getPriority().val(),t.getImmediateChild(".priority"),n);if(!e.isLeafNode())return r=e,i!==e.getPriority().val()&&(r=r.updatePriority(new r_(i))),e.forEachChild(rv,function(e,i){var o=or(i,t.getImmediateChild(e),n);o!==i&&(r=r.updateImmediateChild(e,o))}),r;var o=i9(e.getValue(),t,n);return o!==e.getValue()||i!==e.getPriority().val()?new r_(o,rS(i)):e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var oi=function(e,t,n){void 0===e&&(e=""),void 0===t&&(t=null),void 0===n&&(n={children:{},childCount:0}),this.name=e,this.parent=t,this.node=n};function oo(e,t){for(var n=t instanceof nQ?t:new nQ(t),r=e,i=n$(n);null!==i;){var o=tZ.safeGet(r.node.children,i)||{children:{},childCount:0};r=new oi(i,r,o),i=n$(n=nZ(n))}return r}function os(e){return e.node.value}function oa(e,t){e.node.value=t,function e(t){var n,r,i,o,s;null!==t.parent&&(n=t.parent,r=t.name,o=void 0===os(i=t)&&!oh(i),s=tZ.contains(n.node.children,r),o&&s?(delete n.node.children[r],n.node.childCount--,e(n)):o||s||(n.node.children[r]=i.node,n.node.childCount++,e(n)))}(e)}function oh(e){return e.node.childCount>0}function ou(e,t){nw(e.node.children,function(n,r){t(new oi(n,e,r))})}function ol(e){return new nQ(null===e.parent?e.name:ol(e.parent)+"/"+e.name)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var oc=/[\[\].#$\/\u0000-\u001F\u007F]/,od=/[\[\].#$\u0000-\u001F\u007F]/,op=function(e){return"string"==typeof e&&0!==e.length&&!oc.test(e)},of=function(e){return"string"==typeof e&&0!==e.length&&!od.test(e)},o_=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!nd(e)||e&&"object"==typeof e&&tZ.contains(e,".sv")},ov=function(e,t,n,r){r&&void 0===t||oy(tZ.errorPrefix(e,"value"),t,n)},oy=function(e,t,n){var r=n instanceof nQ?new n9(n,e):n;if(void 0===t)throw Error(e+"contains undefined "+re(r));if("function"==typeof t)throw Error(e+"contains a function "+re(r)+" with contents = "+t.toString());if(nd(t))throw Error(e+"contains "+t.toString()+" "+re(r));if("string"==typeof t&&t.length>3495253.3333333335&&tZ.stringLength(t)>10485760)throw Error(e+"contains a string greater than 10485760 utf8 bytes "+re(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){var i=!1,o=!1;if(nw(t,function(t,n){var s;if(".value"===t)i=!0;else if(".priority"!==t&&".sv"!==t&&(o=!0,!op(t)))throw Error(e+" contains an invalid key ("+t+") "+re(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.parts_.length>0&&(r.byteLength_+=1),r.parts_.push(t),r.byteLength_+=tZ.stringLength(t),n7(r),oy(e,n,r),s=r.parts_.pop(),r.byteLength_-=tZ.stringLength(s),r.parts_.length>0&&(r.byteLength_-=1)}),i&&o)throw Error(e+' contains ".value" child '+re(r)+" in addition to actual children.")}},og=function(e,t){for(n=0;n<t.length;n++)for(var n,r,i=n0(r=t[n]),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!op(i[o]))throw Error(e+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');t.sort(n8);var s=null;for(n=0;n<t.length;n++){if(r=t[n],null!==s&&n6(s,r))throw Error(e+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},om=function(e,t,n,r){if(!r||void 0!==t){var i=tZ.errorPrefix(e,"values");if(!(t&&"object"==typeof t)||Array.isArray(t))throw Error(i+" must be an object containing the children to replace.");var o=[];nw(t,function(e,t){var r=new nQ(e);if(oy(i,t,n2(n,r)),".priority"===nX(r)&&!o_(t))throw Error(i+"contains an invalid value for '"+r.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");o.push(r)}),og(i,o)}},oC=function(e,t,n){if(!n||void 0!==t){if(nd(t))throw Error(tZ.errorPrefix(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!o_(t))throw Error(tZ.errorPrefix(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},ow=function(e,t,n,r){if((!r||void 0!==n)&&!op(n))throw Error(tZ.errorPrefix(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},ob=function(e,t,n,r){if((!r||void 0!==n)&&!of(n))throw Error(tZ.errorPrefix(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},oE=function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),ob(e,t,n,r)},oS=function(e,t){if(".info"===n$(t))throw Error(e+" failed = Can't modify data under /.info/")},oT=function(e,t){var n,r=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!op(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==r.length&&((n=r)&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),!of(n)))throw Error(tZ.errorPrefix(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},ok=function(){this.eventLists_=[],this.recursionDepth_=0};function oI(e,t){for(var n=null,r=0;r<t.length;r++){var i=t[r],o=i.getPath();null===n||n5(o,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:o}),n.events.push(i)}n&&e.eventLists_.push(n)}function ox(e,t,n){oI(e,n),oN(e,function(e){return n5(e,t)})}function oP(e,t,n){oI(e,n),oN(e,function(e){return n6(e,t)||n6(t,e)})}function oN(e,t){e.recursionDepth_++;for(var n=!0,r=0;r<e.eventLists_.length;r++){var i=e.eventLists_[r];i&&(t(i.path)?(function(e){for(var t=0;t<e.events.length;t++){var n=e.events[t];if(null!==n){e.events[t]=null;var r=n.getEventRunner();nr&&ns("event: "+n.toString()),nT(r)}}}(e.eventLists_[r]),e.eventLists_[r]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var oR="repo_interrupt",oO=function(){function e(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ok,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=rW(),this.transactionQueueTree_=new oi,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}return e.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},e}();function oD(e){var t=e.infoData_.getNode(new nQ(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function oA(e){var t;return(t=t={timestamp:oD(e)}).timestamp=t.timestamp||new Date().getTime(),t}function oL(e,t,n,r,i){e.dataUpdateCount++;var o=new nQ(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;var s=[];if(i){if(r){var a=tZ.map(n,function(e){return rS(e)});s=function(e,t,n,r){var i=i2(e,r);if(!i)return[];var o=i3(i),s=o.path,a=o.queryId,h=n4(s,t),u=r9.fromObject(n),l=new rX(rG(a),h,u);return i4(e,s,l)}(e.serverSyncTree_,o,a,i)}else{var h=rS(n);s=iG(e.serverSyncTree_,o,h,i)}}else if(r){var u,l,c=tZ.map(n,function(e){return rS(e)});u=e.serverSyncTree_,l=r9.fromObject(c),s=iZ(u,new rX(rQ(),o,l))}else{var d=rS(n);s=iY(e.serverSyncTree_,o,d)}var p=o;s.length>0&&(p=oY(e,o)),oP(e.eventQueue_,p,s)}function oM(e,t){var n,r,i;oq(e,"connected",t),!1===t&&(oj(e,"onDisconnectEvents"),n=oA(e),r=rW(),rz(e.onDisconnect_,nG(),function(t,i){var o=ot(t,i,e.serverSyncTree_,n);rj(r,t,o)}),i=[],rz(r,nG(),function(t,n){i=i.concat(iY(e.serverSyncTree_,t,n));var r=oJ(e,t);oY(e,r)}),e.onDisconnect_=rW(),oP(e.eventQueue_,nG(),i))}function oq(e,t,n){var r=new nQ("/.info/"+t),i=rS(n);e.infoData_.updateSnapshot(r,i);var o=iY(e.infoSyncTree_,r,i);oP(e.eventQueue_,r,o)}function oF(e){return e.nextWriteId_++}function oU(e,t,n,r,i){oj(e,"set",{path:t.toString(),value:n,priority:r});var o=oA(e),s=rS(n,r),a=on(s,iJ(e.serverSyncTree_,t),o),h=oF(e),u=iV(e.serverSyncTree_,t,a,h,!0);oI(e.eventQueue_,u),e.server_.put(t.toString(),s.val(!0),function(n,r){var o="ok"===n;o||nl("set at "+t+" failed: "+n);var s=iK(e.serverSyncTree_,h,!o);oP(e.eventQueue_,t,s),oz(e,i,n,r)});var l=oJ(e,t);oY(e,l),oP(e.eventQueue_,l,[])}function oB(e,t,n,r){var i=rS(n);e.server_.onDisconnectPut(t.toString(),i.val(!0),function(n,o){"ok"===n&&rj(e.onDisconnect_,t,i),oz(e,r,n,o)})}function oH(e,t,n){var r;r=".info"===n$(t._path)?iQ(e.infoSyncTree_,t,n):iQ(e.serverSyncTree_,t,n),ox(e.eventQueue_,t._path,r)}function oW(e){e.persistentConnection_&&e.persistentConnection_.interrupt(oR)}function oj(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r="";e.persistentConnection_&&(r=e.persistentConnection_.id+":"),ns.apply(void 0,tX.__spreadArray([r],tX.__read(t),!1))}function oz(e,t,n,r){t&&nT(function(){if("ok"===n)t(null);else{var e=(n||"error").toUpperCase(),i=e;r&&(i+=": "+r);var o=Error(i);o.code=e,t(o)}})}function oV(e,t,n){return iJ(e.serverSyncTree_,t,n)||rb.EMPTY_NODE}function oK(e,t){if(void 0===t&&(t=e.transactionQueueTree_),t||o$(e,t),os(t)){var n=oG(e,t);tZ.assert(n.length>0,"Sending zero length transaction queue"),n.every(function(e){return 0===e.status})&&function(e,t,n){for(var r=oV(e,t,n.map(function(e){return e.currentWriteId})),i=r,o=r.hash(),s=0;s<n.length;s++){var a=n[s];tZ.assert(0===a.status,"tryToSendTransactionQueue_: items in queue should all be run."),a.status=1,a.retryCount++;var h=n4(t,a.path);i=i.updateChild(h,a.currentOutputSnapshotRaw)}var u=i.val(!0);e.server_.put(t.toString(),u,function(r){oj(e,"transaction put response",{path:t.toString(),status:r});var i=[];if("ok"===r){for(var o=[],s=function(t){n[t].status=2,i=i.concat(iK(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&o.push(function(){return n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved)}),n[t].unwatcher()},a=0;a<n.length;a++)s(a);o$(e,oo(e.transactionQueueTree_,t)),oK(e,e.transactionQueueTree_),oP(e.eventQueue_,t,i);for(var a=0;a<o.length;a++)nT(o[a])}else{if("datastale"===r)for(var a=0;a<n.length;a++)3===n[a].status?n[a].status=4:n[a].status=0;else{nl("transaction at "+t.toString()+" failed: "+r);for(var a=0;a<n.length;a++)n[a].status=4,n[a].abortReason=r}oY(e,t)}},o)}(e,ol(t),n)}else oh(t)&&ou(t,function(t){oK(e,t)})}function oY(e,t){var n=oQ(e,t),r=ol(n),i=oG(e,n);return function(e,t,n){if(0!==t.length){for(var r=[],i=[],o=t.filter(function(e){return 0===e.status}).map(function(e){return e.currentWriteId}),s=function(s){var a,h=t[s],u=n4(n,h.path),l=!1;if(tZ.assert(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),4===h.status)l=!0,a=h.abortReason,i=i.concat(iK(e.serverSyncTree_,h.currentWriteId,!0));else if(0===h.status){if(h.retryCount>=25)l=!0,a="maxretry",i=i.concat(iK(e.serverSyncTree_,h.currentWriteId,!0));else{var c=oV(e,h.path,o);h.currentInputSnapshot=c;var d=t[s].update(c.val());if(void 0!==d){oy("transaction failed: Data returned ",d,h.path);var p=rS(d);"object"==typeof d&&null!=d&&tZ.contains(d,".priority")||(p=p.updatePriority(c.getPriority()));var f=h.currentWriteId,_=on(p,c,oA(e));h.currentOutputSnapshotRaw=p,h.currentOutputSnapshotResolved=_,h.currentWriteId=oF(e),o.splice(o.indexOf(f),1),i=(i=i.concat(iV(e.serverSyncTree_,h.path,_,h.currentWriteId,h.applyLocally))).concat(iK(e.serverSyncTree_,f,!0))}else l=!0,a="nodata",i=i.concat(iK(e.serverSyncTree_,h.currentWriteId,!0))}}oP(e.eventQueue_,n,i),i=[],l&&(t[s].status=2,setTimeout(t[s].unwatcher,Math.floor(0)),t[s].onComplete&&("nodata"===a?r.push(function(){return t[s].onComplete(null,!1,t[s].currentInputSnapshot)}):r.push(function(){return t[s].onComplete(Error(a),!1,null)})))},a=0;a<t.length;a++)s(a);o$(e,e.transactionQueueTree_);for(var a=0;a<r.length;a++)nT(r[a]);oK(e,e.transactionQueueTree_)}}(e,i,r),r}function oQ(e,t){var n,r=e.transactionQueueTree_;for(n=n$(t);null!==n&&void 0===os(r);)r=oo(r,n),n=n$(t=nZ(t));return r}function oG(e,t){var n=[];return function e(t,n,r){var i=os(n);if(i)for(var o=0;o<i.length;o++)r.push(i[o]);ou(n,function(n){e(t,n,r)})}(e,t,n),n.sort(function(e,t){return e.order-t.order}),n}function o$(e,t){var n=os(t);if(n){for(var r=0,i=0;i<n.length;i++)2!==n[i].status&&(n[r]=n[i],r++);n.length=r,oa(t,n.length>0?n:void 0)}ou(t,function(t){o$(e,t)})}function oJ(e,t){var n=ol(oQ(e,t)),r=oo(e.transactionQueueTree_,t);return!function(e,t,n){for(var r=e.parent;null!==r;){if(t(r))return!0;r=r.parent}}(r,function(t){oZ(e,t)}),oZ(e,r),!function e(t,n,r,i){r&&!i&&n(t),ou(t,function(t){e(t,n,!0,i)}),r&&i&&n(t)}(r,function(t){oZ(e,t)}),n}function oZ(e,t){var n=os(t);if(n){for(var r=[],i=[],o=-1,s=0;s<n.length;s++)3===n[s].status||(1===n[s].status?(tZ.assert(o===s-1,"All SENT items should be at beginning of queue."),o=s,n[s].status=3,n[s].abortReason="set"):(tZ.assert(0===n[s].status,"Unexpected transaction status in abort"),n[s].unwatcher(),i=i.concat(iK(e.serverSyncTree_,n[s].currentWriteId,!0)),n[s].onComplete&&r.push(n[s].onComplete.bind(null,Error("set"),!1,null))));-1===o?oa(t,void 0):n.length=o+1,oP(e.eventQueue_,ol(t),i);for(var s=0;s<r.length;s++)nT(r[s])}}var oX=function(e,t){var n=o0(e),r=n.namespace;"firebase.com"===n.domain&&nu(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||nu("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||nc();var i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new nI(n.host,n.secure,r,i,t,"",r!==n.subdomain),path:new nQ(n.pathString)}},o0=function(e){var t="",n="",r="",i="",o="",s=!0,a="https",h=443;if("string"==typeof e){var u=e.indexOf("//");u>=0&&(a=e.substring(0,u-1),e=e.substring(u+2));var l=e.indexOf("/");-1===l&&(l=e.length);var c=e.indexOf("?");-1===c&&(c=e.length),t=e.substring(0,Math.min(l,c)),l<c&&(i=/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function(e){for(var t="",n=e.split("/"),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(l,c)));var d=function(e){var t,n,r={};"?"===e.charAt(0)&&(e=e.substring(1));try{for(var i=tX.__values(e.split("&")),o=i.next();!o.done;o=i.next()){var s=o.value;if(0!==s.length){var a=s.split("=");2===a.length?r[decodeURIComponent(a[0])]=decodeURIComponent(a[1]):nl("Invalid query segment '".concat(s,"' in query '").concat(e,"'"))}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}(e.substring(Math.min(e.length,c)));(u=t.indexOf(":"))>=0?(s="https"===a||"wss"===a,h=parseInt(t.substring(u+1),10)):u=t.length;var p=t.slice(0,u);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{var f=t.indexOf(".");r=t.substring(0,f).toLowerCase(),n=t.substring(f+1),o=r}"ns"in d&&(o=d.ns)}return{host:t,port:h,domain:n,subdomain:r,secure:s,scheme:a,pathString:i,namespace:o}},o1="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",o2=(o=0,s=[],function(e){var t,n=e===o;o=e;var r=Array(8);for(t=7;t>=0;t--)r[t]=o1.charAt(e%64),e=Math.floor(e/64);tZ.assert(0===e,"Cannot push at time == 0");var i=r.join("");if(n){for(t=11;t>=0&&63===s[t];t--)s[t]=0;s[t]++}else for(t=0;t<12;t++)s[t]=Math.floor(64*Math.random());for(t=0;t<12;t++)i+=o1.charAt(s[t]);return tZ.assert(20===i.length,"nextPushId: Length should be 20."),i}),o3=function(){function e(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}return e.prototype.getPath=function(){var e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path},e.prototype.getEventType=function(){return this.eventType},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+tZ.stringify(this.snapshot.exportVal())},e}(),o4=function(){function e(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}return e.prototype.getPath=function(){return this.path},e.prototype.getEventType=function(){return"cancel"},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.path.toString()+":cancel"},e}(),o8=function(){function e(e,t){this.snapshotCallback=e,this.cancelCallback=t}return e.prototype.onValue=function(e,t){this.snapshotCallback.call(null,e,t)},e.prototype.onCancel=function(e){return tZ.assert(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)},Object.defineProperty(e.prototype,"hasCancelCallback",{get:function(){return!!this.cancelCallback},enumerable:!1,configurable:!0}),e.prototype.matches=function(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context},e}(),o5=function(){function e(e,t){this._repo=e,this._path=t}return e.prototype.cancel=function(){var e=new tZ.Deferred;return function(e,t,n){e.server_.onDisconnectCancel(t.toString(),function(r,i){"ok"===r&&function e(t,n){if(n3(n))return t.value=null,t.children.clear(),!0;if(null!==t.value){if(t.value.isLeafNode())return!1;var r=t.value;return t.value=null,r.forEachChild(rv,function(e,n){rj(t,new nQ(e),n)}),e(t,n)}if(!(t.children.size>0))return!0;var i=n$(n);return n=nZ(n),t.children.has(i)&&e(t.children.get(i),n)&&t.children.delete(i),0===t.children.size}(e.onDisconnect_,t),oz(e,n,r,i)})}(this._repo,this._path,e.wrapCallback(function(){})),e.promise},e.prototype.remove=function(){oS("OnDisconnect.remove",this._path);var e=new tZ.Deferred;return oB(this._repo,this._path,null,e.wrapCallback(function(){})),e.promise},e.prototype.set=function(e){oS("OnDisconnect.set",this._path),ov("OnDisconnect.set",e,this._path,!1);var t=new tZ.Deferred;return oB(this._repo,this._path,e,t.wrapCallback(function(){})),t.promise},e.prototype.setWithPriority=function(e,t){oS("OnDisconnect.setWithPriority",this._path),ov("OnDisconnect.setWithPriority",e,this._path,!1),oC("OnDisconnect.setWithPriority",t,!1);var n=new tZ.Deferred;return function(e,t,n,r,i){var o=rS(n,r);e.server_.onDisconnectPut(t.toString(),o.val(!0),function(n,r){"ok"===n&&rj(e.onDisconnect_,t,o),oz(e,i,n,r)})}(this._repo,this._path,e,t,n.wrapCallback(function(){})),n.promise},e.prototype.update=function(e){oS("OnDisconnect.update",this._path),om("OnDisconnect.update",e,this._path,!1);var t=new tZ.Deferred;return function(e,t,n,r){if(tZ.isEmpty(n)){ns("onDisconnect().update() called with empty data.  Don't do anything."),oz(e,r,"ok",void 0);return}e.server_.onDisconnectMerge(t.toString(),n,function(i,o){"ok"===i&&nw(n,function(n,r){var i=rS(r);rj(e.onDisconnect_,n2(t,n),i)}),oz(e,r,i,o)})}(this._repo,this._path,e,t.wrapCallback(function(){})),t.promise},e}(),o6=function(){function e(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}return Object.defineProperty(e.prototype,"key",{get:function(){return n3(this._path)?null:nX(this._path)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ref",{get:function(){return new st(this._repo,this._path)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_queryIdentifier",{get:function(){var e=nm(rU(this._queryParams));return"{}"===e?"default":e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_queryObject",{get:function(){return rU(this._queryParams)},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){if(!((t=tZ.getModularInstance(t))instanceof e))return!1;var n=this._repo===t._repo,r=n5(this._path,t._path),i=this._queryIdentifier===t._queryIdentifier;return n&&r&&i},e.prototype.toJSON=function(){return this.toString()},e.prototype.toString=function(){return this._repo.toString()+function(e){for(var t="",n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)},e}();function o9(e,t){if(!0===e._orderByCalled)throw Error(t+": You can't combine multiple orderBy calls.")}function o7(e){var t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===rs){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==nf)throw Error(r);if("string"!=typeof t)throw Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==n_)throw Error(r);if("string"!=typeof n)throw Error(i)}}else if(e.getIndex()===rv){if(null!=t&&!o_(t)||null!=n&&!o_(n))throw Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(tZ.assert(e.getIndex() instanceof rT||e.getIndex()===rk,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function se(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var st=function(e){function t(t,n){return e.call(this,t,n,new rA,!1)||this}return tX.__extends(t,e),Object.defineProperty(t.prototype,"parent",{get:function(){var e=n1(this._path);return null===e?null:new t(this._repo,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e},enumerable:!1,configurable:!0}),t}(o6),sn=function(){function e(e,t,n){this._node=e,this.ref=t,this._index=n}return Object.defineProperty(e.prototype,"priority",{get:function(){return this._node.getPriority().val()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this.ref.key},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._node.numChildren()},enumerable:!1,configurable:!0}),e.prototype.child=function(t){var n=new nQ(t),r=si(this.ref,t);return new e(this._node.getChild(n),r,rv)},e.prototype.exists=function(){return!this._node.isEmpty()},e.prototype.exportVal=function(){return this._node.val(!0)},e.prototype.forEach=function(t){var n=this;return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,function(r,i){return t(new e(i,si(n.ref,r),rv))})},e.prototype.hasChild=function(e){var t=new nQ(e);return!this._node.getChild(t).isEmpty()},e.prototype.hasChildren=function(){return!this._node.isLeafNode()&&!this._node.isEmpty()},e.prototype.toJSON=function(){return this.exportVal()},e.prototype.val=function(){return this._node.val()},e}();function sr(e,t){return(e=tZ.getModularInstance(e))._checkNotDeleted("ref"),void 0!==t?si(e._root,t):e._root}function si(e,t){return null===n$((e=tZ.getModularInstance(e))._path)?oE("child","path",t,!1):ob("child","path",t,!1),new st(e._repo,n2(e._path,t))}function so(e,t){oS("set",(e=tZ.getModularInstance(e))._path),ov("set",t,e._path,!1);var n=new tZ.Deferred;return oU(e._repo,e._path,t,null,n.wrapCallback(function(){})),n.promise}var ss=function(){function e(e){this.callbackContext=e}return e.prototype.respondsTo=function(e){return"value"===e},e.prototype.createEvent=function(e,t){var n=t._queryParams.getIndex();return new o3("value",this,new sn(e.snapshotNode,new st(t._repo,t._path),n))},e.prototype.getEventRunner=function(e){var t=this;return"cancel"===e.getEventType()?function(){return t.callbackContext.onCancel(e.error)}:function(){return t.callbackContext.onValue(e.snapshot,null)}},e.prototype.createCancelEvent=function(e,t){return this.callbackContext.hasCancelCallback?new o4(this,e,t):null},e.prototype.matches=function(t){return t instanceof e&&(!t.callbackContext||!this.callbackContext||t.callbackContext.matches(this.callbackContext))},e.prototype.hasAnyCallback=function(){return null!==this.callbackContext},e}(),sa=function(){function e(e,t){this.eventType=e,this.callbackContext=t}return e.prototype.respondsTo=function(e){var t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t},e.prototype.createCancelEvent=function(e,t){return this.callbackContext.hasCancelCallback?new o4(this,e,t):null},e.prototype.createEvent=function(e,t){tZ.assert(null!=e.childName,"Child events should have a childName.");var n=si(new st(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new o3(e.type,this,new sn(e.snapshotNode,n,r),e.prevName)},e.prototype.getEventRunner=function(e){var t=this;return"cancel"===e.getEventType()?function(){return t.callbackContext.onCancel(e.error)}:function(){return t.callbackContext.onValue(e.snapshot,e.prevName)}},e.prototype.matches=function(t){return t instanceof e&&this.eventType===t.eventType&&(!this.callbackContext||!t.callbackContext||this.callbackContext.matches(t.callbackContext))},e.prototype.hasAnyCallback=function(){return!!this.callbackContext},e}();function sh(e,t,n,r,i){if("object"==typeof r&&(a=void 0,i=r),"function"==typeof r&&(a=r),i&&i.onlyOnce){var o,s,a,h=n,u=function(t,n){oH(e._repo,e,c),h(t,n)};u.userCallback=n.userCallback,u.context=n.context,n=u}var l=new o8(n,a||void 0),c="value"===t?new ss(l):new sa(t,l);return o=e._repo,s=".info"===n$(e._path)?i$(o.infoSyncTree_,e,c):i$(o.serverSyncTree_,e,c),ox(o.eventQueue_,e._path,s),function(){return oH(e._repo,e,c)}}function su(e,t,n,r){return sh(e,"value",t,n,r)}var sl=function(){},sc=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return tX.__extends(t,e),t.prototype._apply=function(e){ov("endAt",this._value,e._path,!0);var t=rM(e._queryParams,this._value,this._key);if(se(t),o7(t),e._queryParams.hasEnd())throw Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new o6(e._repo,e._path,t,e._orderByCalled)},t}(sl),sd=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return tX.__extends(t,e),t.prototype._apply=function(e){ov("endBefore",this._value,e._path,!1);var t,n,r,i,o=(t=e._queryParams,n=this._value,r=this._key,(i=t.index_===rs||r?rM(t,n,r):rM(t,n,nf)).endBeforeSet_=!0,i);if(se(o),o7(o),e._queryParams.hasEnd())throw Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new o6(e._repo,e._path,o,e._orderByCalled)},t}(sl),sp=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return tX.__extends(t,e),t.prototype._apply=function(e){ov("startAt",this._value,e._path,!0);var t=rL(e._queryParams,this._value,this._key);if(se(t),o7(t),e._queryParams.hasStart())throw Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new o6(e._repo,e._path,t,e._orderByCalled)},t}(sl),sf=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return tX.__extends(t,e),t.prototype._apply=function(e){ov("startAfter",this._value,e._path,!1);var t,n,r,i,o=(t=e._queryParams,n=this._value,r=this._key,(i=t.index_===rs||r?rL(t,n,r):rL(t,n,n_)).startAfterSet_=!0,i);if(se(o),o7(o),e._queryParams.hasStart())throw Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new o6(e._repo,e._path,o,e._orderByCalled)},t}(sl),s_=function(e){function t(t){var n=e.call(this)||this;return n._limit=t,n}return tX.__extends(t,e),t.prototype._apply=function(e){var t,n,r;if(e._queryParams.hasLimit())throw Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new o6(e._repo,e._path,(t=e._queryParams,n=this._limit,(r=t.copy()).limitSet_=!0,r.limit_=n,r.viewFrom_="l",r),e._orderByCalled)},t}(sl),sv=function(e){function t(t){var n=e.call(this)||this;return n._limit=t,n}return tX.__extends(t,e),t.prototype._apply=function(e){var t,n,r;if(e._queryParams.hasLimit())throw Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new o6(e._repo,e._path,(t=e._queryParams,n=this._limit,(r=t.copy()).limitSet_=!0,r.limit_=n,r.viewFrom_="r",r),e._orderByCalled)},t}(sl),sy=function(e){function t(t){var n=e.call(this)||this;return n._path=t,n}return tX.__extends(t,e),t.prototype._apply=function(e){o9(e,"orderByChild");var t=new nQ(this._path);if(n3(t))throw Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");var n=new rT(t),r=rq(e._queryParams,n);return o7(r),new o6(e._repo,e._path,r,!0)},t}(sl),sg=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return tX.__extends(t,e),t.prototype._apply=function(e){o9(e,"orderByKey");var t=rq(e._queryParams,rs);return o7(t),new o6(e._repo,e._path,t,!0)},t}(sl),sm=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return tX.__extends(t,e),t.prototype._apply=function(e){o9(e,"orderByPriority");var t=rq(e._queryParams,rv);return o7(t),new o6(e._repo,e._path,t,!0)},t}(sl),sC=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return tX.__extends(t,e),t.prototype._apply=function(e){o9(e,"orderByValue");var t=rq(e._queryParams,rk);return o7(t),new o6(e._repo,e._path,t,!0)},t}(sl),sw=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return tX.__extends(t,e),t.prototype._apply=function(e){if(ov("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new sc(this._value,this._key)._apply(new sp(this._value,this._key)._apply(e))},t}(sl);tZ.assert(!v,"__referenceConstructor has already been defined"),v=st,tZ.assert(!y,"__referenceConstructor has already been defined"),y=st;var sb={},sE=!1,sS=function(){function e(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}return Object.defineProperty(e.prototype,"_repo",{get:function(){return this._instanceStarted||(function(e,t,n){var r;if(e.stats_=nO(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new rB(e.repoInfo_,function(t,n,r,i){oL(e,t,n,r,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(function(){return oM(e,!0)},0);else{if(null!=n){if("object"!=typeof n)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{tZ.stringify(n)}catch(e){throw Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new rn(e.repoInfo_,t,function(t,n,r,i){oL(e,t,n,r,i)},function(t){oM(e,t)},function(t){nw(t,function(t,n){oq(e,t,n)})},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(function(t){e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(function(t){e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=(nR[r=e.repoInfo_.toString()]||(nR[r]=new rK(e.stats_,e.server_)),nR[r]),e.infoData_=new rH,e.infoSyncTree_=new iz({startListening:function(t,n,r,i){var o=[],s=e.infoData_.getNode(t._path);return s.isEmpty()||(o=iY(e.infoSyncTree_,t._path,s),setTimeout(function(){i("ok")},0)),o},stopListening:function(){}}),oq(e,"connected",!1),e.serverSyncTree_=new iz({startListening:function(t,n,r,i){return e.server_.listen(t,r,n,function(n,r){var o=i(n,r);oP(e.eventQueue_,t._path,o)}),[]},stopListening:function(t,n){e.server_.unlisten(t,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_root",{get:function(){return this._rootInternal||(this._rootInternal=new st(this._repo,nG())),this._rootInternal},enumerable:!1,configurable:!0}),e.prototype._delete=function(){if(null!==this._rootInternal){var e,t,n;e=this._repo,(n=sb[t=this.app.name])&&n[e.key]===e||nu("Database ".concat(t,"(").concat(e.repoInfo_,") has already been deleted.")),oW(e),delete n[e.key],this._repoInternal=null,this._rootInternal=null}return Promise.resolve()},e.prototype._checkNotDeleted=function(e){null===this._rootInternal&&nu("Cannot call "+e+" on a deleted database.")},e}();function sT(){nj.IS_TRANSPORT_INITIALIZED&&nl("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var sk={".sv":"timestamp"},sI=function(){function e(e,t){this.committed=e,this.snapshot=t}return e.prototype.toJSON=function(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}},e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */rn.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},rn.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},nA=tJ.Client,K.DataSnapshot=sn,K.Database=sS;var sx=K.OnDisconnect=o5;K.QueryConstraint=sl,K.TransactionResult=sI;var sP=K._QueryImpl=o6,sN=K._QueryParams=rA,sR=K._ReferenceImpl=st;K._TEST_ACCESS_forceRestClient=function(e){sE=e},K._TEST_ACCESS_hijackHash=function(e){var t=rn.prototype.put;return rn.prototype.put=function(n,r,i,o){void 0!==o&&(o=e()),t.call(this,n,r,i,o)},function(){rn.prototype.put=t}};var sO=K._repoManagerDatabaseFromApp=function(e,t,n,r,i){var o,s,a,h,u,l=r||e.options.databaseURL;void 0===l&&(e.options.projectId||nu("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),ns("Using default host for project ",e.options.projectId),l="".concat(e.options.projectId,"-default-rtdb.firebaseio.com"));var c=oX(l,i),d=c.repoInfo,p=void 0;void 0!==g&&g.env&&(p=g.env.FIREBASE_DATABASE_EMULATOR_HOST),p?(u=!0,d=(c=oX(l="http://".concat(p,"?ns=").concat(d.namespace),i)).repoInfo):u=!c.repoInfo.secure;var f=i&&u?new nF(nF.OWNER):new nq(e.name,e.options,t);oT("Invalid Firebase Database URL",c),n3(c.path)||nu("Database URL must point to the root of a Firebase Database (not including a child path).");var _=(o=d,s=new nM(e.name,n),(a=sb[e.name])||(a={},sb[e.name]=a),(h=a[o.toURLString()])&&nu("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),h=new oO(o,sE,f,s),a[o.toURLString()]=h,h);return new sS(_,e)},sD=K._setSDKVersion=function(e){nD=e},sA=K._validatePathString=ob,sL=K._validateWritablePath=oS,sM=K.child=si,sq=K.connectDatabaseEmulator=function(e,t,n,r){void 0===r&&(r={}),(e=tZ.getModularInstance(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&nu("Cannot call useEmulator() after instance has already been initialized.");var i,o=e._repoInternal,s=void 0;if(o.repoInfo_.nodeAdmin)r.mockUserToken&&nu('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new nF(nF.OWNER);else if(r.mockUserToken){var a="string"==typeof r.mockUserToken?r.mockUserToken:tZ.createMockUserToken(r.mockUserToken,e.app.options.projectId);s=new nF(a)}i=s,o.repoInfo_=new nI("".concat(t,":").concat(n),!1,o.repoInfo_.namespace,o.repoInfo_.webSocketOnly,o.repoInfo_.nodeAdmin,o.repoInfo_.persistenceKey,o.repoInfo_.includeNamespaceInQueryParams,!0),i&&(o.authTokenProvider_=i)},sF=K.enableLogging=function(e,t){no(e,t)},sU=K.endAt=function(e,t){return ow("endAt","key",t,!0),new sc(e,t)},sB=K.endBefore=function(e,t){return ow("endBefore","key",t,!0),new sd(e,t)},sH=K.equalTo=function(e,t){return ow("equalTo","key",t,!0),new sw(e,t)},sW=K.forceLongPolling=function(){sT(),nL.forceDisallow(),nH.forceAllow()},sj=K.forceWebSockets=function(){sT(),nH.forceDisallow()},sz=K.get=function(e){e=tZ.getModularInstance(e);var t,n,r,i=new o8(function(){}),o=new ss(i);return(t=e._repo,n=e,null!=(r=function(e,t){var n,r=t._path,i=null;e.syncPointTree_.foreachOnPath(r,function(e,t){var n=n4(e,r);i=i||iU(t,n)});var o=e.syncPointTree_.get(r);o?i=i||iU(o,nG()):(o=new iL,e.syncPointTree_=e.syncPointTree_.set(r,o));var s=null!=i,a=s?new r0(i,!0,!1):null,h=(n=e.pendingWriteTree_,iC(t._path,n));return r5(iq(o,t,h,s?a.getNode():rb.EMPTY_NODE,s).viewCache_)}(t.serverSyncTree_,n))?Promise.resolve(r):t.server_.get(n).then(function(e){var r,i=rS(e).withIndex(n._queryParams.getIndex());if(i$(t.serverSyncTree_,n,o,!0),n._queryParams.loadsAllData())r=iY(t.serverSyncTree_,n._path,i);else{var s=i0(t.serverSyncTree_,n);r=iG(t.serverSyncTree_,n._path,i,s)}return oP(t.eventQueue_,n._path,r),iQ(t.serverSyncTree_,n,o,null,!0),i},function(e){return oj(t,"get for query "+tZ.stringify(n)+" failed: "+e),Promise.reject(Error(e))})).then(function(t){return new sn(t,new st(e._repo,e._path),e._queryParams.getIndex())})},sV=K.goOffline=function(e){(e=tZ.getModularInstance(e))._checkNotDeleted("goOffline"),oW(e._repo)},sK=K.goOnline=function(e){var t;(e=tZ.getModularInstance(e))._checkNotDeleted("goOnline"),(t=e._repo).persistentConnection_&&t.persistentConnection_.resume(oR)},sY=K.increment=function(e){return{".sv":{increment:e}}},sQ=K.limitToFirst=function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw Error("limitToFirst: First argument must be a positive integer.");return new s_(e)},sG=K.limitToLast=function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw Error("limitToLast: First argument must be a positive integer.");return new sv(e)},s$=K.off=function(e,t,n){var r=null,i=n?new o8(n):null;"value"===t?r=new ss(i):t&&(r=new sa(t,i)),oH(e._repo,e,r)},sJ=K.onChildAdded=function(e,t,n,r){return sh(e,"child_added",t,n,r)},sZ=K.onChildChanged=function(e,t,n,r){return sh(e,"child_changed",t,n,r)},sX=K.onChildMoved=function(e,t,n,r){return sh(e,"child_moved",t,n,r)},s0=K.onChildRemoved=function(e,t,n,r){return sh(e,"child_removed",t,n,r)};K.onDisconnect=function(e){return e=tZ.getModularInstance(e),new o5(e._repo,e._path)};var s1=K.onValue=su,s2=K.orderByChild=function(e){if("$key"===e)throw Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return ob("orderByChild","path",e,!1),new sy(e)},s3=K.orderByKey=function(){return new sg},s4=K.orderByPriority=function(){return new sm},s8=K.orderByValue=function(){return new sC},s5=K.push=function(e,t){oS("push",(e=tZ.getModularInstance(e))._path),ov("push",t,e._path,!0);var n,r=o2(oD(e._repo)),i=si(e,r),o=si(e,r);return n=null!=t?so(o,t).then(function(){return o}):Promise.resolve(o),i.then=n.then.bind(n),i.catch=n.then.bind(n,void 0),i},s6=K.query=function(e){for(var t,n,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var o=tZ.getModularInstance(e);try{for(var s=tX.__values(r),a=s.next();!a.done;a=s.next())o=a.value._apply(o)}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return o},s9=K.ref=sr,s7=K.refFromURL=function(e,t){(e=tZ.getModularInstance(e))._checkNotDeleted("refFromURL");var n=oX(t,e._repo.repoInfo_.nodeAdmin);oT("refFromURL",n);var r=n.repoInfo;return e._repo.repoInfo_.isCustomHost()||r.host===e._repo.repoInfo_.host||nu("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+e._repo.repoInfo_.host+")"),sr(e,n.path.toString())},ae=K.remove=function(e){return oS("remove",e._path),so(e,null)},at=K.runTransaction=function(e,t,n){if(oS("Reference.transaction",(e=tZ.getModularInstance(e))._path),".length"===e.key||".keys"===e.key)throw"Reference.transaction failed: "+e.key+" is a read-only object.";var r,i=null===(r=null==n?void 0:n.applyLocally)||void 0===r||r,o=new tZ.Deferred,s=su(e,function(){});return!function(e,t,n,r,i,o){oj(e,"transaction on "+t);var s={path:t,update:n,onComplete:r,status:null,order:ne(),applyLocally:o,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=oV(e,t,void 0);s.currentInputSnapshot=a;var h=s.update(a.val());if(void 0===h)s.unwatcher(),s.currentOutputSnapshotRaw=null,s.currentOutputSnapshotResolved=null,s.onComplete&&s.onComplete(null,!1,s.currentInputSnapshot);else{oy("transaction failed: Data returned ",h,s.path),s.status=0;var u=oo(e.transactionQueueTree_,t),l=os(u)||[];l.push(s),oa(u,l);var c=void 0;"object"==typeof h&&null!==h&&tZ.contains(h,".priority")?(c=tZ.safeGet(h,".priority"),tZ.assert(o_(c),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):c=(iJ(e.serverSyncTree_,t)||rb.EMPTY_NODE).getPriority().val();var d=oA(e),p=rS(h,c),f=on(p,a,d);s.currentOutputSnapshotRaw=p,s.currentOutputSnapshotResolved=f,s.currentWriteId=oF(e);var _=iV(e.serverSyncTree_,t,f,s.currentWriteId,s.applyLocally);oP(e.eventQueue_,t,_),oK(e,e.transactionQueueTree_)}}(e._repo,e._path,t,function(t,n,r){var i=null;t?o.reject(t):(i=new sn(r,new st(e._repo,e._path),rv),o.resolve(new sI(n,i)))},s,i),o.promise},an=K.serverTimestamp=function(){return sk},ar=K.set=so,ai=K.setPriority=function(e,t){oS("setPriority",(e=tZ.getModularInstance(e))._path),oC("setPriority",t,!1);var n=new tZ.Deferred;return oU(e._repo,n2(e._path,".priority"),t,null,n.wrapCallback(function(){})),n.promise},ao=K.setWithPriority=function(e,t,n){if(oS("setWithPriority",e._path),ov("setWithPriority",t,e._path,!1),oC("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";var r=new tZ.Deferred;return oU(e._repo,e._path,t,n,r.wrapCallback(function(){})),r.promise},as=K.startAfter=function(e,t){return ow("startAfter","key",t,!0),new sf(e,t)},aa=K.startAt=function(e,t){return void 0===e&&(e=null),ow("startAt","key",t,!0),new sp(e,t)},ah=K.update=function(e,t){om("update",t,e._path,!1);var n=new tZ.Deferred;return!function(e,t,n,r){oj(e,"update",{path:t.toString(),value:n});var i=!0,o=oA(e),s={};if(nw(n,function(n,r){i=!1,s[n]=ot(n2(t,n),rS(r),e.serverSyncTree_,o)}),i)ns("update() called with empty data.  Don't do anything."),oz(e,r,"ok",void 0);else{var a,h,u,l=oF(e),c=(h=(a=e.serverSyncTree_).pendingWriteTree_,tZ.assert(l>h.lastWriteId,"Stacking an older merge on top of newer ones"),h.allWrites.push({path:t,children:s,writeId:l,visible:!0}),h.visibleWrites=it(h.visibleWrites,t,s),h.lastWriteId=l,u=r9.fromObject(s),iZ(a,new rX(rY(),t,u)));oI(e.eventQueue_,c),e.server_.merge(t.toString(),n,function(n,i){var o="ok"===n;o||nl("update at "+t+" failed: "+n);var s=iK(e.serverSyncTree_,l,!o),a=s.length>0?oY(e,t):t;oP(e.eventQueue_,a,s),oz(e,r,n,i)}),nw(n,function(n){var r=oJ(e,n2(t,n));oY(e,r)}),oP(e.eventQueue_,t,[])}}(e._repo,e._path,t,n.wrapCallback(function(){})),n.promise},au=new R.Logger("@firebase/database-compat"),al=function(e){au.warn("FIREBASE WARNING: "+e)},ac=function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw Error(P.errorPrefix(e,t)+"must be a boolean.")},ad=function(e,t,n){if(!n||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw Error(P.errorPrefix(e,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},ap=function(){function e(e){this._delegate=e}return e.prototype.cancel=function(e){P.validateArgCount("OnDisconnect.cancel",0,1,arguments.length),P.validateCallback("OnDisconnect.cancel","onComplete",e,!0);var t=this._delegate.cancel();return e&&t.then(function(){return e(null)},function(t){return e(t)}),t},e.prototype.remove=function(e){P.validateArgCount("OnDisconnect.remove",0,1,arguments.length),P.validateCallback("OnDisconnect.remove","onComplete",e,!0);var t=this._delegate.remove();return e&&t.then(function(){return e(null)},function(t){return e(t)}),t},e.prototype.set=function(e,t){P.validateArgCount("OnDisconnect.set",1,2,arguments.length),P.validateCallback("OnDisconnect.set","onComplete",t,!0);var n=this._delegate.set(e);return t&&n.then(function(){return t(null)},function(e){return t(e)}),n},e.prototype.setWithPriority=function(e,t,n){P.validateArgCount("OnDisconnect.setWithPriority",2,3,arguments.length),P.validateCallback("OnDisconnect.setWithPriority","onComplete",n,!0);var r=this._delegate.setWithPriority(e,t);return n&&r.then(function(){return n(null)},function(e){return n(e)}),r},e.prototype.update=function(e,t){if(P.validateArgCount("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,al("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}P.validateCallback("OnDisconnect.update","onComplete",t,!0);var i=this._delegate.update(e);return t&&i.then(function(){return t(null)},function(e){return t(e)}),i},e}(),af=function(){function e(e,t){this.committed=e,this.snapshot=t}return e.prototype.toJSON=function(){return P.validateArgCount("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},e}(),a_=function(){function e(e,t){this._database=e,this._delegate=t}return e.prototype.val=function(){return P.validateArgCount("DataSnapshot.val",0,0,arguments.length),this._delegate.val()},e.prototype.exportVal=function(){return P.validateArgCount("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()},e.prototype.toJSON=function(){return P.validateArgCount("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()},e.prototype.exists=function(){return P.validateArgCount("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()},e.prototype.child=function(t){return P.validateArgCount("DataSnapshot.child",0,1,arguments.length),sA("DataSnapshot.child","path",t=String(t),!1),new e(this._database,this._delegate.child(t))},e.prototype.hasChild=function(e){return P.validateArgCount("DataSnapshot.hasChild",1,1,arguments.length),sA("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)},e.prototype.getPriority=function(){return P.validateArgCount("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority},e.prototype.forEach=function(t){var n=this;return P.validateArgCount("DataSnapshot.forEach",1,1,arguments.length),P.validateCallback("DataSnapshot.forEach","action",t,!1),this._delegate.forEach(function(r){return t(new e(n._database,r))})},e.prototype.hasChildren=function(){return P.validateArgCount("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()},Object.defineProperty(e.prototype,"key",{get:function(){return this._delegate.key},enumerable:!1,configurable:!0}),e.prototype.numChildren=function(){return P.validateArgCount("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size},e.prototype.getRef=function(){return P.validateArgCount("DataSnapshot.ref",0,0,arguments.length),new ay(this._database,this._delegate.ref)},Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),e}(),av=function(){function e(e,t){this.database=e,this._delegate=t}return e.prototype.on=function(t,n,r,i){var o,s=this;P.validateArgCount("Query.on",2,4,arguments.length),P.validateCallback("Query.on","callback",n,!1);var a=e.getCancelAndContextArgs_("Query.on",r,i),h=function(e,t){n.call(a.context,new a_(s.database,e),t)};h.userCallback=n,h.context=a.context;var u=null===(o=a.cancel)||void 0===o?void 0:o.bind(a.context);switch(t){case"value":return s1(this._delegate,h,u),n;case"child_added":return sJ(this._delegate,h,u),n;case"child_removed":return s0(this._delegate,h,u),n;case"child_changed":return sZ(this._delegate,h,u),n;case"child_moved":return sX(this._delegate,h,u),n;default:throw Error(P.errorPrefix("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},e.prototype.off=function(e,t,n){if(P.validateArgCount("Query.off",0,3,arguments.length),ad("Query.off",e,!0),P.validateCallback("Query.off","callback",t,!0),P.validateContextObject("Query.off","context",n,!0),t){var r=function(){};r.userCallback=t,r.context=n,s$(this._delegate,e,r)}else s$(this._delegate,e)},e.prototype.get=function(){var e=this;return sz(this._delegate).then(function(t){return new a_(e.database,t)})},e.prototype.once=function(t,n,r,i){var o=this;P.validateArgCount("Query.once",1,4,arguments.length),P.validateCallback("Query.once","callback",n,!0);var s=e.getCancelAndContextArgs_("Query.once",r,i),a=new P.Deferred,h=function(e,t){var r=new a_(o.database,e);n&&n.call(s.context,r,t),a.resolve(r)};h.userCallback=n,h.context=s.context;var u=function(e){s.cancel&&s.cancel.call(s.context,e),a.reject(e)};switch(t){case"value":s1(this._delegate,h,u,{onlyOnce:!0});break;case"child_added":sJ(this._delegate,h,u,{onlyOnce:!0});break;case"child_removed":s0(this._delegate,h,u,{onlyOnce:!0});break;case"child_changed":sZ(this._delegate,h,u,{onlyOnce:!0});break;case"child_moved":sX(this._delegate,h,u,{onlyOnce:!0});break;default:throw Error(P.errorPrefix("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return a.promise},e.prototype.limitToFirst=function(t){return P.validateArgCount("Query.limitToFirst",1,1,arguments.length),new e(this.database,s6(this._delegate,sQ(t)))},e.prototype.limitToLast=function(t){return P.validateArgCount("Query.limitToLast",1,1,arguments.length),new e(this.database,s6(this._delegate,sG(t)))},e.prototype.orderByChild=function(t){return P.validateArgCount("Query.orderByChild",1,1,arguments.length),new e(this.database,s6(this._delegate,s2(t)))},e.prototype.orderByKey=function(){return P.validateArgCount("Query.orderByKey",0,0,arguments.length),new e(this.database,s6(this._delegate,s3()))},e.prototype.orderByPriority=function(){return P.validateArgCount("Query.orderByPriority",0,0,arguments.length),new e(this.database,s6(this._delegate,s4()))},e.prototype.orderByValue=function(){return P.validateArgCount("Query.orderByValue",0,0,arguments.length),new e(this.database,s6(this._delegate,s8()))},e.prototype.startAt=function(t,n){return void 0===t&&(t=null),P.validateArgCount("Query.startAt",0,2,arguments.length),new e(this.database,s6(this._delegate,aa(t,n)))},e.prototype.startAfter=function(t,n){return void 0===t&&(t=null),P.validateArgCount("Query.startAfter",0,2,arguments.length),new e(this.database,s6(this._delegate,as(t,n)))},e.prototype.endAt=function(t,n){return void 0===t&&(t=null),P.validateArgCount("Query.endAt",0,2,arguments.length),new e(this.database,s6(this._delegate,sU(t,n)))},e.prototype.endBefore=function(t,n){return void 0===t&&(t=null),P.validateArgCount("Query.endBefore",0,2,arguments.length),new e(this.database,s6(this._delegate,sB(t,n)))},e.prototype.equalTo=function(t,n){return P.validateArgCount("Query.equalTo",1,2,arguments.length),new e(this.database,s6(this._delegate,sH(t,n)))},e.prototype.toString=function(){return P.validateArgCount("Query.toString",0,0,arguments.length),this._delegate.toString()},e.prototype.toJSON=function(){return P.validateArgCount("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()},e.prototype.isEqual=function(t){if(P.validateArgCount("Query.isEqual",1,1,arguments.length),!(t instanceof e))throw Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");return this._delegate.isEqual(t._delegate)},e.getCancelAndContextArgs_=function(e,t,n){var r={cancel:void 0,context:void 0};if(t&&n)r.cancel=t,P.validateCallback(e,"cancel",r.cancel,!0),r.context=n,P.validateContextObject(e,"context",r.context,!0);else if(t){if("object"==typeof t&&null!==t)r.context=t;else if("function"==typeof t)r.cancel=t;else throw Error(P.errorPrefix(e,"cancelOrContext")+" must either be a cancel callback or a context object.")}return r},Object.defineProperty(e.prototype,"ref",{get:function(){return new ay(this.database,new sR(this._delegate._repo,this._delegate._path))},enumerable:!1,configurable:!0}),e}(),ay=function(e){function t(t,n){var r=e.call(this,t,new sP(n._repo,n._path,new sN,!1))||this;return r.database=t,r._delegate=n,r}return N.__extends(t,e),t.prototype.getKey=function(){return P.validateArgCount("Reference.key",0,0,arguments.length),this._delegate.key},t.prototype.child=function(e){return P.validateArgCount("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new t(this.database,sM(this._delegate,e))},t.prototype.getParent=function(){P.validateArgCount("Reference.parent",0,0,arguments.length);var e=this._delegate.parent;return e?new t(this.database,e):null},t.prototype.getRoot=function(){return P.validateArgCount("Reference.root",0,0,arguments.length),new t(this.database,this._delegate.root)},t.prototype.set=function(e,t){P.validateArgCount("Reference.set",1,2,arguments.length),P.validateCallback("Reference.set","onComplete",t,!0);var n=ar(this._delegate,e);return t&&n.then(function(){return t(null)},function(e){return t(e)}),n},t.prototype.update=function(e,t){if(P.validateArgCount("Reference.update",1,2,arguments.length),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,al("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}sL("Reference.update",this._delegate._path),P.validateCallback("Reference.update","onComplete",t,!0);var i=ah(this._delegate,e);return t&&i.then(function(){return t(null)},function(e){return t(e)}),i},t.prototype.setWithPriority=function(e,t,n){P.validateArgCount("Reference.setWithPriority",2,3,arguments.length),P.validateCallback("Reference.setWithPriority","onComplete",n,!0);var r=ao(this._delegate,e,t);return n&&r.then(function(){return n(null)},function(e){return n(e)}),r},t.prototype.remove=function(e){P.validateArgCount("Reference.remove",0,1,arguments.length),P.validateCallback("Reference.remove","onComplete",e,!0);var t=ae(this._delegate);return e&&t.then(function(){return e(null)},function(t){return e(t)}),t},t.prototype.transaction=function(e,t,n){var r=this;P.validateArgCount("Reference.transaction",1,3,arguments.length),P.validateCallback("Reference.transaction","transactionUpdate",e,!1),P.validateCallback("Reference.transaction","onComplete",t,!0),ac("Reference.transaction","applyLocally",n,!0);var i=at(this._delegate,e,{applyLocally:n}).then(function(e){return new af(e.committed,new a_(r.database,e.snapshot))});return t&&i.then(function(e){return t(null,e.committed,e.snapshot)},function(e){return t(e,!1,null)}),i},t.prototype.setPriority=function(e,t){P.validateArgCount("Reference.setPriority",1,2,arguments.length),P.validateCallback("Reference.setPriority","onComplete",t,!0);var n=ai(this._delegate,e);return t&&n.then(function(){return t(null)},function(e){return t(e)}),n},t.prototype.push=function(e,n){var r=this;P.validateArgCount("Reference.push",0,2,arguments.length),P.validateCallback("Reference.push","onComplete",n,!0);var i=s5(this._delegate,e),o=i.then(function(e){return new t(r.database,e)});n&&o.then(function(){return n(null)},function(e){return n(e)});var s=new t(this.database,i);return s.then=o.then.bind(o),s.catch=o.catch.bind(o,void 0),s},t.prototype.onDisconnect=function(){return sL("Reference.onDisconnect",this._delegate._path),new ap(new sx(this._delegate._repo,this._delegate._path))},Object.defineProperty(t.prototype,"key",{get:function(){return this.getKey()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this.getParent()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this.getRoot()},enumerable:!1,configurable:!0}),t}(av),ag=function(){function e(e,t){var n=this;this._delegate=e,this.app=t,this.INTERNAL={delete:function(){return n._delegate._delete()},forceWebSockets:sj,forceLongPolling:sW}}return e.prototype.useEmulator=function(e,t,n){void 0===n&&(n={}),sq(this._delegate,e,t,n)},e.prototype.ref=function(e){if(P.validateArgCount("database.ref",0,1,arguments.length),e instanceof ay){var t=s7(this._delegate,e.toString());return new ay(this,t)}var t=s9(this._delegate,e);return new ay(this,t)},e.prototype.refFromURL=function(e){P.validateArgCount("database.refFromURL",1,1,arguments.length);var t=s7(this._delegate,e);return new ay(this,t)},e.prototype.goOffline=function(){return P.validateArgCount("database.goOffline",0,0,arguments.length),sV(this._delegate)},e.prototype.goOnline=function(){return P.validateArgCount("database.goOnline",0,0,arguments.length),sK(this._delegate)},e.ServerValue={TIMESTAMP:an(),increment:function(e){return sY(e)}},e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function am(e){var t=e.app,n=e.url,r=e.version,i=e.customAuthImpl,o=e.namespace,s=e.nodeAdmin,a=void 0!==s&&s;sD(r);var h=new O.Provider("auth-internal",new O.ComponentContainer("database-standalone"));return h.setComponent(new O.Component("auth-internal",function(){return i},"PRIVATE")),{instance:new ag(sO(t,h,void 0,n,a),t),namespace:o}}var aC=Object.freeze({__proto__:null,initStandalone:am}),aw=ag.ServerValue;t.DataSnapshot=a_,t.Database=ag,t.OnDisconnect=sx,t.Query=av,t.Reference=ay,t.ServerValue=aw,t.enableLogging=sF,t.initStandalone=function(e,t,n,r){return void 0===r&&(r=!0),P.CONSTANTS.NODE_ADMIN=r,am({app:e,url:t,version:n,customAuthImpl:e.INTERNAL,namespace:{Reference:ay,Query:av,Database:ag,DataSnapshot:a_,enableLogging:sF,INTERNAL:aC,ServerValue:aw},nodeAdmin:r})}}}]);